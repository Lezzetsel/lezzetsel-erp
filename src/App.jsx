import React, { useState, useEffect, useMemo } from 'react';
import { Package, ShoppingCart, TrendingUp, DollarSign, Plus, Search, Download, Edit2, Trash2, AlertCircle, Home, Truck, Calendar, BookOpen, Users, Building2, FileText, Menu, X, AlertTriangle, ClipboardCheck } from 'lucide-react';
import { supabase } from './supabaseClient';


const LOGO_BASE64 = "data:image/jpeg;base64,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AAAAAAAAAAAAGsJyQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAE/R4YSQAAAAABBZyBl0gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFw2wGnVMjG1ioEYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzykxzzzzzzzwVOk3zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwebAOrs3zyZ3E/KMqO3zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzxeSLw/zygb7UPzzzzwJkfzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwQjzxa9M5ZLzzzzzzzxcpnzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwWTzzzzzzzzzwY8kHzzzyanzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwEXzzzzzzzzyyZbcbXzzwZHzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzyznzzzzzzyAUdzzzyzzzzE7zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwZ7zzzzxkbErzzzzzzzzxg7zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzxcDzzzB/NiXfzzzzzx4M5zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwUcjzzarzzxNZ3zzw8CFDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzykTEX27zzzyFA0Py3zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwY3x0zzzzzDckTzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzy+Vn27zxzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzxz/AF5hN2T8888888888888888888888888888888888888888888888888888888888888888882U8888888888888888888888888888888888888888888888pN888888888888888888888888888888+f8888888888888888888888G88888888888888888CX888888888888888888C8N888888888D88888888888888888888888X88888888888888888CX8B5yjRNNyUNNNhDe+/HAorUs28fpXqD8iI8oEDCpBOjVdiUx8GndO8X82V88888888888888CXGHESxqAAFbMD30DHITyAN6AWDLqMIYD8jP8KgGjEz2Y+XS8+J7xs8IXSp+88888888888888CX6CNjW8qHj8SCTTAZzA+A+aAgneDNvFD88n4nYs99t8V8Jq8D+W99YiPqi888888888888888CX/Q/H2ygKDhhRDUCw24jBS8elAzAmz+D88WtBAk88D/A8rU8r+gA8j8M7A+888888888888885M8MEAeG++Ol+++HSmHq8mIFJiCcpQHNoB8u8+860KVIe8VQ8pyIpyq8J8VJ8888888888888888888888888888888888888888888888888Wq888888888888888888888888888888888888888888888888888888U88888888888888888FF88888k888888888888888888888888888888888888888888888888UxN888888888888888888888AQ8888888888888888888888888888888888888888888888888sXrLZ8888888888888884yuq8888888888888888888888888888888888888888888888888888IwEiCsCY88888s63cfhw888888888888888888888888888888888888888888888888888888888HSeXtba0esEAAyA88888888888888888888888888888888888888888888888888888888888888888sMc8888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888888//xABEEQABAwICAwwGCAUEAwAAAAABAAIDBBEhMQUSQRATFCIyUWFxgZGx8DNQUqHB0QYVIDA0QOHxJDVCU2IjJWByFoCQ/9oACAECAQE/AP8A4TXtmtdvP9y57W8oo1UQ2oVkR2ps8bsneu3vbGLuW/Szm0eA502iBxkcSuCRDYuDNHJJCDZW5G/X5+CEl8DhuucGi5Ula0YMxRfPNl8vehRSHM2XAOlOoCBxXe5SQPj5QUc74zxT8lDUtlwOfrhzgwaxTGuqn6zsh5t801oaLDcBDhh9gkDEqSrudWIXQppJTrSlR08bMh9qaka/FuBTmmM2OxUtRvg1XZ+t6x5e4RN88yijEbQ0browccijvrelGdwzYUZ5TyWLeJJfSlRxtjFmj7mogErcMwmOMbr9Ka4OFx61JtiqUb5MXnzf7skDEp1XE3ahWx3sUyVsnJP2a2PVcHDb4qifrMtzetZzaNyoBgT91PVtjwbiU2KWoxecEyjjaMcVwaL2UaNmbcEwvbxX9/2Kxt4r8yoDi4etanGIqgOBHV9zNUOkOpEoKQM4z8/uar0TlQDlHq9ayN1mEKjdqyap2j7bpGMxcU50lTxWYNUcbIRb7qtcBHbn/dUkZbHjt9bTsMUlxz389SikEjQ4fYLgM05odmhDGDfV3JYxIwtdtVPXFkvBanB+w7HDn6+j7e+Ayb2NmfwTnBou5NYal+u7k+t6iEStttUMzoHWKY9rxdu7pDWFM9zcwLjsx+Cpp2zxNlbkRf7GkaBtbFq5OGIPMVR6ZlpH8HrRlt+fOOlRSslbrxm4PN9ivr2UgsMXnIc/6Khp3Qx60nLdi7r/AEyRia43dj65npmyjpW9zQG4Ta4jBwTaxrsmk9icDKxzSLXC+jlVdrqZ2YxHgfn2/Z0loyOtZfJwyKPC9Fy2uWn3H4KD6TSCwlZrdIw+a/8AJ4djD7l9cVda7e6WO3TzfBaP0WKdxmmOtIdp2dXr0gHd300OkHPGxx7sbppDhcfZmgjmbqSAEdK01oyCkjbJFmTbssSqPQNO1jXygl2F75d3Qo4mRN1WCw6P+A6dj3usdbbY+75rQNXv9NqOzZh8vl2J0sbeU4BcLg9sd4TZ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";

const DEMO_STOK = [
  { id: 1, ad: "Ayçiçek Yağı", kategori: "İçecek", birim: "lt", mevcut: 24, esik: 10, birimFiyat: 85.50, aktif: true },
  { id: 2, ad: "Pirinç Baldo", kategori: "Kuru Gıda", birim: "kg", mevcut: 9, esik: 10, birimFiyat: 42.90, aktif: true },
  { id: 3, ad: "Tavuk Göğüs", kategori: "Beyaz Et", birim: "kg", mevcut: 2, esik: 5, birimFiyat: 129.00, aktif: true },
];

const DEMO_MUSTERI_SIPARISLERI = [
  { id: 1, tarih: "2025-11-15", musteri: "ABC İnşaat", musteriId: 1, ogun: "Kahvaltı", porsiyon: 80, menuAd: "Menemen, Peynir, Zeytin, Ekmek, Çay", durum: "Beklemede" },
  { id: 2, tarih: "2025-11-15", musteri: "ABC İnşaat", musteriId: 1, ogun: "Öğle", porsiyon: 250, menuAd: "Mercimek Çorbası, Tavuk Sote, Pirinç Pilavı, Salata", durum: "Onaylandı" },
  { id: 3, tarih: "2025-11-15", musteri: "XYZ Hastanesi", musteriId: 2, ogun: "Öğle", porsiyon: 350, menuAd: "Mercimek Çorbası, Tavuk Sote, Pirinç Pilavı, Salata", durum: "Beklemede" },
  { id: 4, tarih: "2025-11-15", musteri: "XYZ Hastanesi", musteriId: 2, ogun: "Akşam", porsiyon: 200, menuAd: "Ezogelin Çorbası, Köfte, Makarna, Cacık", durum: "Onaylandı" },
  { id: 5, tarih: "2025-11-16", musteri: "123 Okul", musteriId: 3, ogun: "Öğle", porsiyon: 180, menuAd: "Tarhana Çorbası, İzmir Köfte, Bulgur Pilavı, Turşu", durum: "Onaylandı" },
  { id: 6, tarih: "2025-11-16", musteri: "DEF Fabrika", musteriId: 4, ogun: "Öğle", porsiyon: 180, menuAd: "Tarhana Çorbası, İzmir Köfte, Bulgur Pilavı, Turşu", durum: "Beklemede" },
  { id: 7, tarih: "2025-11-16", musteri: "ABC İnşaat", musteriId: 1, ogun: "Akşam", porsiyon: 150, menuAd: "Mercimek Çorbası, Tavuk Sote, Makarna, Salata", durum: "Onaylandı" },
  { id: 8, tarih: "2025-11-17", musteri: "ABC İnşaat", musteriId: 1, ogun: "Öğle", porsiyon: 250, menuAd: "Ezogelin Çorbası, Köfte, Pirinç Pilavı, Cacık", durum: "Onaylandı" },
  { id: 9, tarih: "2025-11-17", musteri: "123 Okul", musteriId: 3, ogun: "Öğle", porsiyon: 300, menuAd: "Ezogelin Çorbası, Köfte, Pirinç Pilavı, Cacık", durum: "Beklemede" },
  { id: 10, tarih: "2025-11-18", musteri: "XYZ Hastanesi", musteriId: 2, ogun: "Öğle", porsiyon: 400, menuAd: "Mercimek Çorbası, İzmir Köfte, Pirinç Pilavı, Turşu", durum: "Beklemede" },
];

const DEMO_SIPARISLER = [
  { 
    id: 1, 
    tarih: "2025-11-14", 
    teslimTarihi: "2025-11-18", 
    tedarikci: "Beyaz Et Tedarik A.Ş.", 
    tedarikciId: 1, 
    urun: "Tavuk Göğüs", 
    miktar: 52, 
    birim: "kg", 
    birimFiyat: 125, 
    toplam: 6500, 
    planlananMiktar: 50,
    planlananBirimFiyat: 120,
    planlananToplam: 6000,
    faturaNo: "FTR2025001234",
    notlar: "Fatura: FTR2025001234 | Tarih: 2025-11-18 | Tutar: ₺6.500,00", 
    durum: "Teslim Alındı" 
  },
  { 
    id: 2, 
    tarih: "2025-11-13", 
    teslimTarihi: "2025-11-16", 
    tedarikci: "Sebze Meyve Hali", 
    tedarikciId: 2, 
    urun: "Domates", 
    miktar: 100, 
    birim: "kg", 
    birimFiyat: 25, 
    toplam: 2500, 
    planlananMiktar: 100,
    planlananBirimFiyat: 25,
    planlananToplam: 2500,
    notlar: "", 
    durum: "Onaylandı" 
  },
  { 
    id: 3, 
    tarih: "2025-11-12", 
    teslimTarihi: "2025-11-20", 
    tedarikci: "Baklagil Dünyası", 
    tedarikciId: 3, 
    urun: "Kırmızı Mercimek", 
    miktar: 195, 
    birim: "kg", 
    birimFiyat: 32, 
    toplam: 6240, 
    planlananMiktar: 200,
    planlananBirimFiyat: 35,
    planlananToplam: 7000,
    faturaNo: "FTR2025001235",
    notlar: "Fatura: FTR2025001235 | Tarih: 2025-11-20 | Tutar: ₺6.240,00", 
    durum: "Teslim Alındı" 
  },
];

const DEMO_AYLIK_MENU = [
  { id: 1, tarih: "2025-11-15", ogun: "Kahvaltı", yemekler: "Menemen, Peynir, Zeytin, Ekmek, Çay" },
  { id: 2, tarih: "2025-11-15", ogun: "Öğle", yemekler: "Mercimek Çorbası, Tavuk Sote, Pirinç Pilavı, Salata, Ayran" },
  { id: 3, tarih: "2025-11-15", ogun: "Akşam", yemekler: "Ezogelin Çorbası, Köfte, Makarna, Cacık" },
  { id: 4, tarih: "2025-11-16", ogun: "Kahvaltı", yemekler: "Yumurta, Sucuk, Peynir, Domates, Çay" },
  { id: 5, tarih: "2025-11-16", ogun: "Öğle", yemekler: "Tarhana Çorbası, İzmir Köfte, Bulgur Pilavı, Turşu, Ayran" },
  { id: 6, tarih: "2025-11-16", ogun: "Akşam", yemekler: "Mercimek Çorbası, Tavuk Sote, Makarna, Salata" },
  { id: 7, tarih: "2025-11-17", ogun: "Öğle", yemekler: "Ezogelin Çorbası, Köfte, Pirinç Pilavı, Cacık, Ayran" },
  { id: 8, tarih: "2025-11-17", ogun: "Akşam", yemekler: "Tarhana Çorbası, Tavuk Sote, Bulgur Pilavı, Salata" },
  { id: 9, tarih: "2025-11-18", ogun: "Öğle", yemekler: "Mercimek Çorbası, İzmir Köfte, Pirinç Pilavı, Turşu, Ayran" },
  { id: 10, tarih: "2025-11-18", ogun: "Akşam", yemekler: "Ezogelin Çorbası, Tavuk Sote, Makarna, Cacık" },
];

const DEMO_MUSTERILER = [
  { id: 1, ad: "ABC İnşaat", vkn: "1234567890", yetkili: "Ahmet Yılmaz", telefon: "0532 123 4567", email: "ahmet@abcinsaat.com", adres: "Maslak, İstanbul", aktif: true },
  { id: 2, ad: "XYZ Hastanesi", vkn: "2345678901", yetkili: "Ayşe Demir", telefon: "0543 234 5678", email: "ayse@xyzhastane.com", adres: "Kadıköy, İstanbul", aktif: true },
  { id: 3, ad: "123 Okul", vkn: "3456789012", yetkili: "Mehmet Kaya", telefon: "0555 345 6789", email: "mehmet@123okul.com", adres: "Beşiktaş, İstanbul", aktif: false },
  { id: 4, ad: "DEF Fabrika", vkn: "4567890123", yetkili: "Fatma Arslan", telefon: "0542 987 6543", email: "fatma@deffabrika.com", adres: "Gebze, Kocaeli", aktif: true },
];

const DEMO_TEDARIKCILER = [
  { id: 1, ad: "Beyaz Et Tedarik A.Ş.", vkn: "4567890123", yetkili: "Ali Çelik", telefon: "0212 555 1234", email: "ali@beyazet.com", adres: "Bayrampaşa, İstanbul", kategori: "Et", aktif: true },
  { id: 2, ad: "Sebze Meyve Hali", vkn: "5678901234", yetkili: "Fatma Şahin", telefon: "0216 444 5678", email: "fatma@sebzemeyve.com", adres: "Kartal, İstanbul", kategori: "Hâl", aktif: true },
  { id: 3, ad: "Baklagil Dünyası", vkn: "6789012345", yetkili: "Hasan Özdemir", telefon: "0533 777 8899", email: "hasan@baklagil.com", adres: "Ümraniye, İstanbul", kategori: "Kuru Gıda", aktif: true },
];

const KATEGORILER = ["Tümü", "Kırmızı Et", "Beyaz Et", "Hâl", "Kuru Gıda", "Baharat", "Şarküteri", "İçecek", "Atıştırmalık", "Diğer"];
const CIKIS_NEDENLERI = ['Fire', 'İade', 'Bozulma', 'Transfer', 'Üretim'];

const DEMO_RECETELER = [
  { id: 1, ad: "Mercimek Çorbası", kategori: "Çorba", porsiyon: 10, malzemeler: [{ stokId: 2, miktar: 0.5 }], aciklama: "Geleneksel mercimek çorbası", aktif: true },
  { id: 2, ad: "İzmir Köfte", kategori: "Köfte Yemekleri", porsiyon: 8, malzemeler: [{ stokId: 2, miktar: 1 }], aciklama: "Fırında patatesli köfte", aktif: true },
  { id: 3, ad: "Etli Kuru Fasulye", kategori: "Kurubaklagil Yemekleri", porsiyon: 10, malzemeler: [{ stokId: 2, miktar: 0.8 }], aciklama: "Geleneksel kuru fasulye", aktif: true },
  { id: 4, ad: "Tavuk Sote", kategori: "Tavuk Yemekleri", porsiyon: 8, malzemeler: [{ stokId: 3, miktar: 2 }, { stokId: 4, miktar: 0.5 }], aciklama: "Sebzeli tavuk sote", aktif: true },
  { id: 5, ad: "Karnıyarık", kategori: "Etli Sebze Yemekleri", porsiyon: 8, malzemeler: [{ stokId: 4, miktar: 1.5 }], aciklama: "Patlıcanlı karnıyarık", aktif: true },
  { id: 6, ad: "Kuzu Haşlama", kategori: "Et Yemekleri", porsiyon: 8, malzemeler: [{ stokId: 2, miktar: 2 }], aciklama: "Kuzu etli haşlama", aktif: true },
  { id: 7, ad: "İmam Bayıldı", kategori: "Etsiz Sebze Yemekleri", porsiyon: 8, malzemeler: [{ stokId: 4, miktar: 1 }, { stokId: 5, miktar: 0.3 }], aciklama: "Zeytinyağlı patlıcan", aktif: true },
  { id: 8, ad: "Patates Kızartması", kategori: "Kızartmalar", porsiyon: 8, malzemeler: [{ stokId: 2, miktar: 1.5 }], aciklama: "Çıtır patates kızartması", aktif: true },
  { id: 9, ad: "Levrek Izgara", kategori: "Balık", porsiyon: 6, malzemeler: [{ stokId: 3, miktar: 1.5 }], aciklama: "Fırında levrek", aktif: true },
  { id: 10, ad: "Pirinç Pilavı", kategori: "Pilav, Makarna, Pide, Börek", porsiyon: 10, malzemeler: [{ stokId: 2, miktar: 1 }], aciklama: "Tereyağlı pirinç pilavı", aktif: true },
  { id: 11, ad: "Bulgur Pilavı", kategori: "Garnitürler", porsiyon: 10, malzemeler: [{ stokId: 2, miktar: 1 }], aciklama: "Şehriyeli bulgur pilavı", aktif: true },
  { id: 12, ad: "Çoban Salata", kategori: "Salatalar", porsiyon: 8, malzemeler: [{ stokId: 4, miktar: 0.5 }, { stokId: 5, miktar: 0.2 }], aciklama: "Doğranmış sebze salatası", aktif: true },
  { id: 13, ad: "Sütlaç", kategori: "Tatlılar", porsiyon: 10, malzemeler: [{ stokId: 2, miktar: 0.3 }], aciklama: "Fırında sütlaç", aktif: true },
  { id: 14, ad: "Meyve Tabağı", kategori: "Meyveler", porsiyon: 8, malzemeler: [{ stokId: 4, miktar: 1 }], aciklama: "Mevsim meyveleri", aktif: true },
  { id: 15, ad: "Ayran", kategori: "İçecek", porsiyon: 10, malzemeler: [{ stokId: 2, miktar: 2 }], aciklama: "Soğuk ayran", aktif: true },
  { id: 16, ad: "Beyaz Ekmek", kategori: "Ekmek", porsiyon: 20, malzemeler: [{ stokId: 2, miktar: 2 }], aciklama: "Taze ekmek", aktif: true },
  { id: 17, ad: "Menemen", kategori: "Kahvaltılıklar", porsiyon: 4, malzemeler: [{ stokId: 4, miktar: 0.3 }], aciklama: "Domatesli menemen", aktif: true },
  { id: 18, ad: "Çılbır", kategori: "Yumurta Yemekleri", porsiyon: 4, malzemeler: [{ stokId: 2, miktar: 0.2 }], aciklama: "Yoğurtlu poşe yumurta", aktif: true },
];

const RECETE_KATEGORILERI = [
  "Çorba",
  "Et Yemekleri",
  "Köfte Yemekleri",
  "Etli Sebze Yemekleri",
  "Tavuk Yemekleri",
  "Kurubaklagil Yemekleri",
  "Etsiz Sebze Yemekleri",
  "Kızartmalar",
  "Balık",
  "Pilav, Makarna, Pide, Börek",
  "Garnitürler",
  "Salatalar",
  "Tatlılar",
  "Meyveler",
  "İçecek",
  "Ekmek",
  "Kahvaltılıklar",
  "Yumurta Yemekleri"
];

const formatTL = (value) => new Intl.NumberFormat('tr-TR', { style: 'currency', currency: 'TRY' }).format(value || 0);
const formatTarih = (tarih) => new Date(tarih).toLocaleDateString('tr-TR');

// Giriş Ekranı
function LoginScreen({ onLogin }) {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');

  const handleLogin = () => {
    // Kullanıcı bilgileri
    const users = {
      'yonetici': { password: '123456', role: 'yonetici', name: 'Yönetici' },
      'proje': { password: '123456', role: 'proje', name: 'Proje' },
      'satin_alma': { password: '123456', role: 'satin_alma', name: 'Satın Alma' },
      'cost': { password: '123456', role: 'cost', name: 'Cost Kontrol' }
    };

    const user = users[username];
    if (user && user.password === password) {
      onLogin({ username, role: user.role, name: user.name });
      setError('');
    } else {
      setError('Kullanıcı adı veya şifre hatalı!');
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-50 to-red-50 flex items-center justify-center">
      <div className="bg-white rounded-2xl shadow-2xl p-8 w-96">
        <div className="text-center mb-8">
          <img src={LOGO_BASE64} alt="Lezzetsel Yemek" className="mx-auto mb-4" style={{height: "120px"}} />
          <h2 className="text-2xl font-bold text-gray-800">Lezzetsel ERP</h2>
          <p className="text-gray-500 text-sm mt-2">Giriş Yapın</p>
        </div>
        
        {error && (
          <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4">
            {error}
          </div>
        )}

        <div className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Kullanıcı Adı</label>
            <input
              type="text"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="Kullanıcı adınızı girin"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">Şifre</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
              placeholder="Şifrenizi girin"
            />
          </div>

          <button
            onClick={handleLogin}
            className="w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition font-medium"
          >
            Giriş Yap
          </button>
        </div>

      </div>
    </div>
  );
}

function Header({ sidebarOpen, setSidebarOpen }) {
  return (
    <header className="bg-white border-b sticky top-0 z-50">
      <div className="px-4 py-4 flex items-center gap-3">
        <button onClick={() => setSidebarOpen(!sidebarOpen)} className="p-2 hover:bg-gray-100 rounded-lg">
          <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <img src={LOGO_BASE64} alt="Lezzetsel Yemek" style={{height: "80px"}} />
      </div>
    </header>
  );
}

function Sidebar({ activeTab, setActiveTab, isOpen, setIsOpen }) {
  const tabs = [
    { id: 'anasayfa', label: 'Anasayfa', icon: Home },
    { id: 'uretim', label: 'Üretim Planı', icon: TrendingUp },
    { id: 'depo', label: 'Depo', icon: Package },
    { id: 'siparisler', label: 'Siparişler', icon: ShoppingCart },
    { id: 'satin-alma', label: 'Satın Alma', icon: Truck },
    { id: 'cost-kontrol', label: 'Cost Kontrol', icon: DollarSign },
    { id: 'aylik-menu', label: 'Aylık Menü', icon: Calendar },
    { id: 'receteler', label: 'Reçeteler', icon: BookOpen },
    { id: 'musteriler', label: 'Müşteriler', icon: Users },
    { id: 'tedarikciler', label: 'Tedarikçiler', icon: Building2 },
  ];

  return (
    <>
      {isOpen && <div className="fixed inset-0 bg-black bg-opacity-50 z-40" onClick={() => setIsOpen(false)} />}
      <aside className={`fixed top-0 left-0 h-screen bg-white border-r z-50 transition-transform duration-300 ${isOpen ? 'translate-x-0' : '-translate-x-full'} w-64`}>
        <div className="p-4 border-b flex items-center justify-between">
          <h2 className="font-semibold text-lg">Menü</h2>
          <button onClick={() => setIsOpen(false)} className="p-1 hover:bg-gray-100 rounded">✕</button>
        </div>
        <nav className="p-3">
          <ul className="space-y-1">
            {tabs.map(tab => {
              const Icon = tab.icon;
              return (
                <li key={tab.id}>
                  <button
                    onClick={() => { setActiveTab(tab.id); setIsOpen(false); }}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium ${activeTab === tab.id ? 'bg-blue-600 text-white' : 'hover:bg-gray-100'}`}
                  >
                    <Icon className="w-5 h-5" />
                    <span>{tab.label}</span>
                  </button>
                </li>
              );
            })}
          </ul>
        </nav>
      </aside>
    </>
  );
}

function Anasayfa({ stok, menu, musteriSiparisleri, receteler }) {
  const bugun = new Date().toISOString().slice(0, 10);
  const bugunMenusu = menu.filter(m => m.tarih === bugun);
  
  // Yarın tarihi
  const yarin = new Date();
  yarin.setDate(yarin.getDate() + 1);
  const yarinTarih = yarin.toISOString().slice(0, 10);
  const yarinMenusu = menu.filter(m => m.tarih === yarinTarih);
  
  // Sadece ONAYLANMIŞ siparişlerin üretim sayıları
  const onaylananSiparisler = musteriSiparisleri.filter(s => s.tarih === bugun && s.durum === 'Onaylandı');
  
  // Bugün ve yarın için bekleyen siparişler
  const bugunBekleyenler = musteriSiparisleri.filter(s => s.tarih === bugun && s.durum === 'Beklemede');
  const yarinBekleyenler = musteriSiparisleri.filter(s => s.tarih === yarinTarih && s.durum === 'Beklemede');
  const toplamBekleyen = bugunBekleyenler.length + yarinBekleyenler.length;
  
  // Yarın için onaylanmış siparişler
  const yarinOnaylananSiparisler = musteriSiparisleri.filter(s => s.tarih === yarinTarih && s.durum === 'Onaylandı');
  
  // Yarın için gereken malzemeleri hesapla
  const yarinIhtiyaclar = {};
  yarinOnaylananSiparisler.forEach(siparis => {
    // Bu öğün için menüdeki yemekleri bul
    const ogunMenusu = yarinMenusu.find(m => m.ogun === siparis.ogun);
    if (ogunMenusu) {
      // Menüdeki her yemek için reçeteyi bul
      ogunMenusu.yemekler.split(',').forEach(yemekAd => {
        const recete = receteler.find(r => r.ad.trim().toLowerCase() === yemekAd.trim().toLowerCase() && r.aktif);
        if (recete) {
          // Reçetedeki malzemeleri hesapla
          recete.malzemeler.forEach(malzeme => {
            const porsiyon = siparis.porsiyon;
            const recetePorsiyon = recete.porsiyon || 1;
            const gerekliMiktar = (malzeme.miktar / recetePorsiyon) * porsiyon;
            
            if (yarinIhtiyaclar[malzeme.stokId]) {
              yarinIhtiyaclar[malzeme.stokId] += gerekliMiktar;
            } else {
              yarinIhtiyaclar[malzeme.stokId] = gerekliMiktar;
            }
          });
        }
      });
    }
  });
  
  // Eksik olan malzemeleri bul
  const eksikMalzemeler = [];
  Object.keys(yarinIhtiyaclar).forEach(stokId => {
    const stokItem = stok.find(s => s.id === Number(stokId));
    const gerekli = yarinIhtiyaclar[stokId];
    if (stokItem && stokItem.mevcut < gerekli) {
      eksikMalzemeler.push({
        ...stokItem,
        gerekli: gerekli,
        eksik: gerekli - stokItem.mevcut
      });
    }
  });
  
  // Depo toplam değeri (mevcut stok × birim fiyat)
  const depoToplam = stok
    .filter(s => s.aktif)
    .reduce((sum, item) => sum + (item.mevcut * item.birimFiyat), 0);
  
  // Günlük toplam porsiyon (gelir tahmini için - porsiyon başı ortalama 50 TL)
  const toplamPorsiyon = onaylananSiparisler.reduce((sum, s) => sum + s.porsiyon, 0);
  const tahminiGelir = toplamPorsiyon * 50; // Porsiyon başı ortalama fiyat
  
  // Günlük maliyet tahmini (porsiyon başı maliyet ~25 TL)
  const tahminiMaliyet = toplamPorsiyon * 25;
  
  // Kar/Zarar
  const karZarar = tahminiGelir - tahminiMaliyet;
  
  // Her öğün için ONAYLANMIŞ porsiyon sayısını hesapla
  const getOgunPorsiyon = (ogun) => {
    return onaylananSiparisler
      .filter(s => s.ogun === ogun)
      .reduce((sum, s) => sum + s.porsiyon, 0);
  };
  
  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="bg-gradient-to-r from-blue-600 to-blue-700 rounded-2xl p-6 text-white">
        <h2 className="text-xl font-bold">Hoş Geldiniz! 👋</h2>
      </div>

      {/* Finansal İstatistikler */}
      <div className="grid grid-cols-4 gap-3">
        <div className="bg-white border p-3 text-center">
          <DollarSign className="w-5 h-5 text-blue-600 mx-auto mb-2" />
          <p className="text-xs text-gray-600 mb-1">Depo Değeri</p>
          <p className="text-lg font-bold text-blue-600">{formatTL(depoToplam)}</p>
        </div>

        <div className="bg-white border p-3 text-center">
          <TrendingUp className="w-5 h-5 text-green-600 mx-auto mb-2" />
          <p className="text-xs text-gray-600 mb-1">Tahmini Gelir</p>
          <p className="text-lg font-bold text-green-600">{formatTL(tahminiGelir)}</p>
        </div>

        <div className="bg-white border p-3 text-center">
          <Package className="w-5 h-5 text-orange-600 mx-auto mb-2" />
          <p className="text-xs text-gray-600 mb-1">Tahmini Maliyet</p>
          <p className="text-lg font-bold text-orange-600">{formatTL(tahminiMaliyet)}</p>
        </div>

        <div className="bg-white border p-3 text-center">
          <TrendingUp className="w-5 h-5 text-purple-600 mx-auto mb-2" />
          <p className="text-xs text-gray-600 mb-1">Kar/Zarar</p>
          <p className={`text-lg font-bold ${karZarar >= 0 ? 'text-green-600' : 'text-red-600'}`}>
            {formatTL(karZarar)}
          </p>
        </div>
      </div>

      {/* Onaylanmamış Sipariş Uyarısı - Sadece Bugün ve Yarın */}
      {toplamBekleyen > 0 && (
        <div className="bg-orange-50 border-l-4 border-orange-500 p-4 rounded">
          <div className="flex items-start gap-3">
            <AlertTriangle className="w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0" />
            <div className="flex-1">
              <h3 className="font-semibold text-orange-900 mb-1">
                ⚠️ Onaylanmamış Müşteri Siparişleri
              </h3>
              <p className="text-sm text-orange-800 mb-2">
                {bugunBekleyenler.length > 0 && (
                  <span>
                    <strong>Bugün:</strong> {bugunBekleyenler.length} sipariş bekliyor
                  </span>
                )}
                {bugunBekleyenler.length > 0 && yarinBekleyenler.length > 0 && <span className="mx-2">•</span>}
                {yarinBekleyenler.length > 0 && (
                  <span>
                    <strong>Yarın:</strong> {yarinBekleyenler.length} sipariş bekliyor
                  </span>
                )}
              </p>
              <div className="text-xs text-orange-700">
                Üretim Planı sayfasından siparişleri onaylayabilirsiniz.
              </div>
            </div>
          </div>
        </div>
      )}

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className="bg-white rounded-xl border p-6">
          <h3 className="text-lg font-semibold mb-4">Bugünün Menüsü</h3>
          {bugunMenusu.length === 0 ? (
            <p className="text-gray-500">Bugün için menü yok</p>
          ) : (
            <div className="grid grid-cols-3 gap-3">
              {bugunMenusu.map(m => {
                const porsiyon = getOgunPorsiyon(m.ogun);
                return (
                  <div key={m.id} className="p-3 bg-amber-50 rounded-lg">
                    <div className="flex items-center justify-between mb-2">
                      <h4 className="font-bold text-sm">{m.ogun}</h4>
                      <span className="text-lg font-bold text-green-600">{porsiyon}</span>
                    </div>
                    <ul className="text-xs text-gray-600 space-y-1">
                      {m.yemekler.split(',').map((yemek, idx) => (
                        <li key={idx}>• {yemek.trim()}</li>
                      ))}
                    </ul>
                  </div>
                );
              })}
            </div>
          )}
        </div>

        <div className="bg-white rounded-xl border p-6">
          <h3 className="text-lg font-semibold mb-4">Yarın İçin Eksik Malzemeler</h3>
          {eksikMalzemeler.length === 0 ? (
            <div className="text-center py-8">
              <p className="text-green-600 font-medium mb-1">✓ Tüm malzemeler yeterli</p>
              <p className="text-sm text-gray-500">Yarının üretimi için stoklar hazır</p>
            </div>
          ) : (
            <div className="space-y-2">
              {eksikMalzemeler.map(item => (
                <div key={item.id} className="p-3 bg-red-50 rounded-lg border-l-2 border-red-500">
                  <p className="font-medium text-red-900">{item.ad}</p>
                  <div className="text-sm text-red-700 mt-1 space-y-0.5">
                    <p>Mevcut: <strong>{item.mevcut.toFixed(2)} {item.birim}</strong></p>
                    <p>Gerekli: <strong>{item.gerekli.toFixed(2)} {item.birim}</strong></p>
                    <p className="text-red-600 font-semibold">Eksik: {item.eksik.toFixed(2)} {item.birim}</p>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

function SatinAlma({ stok, setStok, siparisler, setSiparisler }) {
  const [showFaturaModal, setShowFaturaModal] = useState(false);
  const [secilenSiparis, setSecilenSiparis] = useState(null);
  const [faturaNo, setFaturaNo] = useState('');
  const [teslimTarihi, setTeslimTarihi] = useState(new Date().toISOString().slice(0, 10));

  // Sadece "Onaylandı" durumundaki siparişleri filtrele
  const onaylananSiparisler = siparisler.filter(s => s.durum === 'Onaylandı');

  // Fatura modalını aç
  const faturaModalAc = (siparis) => {
    setSecilenSiparis(siparis);
    setFaturaNo('');
    setTeslimTarihi(new Date().toISOString().slice(0, 10));
    setShowFaturaModal(true);
  };

  // Stok girişi yap ve siparişi tamamla
  const stokGirisiYap = () => {
    console.log('🔵 stokGirisiYap fonksiyonu çağrıldı!');
    console.log('Fatura No:', faturaNo);
    console.log('Seçilen Sipariş:', secilenSiparis);
    
    if (!faturaNo.trim()) {
      alert('Fatura numarası girmelisiniz!');
      return;
    }

    if (secilenSiparis.miktar <= 0) {
      alert('Miktar 0\'dan büyük olmalıdır!');
      return;
    }

    if (secilenSiparis.birimFiyat <= 0) {
      alert('Birim fiyat 0\'dan büyük olmalıdır!');
      return;
    }

    // Yeni toplam tutarı hesapla
    const yeniToplam = secilenSiparis.miktar * secilenSiparis.birimFiyat;

    // Debug: Hangi ürünü arıyoruz
    console.log('Aranan ürün:', secilenSiparis.urun);
    console.log('Mevcut stok listesi:', stok.map(s => ({ id: s.id, ad: s.ad, mevcut: s.mevcut })));

    // Stok güncelle - ürünü hem ad hem de birim ile eşleştir
    let urunBulundu = false;
    const yeniStok = stok.map(item => {
      const adEslesme = item.ad.trim().toLowerCase() === secilenSiparis.urun.trim().toLowerCase();
      
      if (adEslesme) {
        urunBulundu = true;
        console.log('✅ Ürün bulundu:', item.ad, 'Eski miktar:', item.mevcut, 'Eklenecek:', secilenSiparis.miktar);
        return {
          ...item,
          mevcut: Number(item.mevcut) + Number(secilenSiparis.miktar),
          birimFiyat: Number(secilenSiparis.birimFiyat)
        };
      }
      return item;
    });

    if (!urunBulundu) {
      alert(`⚠️ HATA: "${secilenSiparis.urun}" adlı ürün stok kartlarında bulunamadı!\n\nLütfen önce Depo sayfasından bu ürünü stok kartına ekleyin.`);
      return;
    }

    console.log('Güncellenmiş stok:', yeniStok.find(s => s.ad.trim().toLowerCase() === secilenSiparis.urun.trim().toLowerCase()));

    // Sipariş durumunu güncelle
    const yeniSiparisler = siparisler.map(s => {
      if (s.id === secilenSiparis.id) {
        return {
          ...s,
          durum: 'Teslim Alındı',
          faturaNo: faturaNo,
          teslimTarihi: teslimTarihi,
          miktar: Number(secilenSiparis.miktar),
          birimFiyat: Number(secilenSiparis.birimFiyat),
          toplam: yeniToplam,
          notlar: `Fatura: ${faturaNo} | Tarih: ${teslimTarihi} | Tutar: ${formatTL(yeniToplam)}`
        };
      }
      return s;
    });

    console.log('✅ Stok ve sipariş güncellenecek...');
    
    setStok(yeniStok);
    setSiparisler(yeniSiparisler);
    setShowFaturaModal(false);
    setSecilenSiparis(null);
    
    const guncellenenUrun = yeniStok.find(s => s.ad.trim().toLowerCase() === secilenSiparis.urun.trim().toLowerCase());
    
    console.log('🎉 İşlem tamamlandı!');
    alert(`✅ Stok girişi başarılı!\n\n${secilenSiparis.urun}\n+${secilenSiparis.miktar} ${secilenSiparis.birim} eklendi\n\nYeni Stok: ${guncellenenUrun.mevcut} ${secilenSiparis.birim}\nFatura: ${faturaNo}\nTutar: ${formatTL(yeniToplam)}`);
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div>
        <h2 className="text-2xl font-bold">Satın Alma & Stok Girişi</h2>
      </div>

      {/* İstatistikler */}
      <div className="grid grid-cols-3 gap-3">
        <div className="bg-white rounded-lg border p-3">
          <div className="flex items-center gap-2">
            <div className="p-2 bg-blue-100 rounded-lg">
              <Package className="w-4 h-4 text-blue-600" />
            </div>
            <div>
              <p className="text-xs text-gray-600">Bekleyen Sipariş</p>
              <p className="text-lg font-bold">{onaylananSiparisler.length}</p>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-lg border p-3">
          <div className="flex items-center gap-2">
            <div className="p-2 bg-green-100 rounded-lg">
              <ShoppingCart className="w-4 h-4 text-green-600" />
            </div>
            <div>
              <p className="text-xs text-gray-600">Toplam Ürün</p>
              <p className="text-lg font-bold">{new Set(onaylananSiparisler.map(s => s.urun)).size}</p>
            </div>
          </div>
        </div>

        <div className="bg-white rounded-lg border p-3">
          <div className="flex items-center gap-2">
            <div className="p-2 bg-purple-100 rounded-lg">
              <DollarSign className="w-4 h-4 text-purple-600" />
            </div>
            <div>
              <p className="text-xs text-gray-600">Toplam Tutar</p>
              <p className="text-lg font-bold">{formatTL(onaylananSiparisler.reduce((sum, s) => sum + s.toplam, 0))}</p>
            </div>
          </div>
        </div>
      </div>

      {/* Onaylanmış Siparişler Listesi */}
      <div className="bg-white rounded-xl border overflow-hidden">
        <div className="px-6 py-4 bg-gray-50 border-b">
          <h3 className="text-lg font-semibold">Onaylanmış Siparişler ({onaylananSiparisler.length})</h3>
        </div>

        {onaylananSiparisler.length === 0 ? (
          <div className="text-center py-16 text-gray-500">
            <Package className="w-16 h-16 mx-auto mb-4 opacity-30" />
            <h4 className="text-xl font-semibold mb-2">Onaylanmış Sipariş Yok</h4>
            <p className="text-sm">Siparişler sayfasından sipariş oluşturun ve durumunu "Onaylandı" olarak değiştirin</p>
          </div>
        ) : (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead className="bg-gray-50 border-b">
                <tr>
                  <th className="px-4 py-3 text-left text-sm font-semibold">Sipariş Tarihi</th>
                  <th className="px-4 py-3 text-left text-sm font-semibold">Teslim Tarihi</th>
                  <th className="px-4 py-3 text-left text-sm font-semibold">Tedarikçi</th>
                  <th className="px-4 py-3 text-left text-sm font-semibold">Ürün</th>
                  <th className="px-4 py-3 text-center text-sm font-semibold">Miktar</th>
                  <th className="px-4 py-3 text-right text-sm font-semibold">Birim Fiyat</th>
                  <th className="px-4 py-3 text-right text-sm font-semibold">Toplam</th>
                  <th className="px-4 py-3 text-center text-sm font-semibold">İşlem</th>
                </tr>
              </thead>
              <tbody>
                {onaylananSiparisler.map(siparis => (
                  <tr key={siparis.id} className="border-b hover:bg-gray-50">
                    <td className="px-4 py-3 text-sm">{formatTarih(siparis.tarih)}</td>
                    <td className="px-4 py-3 text-sm">
                      <span className="text-blue-600 font-medium">
                        {formatTarih(siparis.teslimTarihi)}
                      </span>
                    </td>
                    <td className="px-4 py-3">
                      <div>
                        <p className="font-medium text-sm">{siparis.tedarikci}</p>
                        {siparis.notlar && (
                          <p className="text-xs text-gray-500 mt-1">{siparis.notlar}</p>
                        )}
                      </div>
                    </td>
                    <td className="px-4 py-3">
                      <span className="font-semibold">{siparis.urun}</span>
                    </td>
                    <td className="px-4 py-3 text-center">
                      <span className="font-bold text-lg text-blue-600">
                        {siparis.miktar} {siparis.birim}
                      </span>
                    </td>
                    <td className="px-4 py-3 text-right text-sm">
                      {formatTL(siparis.birimFiyat)}
                    </td>
                    <td className="px-4 py-3 text-right">
                      <span className="font-bold text-green-600">
                        {formatTL(siparis.toplam)}
                      </span>
                    </td>
                    <td className="px-4 py-3 text-center">
                      <button
                        onClick={() => faturaModalAc(siparis)}
                        className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium text-sm flex items-center gap-2 mx-auto"
                      >
                        <FileText className="w-4 h-4" />
                        Teslim Al
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>

      {/* Fatura Modal */}
      {showFaturaModal && secilenSiparis && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold">📄 Sipariş Teslim Alma</h3>
              <button onClick={() => setShowFaturaModal(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                <X className="w-5 h-5" />
              </button>
            </div>

            {/* Sipariş Özeti */}
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border-2 border-blue-200">
              <h4 className="font-semibold text-lg mb-4 text-blue-900">Sipariş Bilgileri</h4>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-gray-600 mb-1">Tedarikçi</p>
                  <p className="font-semibold text-gray-900">{secilenSiparis.tedarikci}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-600 mb-1">Ürün</p>
                  <p className="font-semibold text-gray-900">{secilenSiparis.urun}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-600 mb-1">Sipariş Edilen</p>
                  <p className="font-bold text-blue-600">
                    {secilenSiparis.miktar} {secilenSiparis.birim}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-gray-600 mb-1">Sipariş Tutarı</p>
                  <p className="font-bold text-blue-600">
                    {formatTL(secilenSiparis.toplam)}
                  </p>
                </div>
              </div>
            </div>

            {/* Fatura Bilgileri */}
            <div className="space-y-4 mb-6">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-2">
                    Fatura Numarası *
                  </label>
                  <input
                    type="text"
                    value={faturaNo}
                    onChange={(e) => setFaturaNo(e.target.value)}
                    placeholder="Örn: FTR2025001234"
                    className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-semibold"
                    autoFocus
                  />
                  <p className="text-xs text-gray-500 mt-1">Tire olmadan giriniz</p>
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2">
                    Fatura Tarihi *
                  </label>
                  <input
                    type="date"
                    value={teslimTarihi}
                    onChange={(e) => setTeslimTarihi(e.target.value)}
                    className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-2">
                    Teslim Alınan Miktar *
                  </label>
                  <div className="flex gap-2">
                    <input
                      type="number"
                      value={secilenSiparis.miktar}
                      onChange={(e) => setSecilenSiparis({...secilenSiparis, miktar: Number(e.target.value)})}
                      min="0"
                      step="0.1"
                      className="flex-1 px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-bold text-center"
                    />
                    <div className="px-4 py-3 bg-gray-100 border-2 border-gray-300 rounded-lg font-semibold flex items-center">
                      {secilenSiparis.birim}
                    </div>
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2">
                    Birim Fiyat (₺) *
                  </label>
                  <input
                    type="number"
                    value={secilenSiparis.birimFiyat}
                    onChange={(e) => setSecilenSiparis({...secilenSiparis, birimFiyat: Number(e.target.value)})}
                    min="0"
                    step="0.01"
                    className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-bold text-right"
                  />
                </div>
              </div>

              {/* Toplam Hesaplama */}
              <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border-2 border-green-300">
                <div className="flex justify-between items-center">
                  <div>
                    <p className="text-sm text-green-800 font-medium">Fatura Toplam Tutarı</p>
                    <p className="text-xs text-green-600 mt-1">
                      {secilenSiparis.miktar} {secilenSiparis.birim} × {formatTL(secilenSiparis.birimFiyat)}
                    </p>
                  </div>
                  <p className="text-3xl font-bold text-green-700">
                    {formatTL(secilenSiparis.miktar * secilenSiparis.birimFiyat)}
                  </p>
                </div>
              </div>
            </div>

            {/* Butonlar */}
            <div className="flex gap-4">
              <button
                onClick={() => {
                  console.log('İptal butonuna tıklandı');
                  setShowFaturaModal(false);
                }}
                className="flex-1 px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-semibold"
              >
                İptal
              </button>
              <button
                onClick={() => {
                  const isDisabled = !faturaNo.trim() || secilenSiparis?.miktar <= 0 || secilenSiparis?.birimFiyat <= 0;
                  
                  if (isDisabled) {
                    const nedenler = [];
                    if (!faturaNo.trim()) nedenler.push('• Fatura numarası girilmemiş');
                    if (secilenSiparis?.miktar <= 0) nedenler.push('• Miktar 0\'dan büyük olmalı');
                    if (secilenSiparis?.birimFiyat <= 0) nedenler.push('• Birim fiyat 0\'dan büyük olmalı');
                    alert('⚠️ Stok girişi yapılamıyor!\n\nLütfen önce:\n' + nedenler.join('\n'));
                    return;
                  }
                  
                  console.log('🔵 Teslim Al butonuna tıklandı');
                  console.log('Fatura No:', faturaNo);
                  console.log('Miktar:', secilenSiparis?.miktar);
                  console.log('Birim Fiyat:', secilenSiparis?.birimFiyat);
                  stokGirisiYap();
                }}
                className={`flex-1 px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors ${
                  !faturaNo.trim() || secilenSiparis?.miktar <= 0 || secilenSiparis?.birimFiyat <= 0
                    ? 'bg-gray-300 cursor-not-allowed'
                    : 'bg-green-600 text-white hover:bg-green-700'
                }`}
              >
                <FileText className="w-5 h-5" />
                Teslim Al ve Stok Gir
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function Receteler({ receteler, setReceteler, stok }) {
  const [q, setQ] = useState('');
  const [kat, setKat] = useState('Tümü');
  const [showYeni, setShowYeni] = useState(false);
  const [showDetay, setShowDetay] = useState(null);
  const [yeniForm, setYeniForm] = useState({
    ad: '',
    kategori: 'Çorba',
    porsiyon: 1,
    malzemeler: [{ stokId: '', miktar: 0 }],
    aciklama: ''
  });

  const filtreliReceteler = useMemo(() => {
    let sonuc = receteler.filter(r => r.aktif);
    if (q) sonuc = sonuc.filter(r => r.ad.toLowerCase().includes(q.toLowerCase()));
    if (kat !== 'Tümü') sonuc = sonuc.filter(r => r.kategori === kat);
    return sonuc;
  }, [receteler, q, kat]);

  const yeniEkle = async () => {
    if (!yeniForm.ad || yeniForm.malzemeler.filter(m => m.stokId && m.miktar > 0).length === 0) {
      alert('Reçete adı ve en az bir malzeme gerekli!');
      return;
    }

    const yeni = {
      id: Math.max(0, ...receteler.map(r => r.id)) + 1,
      ...yeniForm,
      porsiyon: Number(yeniForm.porsiyon),
      malzemeler: yeniForm.malzemeler.filter(m => m.stokId && m.miktar > 0).map(m => ({ stokId: Number(m.stokId), miktar: Number(m.miktar) })),
      aktif: true
    };

   // Supabase'e kaydet
try {
  const { data, error } = await supabase
    .from('receteler')
    .insert([{
      ad: form.ad,
      kategori: form.kategori,
      porsiyon: Number(form.porsiyon) || 1,
      hazirlama_suresi: Number(form.hazirlamaSuresi) || 0,
      maliyet: malzemeler.reduce((t, m) => t + (m.miktar * m.birimFiyat), 0),
      malzemeler: malzemeler,
      notlar: form.notlar || '',
      aktif: true
    }])
    .select();

  if (error) throw error;

  setReceteler([...receteler, data[0]]);
  localStorage.setItem('lezzetsel_receteler', JSON.stringify([...receteler, data[0]]));
  setForm({ ad: '', kategori: 'Ana Yemek', porsiyon: 1, hazirlamaSuresi: 30, notlar: '' });
  setMalzemeler([]);
  setShowYeniRecete(false);
  alert('✅ Reçete eklendi!');
} catch (err) {
  console.error('Reçete ekleme hatası:', err);
  alert('❌ Hata: ' + err.message);
}


  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between">
        <div>
          <h2 className="text-2xl font-bold">Reçeteler</h2>
        </div>
        <button onClick={() => setShowYeni(true)} className="px-4 py-2 bg-blue-600 text-white rounded-lg">+ Yeni Reçete</button>
      </div>

      <div className="bg-white rounded-xl border p-6">
        <div className="grid grid-cols-12 gap-4">
          <input type="text" placeholder="Ara..." value={q} onChange={(e) => setQ(e.target.value)} className="col-span-8 px-3 py-2 border rounded-lg" />
          <select value={kat} onChange={(e) => setKat(e.target.value)} className="col-span-4 px-3 py-2 border rounded-lg">
            <option value="Tümü">Tümü</option>
            {RECETE_KATEGORILERI.map(k => <option key={k} value={k}>{k}</option>)}
          </select>
        </div>
      </div>

      {/* Reçete kategorilerine göre gruplandır */}
      {RECETE_KATEGORILERI.map(kategori => {
        const kategoriReceteler = filtreliReceteler.filter(r => r.kategori === kategori);
        if (kategoriReceteler.length === 0) return null;
        
        return (
          <div key={kategori}>
            <h3 className="text-lg font-semibold mb-3 text-gray-700">{kategori} ({kategoriReceteler.length})</h3>
            <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 mb-6">
              {kategoriReceteler.map(recete => {
                // Reçete maliyetini hesapla
                const maliyet = recete.malzemeler.reduce((toplam, m) => {
                  const stokItem = stok.find(s => s.id === m.stokId);
                  return toplam + (m.miktar * (stokItem?.birimFiyat || 0));
                }, 0);
                
                return (
                  <div key={recete.id} className="p-2 bg-slate-50 hover:bg-slate-100 rounded-lg shadow-sm transition-all border border-slate-200">
                    <div className="flex items-start justify-between mb-1">
                      <div className="flex-1 min-w-0">
                        <h4 className="font-bold text-xs truncate text-gray-800">{recete.ad}</h4>
                      </div>
                      <span className="text-xs font-bold text-green-600 ml-1">{formatTL(maliyet)}</span>
                    </div>
                    {recete.aciklama && <p className="text-[10px] text-gray-600 mb-1 italic line-clamp-1">{recete.aciklama}</p>}
                    <ul className="text-[10px] text-gray-600 space-y-0.5 mb-2">
                      {recete.malzemeler.slice(0, 3).map((m, i) => {
                        const stokItem = stok.find(s => s.id === m.stokId);
                        return (
                          <li key={i} className="truncate">• {stokItem?.ad || 'Bilinmeyen'} {m.miktar} {stokItem?.birim}</li>
                        );
                      })}
                      {recete.malzemeler.length > 3 && (
                        <li className="text-gray-400 italic">+{recete.malzemeler.length - 3} daha...</li>
                      )}
                    </ul>
                    <button 
                      onClick={() => setShowDetay(recete)} 
                      className="w-full px-1.5 py-1 border border-slate-300 rounded text-[10px] hover:bg-white transition-colors"
                    >
                      Detay
                    </button>
                  </div>
                );
              })}
            </div>
          </div>
        );
      })}

      {showYeni && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h3 className="text-xl font-bold mb-4">Yeni Reçete</h3>
            <div className="space-y-4">
              <input type="text" placeholder="Reçete Adı" value={yeniForm.ad} onChange={(e) => setYeniForm({...yeniForm, ad: e.target.value})} className="w-full px-3 py-2 border rounded-lg" />
              <div className="grid grid-cols-2 gap-3">
                <select value={yeniForm.kategori} onChange={(e) => setYeniForm({...yeniForm, kategori: e.target.value})} className="px-3 py-2 border rounded-lg">
                  {RECETE_KATEGORILERI.map(k => <option key={k} value={k}>{k}</option>)}
                </select>
                <input type="number" placeholder="Porsiyon" value={yeniForm.porsiyon} onChange={(e) => setYeniForm({...yeniForm, porsiyon: e.target.value})} className="px-3 py-2 border rounded-lg" />
              </div>
              <textarea placeholder="Açıklama" value={yeniForm.aciklama} onChange={(e) => setYeniForm({...yeniForm, aciklama: e.target.value})} className="w-full px-3 py-2 border rounded-lg" rows={2} />
              
              <div>
                <div className="flex justify-between items-center mb-2">
                  <h4 className="font-semibold">Malzemeler</h4>
                  <button onClick={() => setYeniForm({...yeniForm, malzemeler: [...yeniForm.malzemeler, { stokId: '', miktar: 0 }]})} className="px-3 py-1 bg-green-600 text-white rounded text-sm">+ Ekle</button>
                </div>
                {yeniForm.malzemeler.map((m, i) => (
                  <div key={i} className="grid grid-cols-12 gap-2 mb-2">
                    <select value={m.stokId} onChange={(e) => { const y = [...yeniForm.malzemeler]; y[i].stokId = e.target.value; setYeniForm({...yeniForm, malzemeler: y}); }} className="col-span-7 px-3 py-2 border rounded-lg">
                      <option value="">Malzeme</option>
                      {stok.filter(s => s.aktif).map(s => <option key={s.id} value={s.id}>{s.ad}</option>)}
                    </select>
                    <input type="number" placeholder="Miktar" value={m.miktar} onChange={(e) => { const y = [...yeniForm.malzemeler]; y[i].miktar = e.target.value; setYeniForm({...yeniForm, malzemeler: y}); }} className="col-span-4 px-3 py-2 border rounded-lg" />
                    <button onClick={() => setYeniForm({...yeniForm, malzemeler: yeniForm.malzemeler.filter((_, idx) => idx !== i)})} disabled={yeniForm.malzemeler.length === 1} className="col-span-1 p-2 text-red-600"><Trash2 className="w-4 h-4" /></button>
                  </div>
                ))}
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => setShowYeni(false)} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button onClick={yeniEkle} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg">Ekle</button>
            </div>
          </div>
        </div>
      )}

      {showDetay && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full">
            <div className="flex justify-between items-start mb-4">
              <div>
                <h3 className="text-xl font-bold">{showDetay.ad}</h3>
                <span className="text-sm text-gray-600">{showDetay.kategori}</span>
              </div>
              <button onClick={() => setShowDetay(null)} className="p-1 hover:bg-gray-100 rounded">✕</button>
            </div>
            {showDetay.aciklama && <p className="text-gray-600 mb-4">{showDetay.aciklama}</p>}
            <div className="bg-gray-50 rounded-lg p-4 mb-4">
              <p className="text-sm font-medium mb-2">Porsiyon: {showDetay.porsiyon}</p>
              <h4 className="font-semibold mb-2">Malzemeler:</h4>
              <ul className="space-y-2">
                {showDetay.malzemeler.map((m, i) => {
                  const stokItem = stok.find(s => s.id === m.stokId);
                  return (
                    <li key={i} className="flex justify-between text-sm">
                      <span>{stokItem?.ad || 'Bilinmeyen'}</span>
                      <span className="font-medium">{m.miktar} {stokItem?.birim}</span>
                    </li>
                  );
                })}
              </ul>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
}

function AylikMenu({ menu, setMenu, receteler }) {
  const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
  const [ogunFiltre, setOgunFiltre] = useState('Tümü');
  const [showYeni, setShowYeni] = useState(false);
  const [showDuzenle, setShowDuzenle] = useState(false);
  const [selectedGun, setSelectedGun] = useState(null);
  const [yeniForm, setYeniForm] = useState({
    tarih: new Date().toISOString().slice(0, 10),
    ogun: 'Öğle',
    yemekler: []
  });
  const [duzenleForm, setDuzenleForm] = useState({
    id: null,
    tarih: '',
    ogun: '',
    yemekler: []
  });

  const takvimVerisi = useMemo(() => {
    const [yil, ay] = selectedMonth.split('-');
    const ilkGun = new Date(yil, ay - 1, 1);
    const sonGun = new Date(yil, ay, 0);
    const gunSayisi = sonGun.getDate();
    
    // Ayın ilk gününün haftanın hangi günü olduğunu bul (0=Pazar, 1=Pazartesi, ...)
    const baslangicGunu = ilkGun.getDay();
    
    // Takvim satırları için gerekli boş hücreler ve günler
    const takvim = [];
    
    // İlk satır için boş hücreler ekle
    for (let i = 0; i < baslangicGunu; i++) {
      takvim.push(null);
    }
    
    // Günleri ekle
    for (let gun = 1; gun <= gunSayisi; gun++) {
      const tarih = `${selectedMonth}-${String(gun).padStart(2, '0')}`;
      let gunMenuleri = menu.filter(m => m.tarih === tarih);
      
      // Öğün filtresini uygula
      if (ogunFiltre !== 'Tümü') {
        gunMenuleri = gunMenuleri.filter(m => m.ogun === ogunFiltre);
      }
      
      takvim.push({
        gun,
        tarih,
        menuler: gunMenuleri
      });
    }
    
    return takvim;
  }, [selectedMonth, menu, ogunFiltre]);

  const haftaGunleri = ['Pazar', 'Pazartesi', 'Salı', 'Çarşamba', 'Perşembe', 'Cuma', 'Cumartesi'];
  
  const bugun = new Date().toISOString().slice(0, 10);

  const yeniEkle = async () => {
    if (!yeniForm.tarih || yeniForm.yemekler.length === 0) {
      alert('Tarih ve en az bir yemek gerekli!');
      return;
    }

    const yeni = {
      id: Math.max(0, ...menu.map(m => m.id)) + 1,
      tarih: yeniForm.tarih,
      ogun: yeniForm.ogun,
      yemekler: yeniForm.yemekler.join(', ')
    };

    // Supabase'e kaydet
try {
  const { data, error } = await supabase
    .from('menu')
    .insert([{
      tarih: yeniMenu.tarih,
      yemekler: secilenYemekler.join(', '),
      notlar: yeniMenu.notlar || ''
    }])
    .select();

  if (error) throw error;

  setMenu([...menu, data[0]]);
  localStorage.setItem('lezzetsel_menu', JSON.stringify([...menu, data[0]]));
  setYeniMenu({ tarih: '', notlar: '' });
  setSecilenYemekler([]);
  setShowYeniMenu(false);
  alert('✅ Menü eklendi!');
} catch (err) {
  console.error('Menü ekleme hatası:', err);
  alert('❌ Hata: ' + err.message);
}

  const yemekSil = (menuId, yemekIndex) => {
    const menuItem = menu.find(m => m.id === menuId);
    if (!menuItem) return;
    
    const yemekListesi = menuItem.yemekler.split(',').map(y => y.trim());
    
    if (yemekListesi.length === 1) {
      // Son yemek siliniyorsa tüm menüyü sil
      if (confirm('Bu menünün tek yemeği. Tüm menü silinecek, onaylıyor musunuz?')) {
        setMenu(menu.filter(m => m.id !== menuId));
      }
    } else {
      yemekListesi.splice(yemekIndex, 1);
      setMenu(menu.map(m => 
        m.id === menuId 
          ? { ...m, yemekler: yemekListesi.join(', ') }
          : m
      ));
    }
  };

  const yemekDuzenle = (menuItem, yemekIndex) => {
    const yemekListesi = menuItem.yemekler.split(',').map(y => y.trim());
    
    setDuzenleForm({
      id: menuItem.id,
      tarih: menuItem.tarih,
      ogun: menuItem.ogun,
      yemekler: yemekListesi
    });
    setShowDuzenle(true);
  };

 const menuSil = async (id) => {
  if (!window.confirm('Bu menüyü silmek istediğinizden emin misiniz?')) {
    return;
  }

  try {
    const { error } = await supabase
      .from('menu')
      .delete()
      .eq('id', id);

    if (error) throw error;

    const yeniMenuListesi = menu.filter(m => m.id !== id);
    setMenu(yeniMenuListesi);
    localStorage.setItem('lezzetsel_menu', JSON.stringify(yeniMenuListesi));
    alert('✅ Menü silindi!');
  } catch (err) {
    console.error('Menü silme hatası:', err);
    alert('❌ Hata: ' + err.message);
  }
};

  const menuDuzenle = (menuItem) => {
    const yemekListesi = menuItem.yemekler.split(',').map(y => y.trim());
    setDuzenleForm({
      id: menuItem.id,
      tarih: menuItem.tarih,
      ogun: menuItem.ogun,
      yemekler: yemekListesi
    });
    setShowDuzenle(true);
  };

  const duzenleKaydet = () => {
    if (duzenleForm.yemekler.length === 0) {
      alert('En az bir yemek gerekli!');
      return;
    }

    setMenu(menu.map(m => 
      m.id === duzenleForm.id 
        ? { ...m, tarih: duzenleForm.tarih, ogun: duzenleForm.ogun, yemekler: duzenleForm.yemekler.join(', ') }
        : m
    ));
    setShowDuzenle(false);
    setDuzenleForm({ id: null, tarih: '', ogun: '', yemekler: [] });
  };

  const gunTikla = (gunVerisi) => {
    if (gunVerisi) {
      setSelectedGun(gunVerisi);
    }
  };

  const hizliMenuEkle = (tarih) => {
    setYeniForm({ tarih, ogun: 'Öğle', yemekler: [] });
    setShowYeni(true);
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold">Aylık Menü Takvimi</h2>
        </div>
        <div className="flex gap-2">
          <button 
            onClick={() => {
              // Yazdırma fonksiyonu
              window.print();
            }}
            className="px-4 py-2 bg-gray-600 text-white rounded-lg flex items-center gap-2 hover:bg-gray-700"
          >
            <FileText className="w-4 h-4" />
            Yazdır
          </button>
          <button 
            onClick={() => {
              // CSV indirme fonksiyonu
              let csv = '\uFEFF';
              csv += 'AYLIK MENÜ TAKVİMİ\n';
              csv += `Ay: ${selectedMonth}\n\n`;
              csv += 'Tarih,Gün,Öğün,Yemekler\n';
              
              const [yil, ay] = selectedMonth.split('-');
              const sonGun = new Date(yil, ay, 0).getDate();
              
              for (let gun = 1; gun <= sonGun; gun++) {
                const tarih = `${selectedMonth}-${String(gun).padStart(2, '0')}`;
                const gunMenuleri = menu.filter(m => m.tarih === tarih);
                const gunAdi = new Date(tarih).toLocaleDateString('tr-TR', { weekday: 'long' });
                
                if (gunMenuleri.length === 0) {
                  csv += `${tarih},${gunAdi},-,-\n`;
                } else {
                  gunMenuleri.forEach(m => {
                    csv += `${tarih},${gunAdi},${m.ogun},"${m.yemekler}"\n`;
                  });
                }
              }
              
              const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
              const link = document.createElement('a');
              link.href = URL.createObjectURL(blob);
              link.download = `Aylik_Menu_${selectedMonth}.csv`;
              link.click();
            }}
            className="px-4 py-2 bg-green-600 text-white rounded-lg flex items-center gap-2 hover:bg-green-700"
          >
            <Download className="w-4 h-4" />
            İndir
          </button>
          <button onClick={() => setShowYeni(true)} className="px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center gap-2">
            <Plus className="w-4 h-4" />
            Menü Ekle
          </button>
        </div>
      </div>

      <div className="bg-white rounded-xl border p-6">
        <div className="flex items-center justify-between flex-wrap gap-4">
          <div className="flex items-center gap-4">
            <button 
              onClick={() => {
                const [yil, ay] = selectedMonth.split('-');
                const yeniTarih = new Date(yil, ay - 2, 1);
                setSelectedMonth(`${yeniTarih.getFullYear()}-${String(yeniTarih.getMonth() + 1).padStart(2, '0')}`);
              }}
              className="p-2 hover:bg-gray-100 rounded-lg"
            >
              ←
            </button>
            <input 
              type="month" 
              value={selectedMonth} 
              onChange={(e) => setSelectedMonth(e.target.value)} 
              className="px-4 py-2 border rounded-lg font-semibold"
            />
            <button 
              onClick={() => {
                const [yil, ay] = selectedMonth.split('-');
                const yeniTarih = new Date(yil, ay, 1);
                setSelectedMonth(`${yeniTarih.getFullYear()}-${String(yeniTarih.getMonth() + 1).padStart(2, '0')}`);
              }}
              className="p-2 hover:bg-gray-100 rounded-lg"
            >
              →
            </button>
          </div>
          
          <div className="flex items-center gap-2">
            <span className="text-sm font-medium text-gray-600">Öğün:</span>
            <div className="flex gap-1 bg-gray-100 rounded-lg p-1">
              {['Tümü', 'Kahvaltı', 'Öğle', 'Akşam'].map(ogun => (
                <button
                  key={ogun}
                  onClick={() => setOgunFiltre(ogun)}
                  className={`px-3 py-1 rounded-md text-sm font-medium transition-colors ${
                    ogunFiltre === ogun 
                      ? 'bg-white text-blue-600 shadow-sm' 
                      : 'text-gray-600 hover:text-gray-900'
                  }`}
                >
                  {ogun}
                </button>
              ))}
            </div>
          </div>

          <button 
            onClick={() => setSelectedMonth(new Date().toISOString().slice(0, 7))}
            className="px-4 py-2 text-blue-600 hover:bg-blue-50 rounded-lg text-sm font-medium"
          >
            Bugüne Git
          </button>
        </div>
      </div>

      <div className="bg-white rounded-xl border overflow-hidden">
        {/* Haftanın günleri başlıkları */}
        <div className="grid grid-cols-7 bg-gray-50 border-b">
          {haftaGunleri.map(gun => (
            <div key={gun} className="px-2 py-3 text-center font-semibold text-gray-700 text-sm">
              {gun}
            </div>
          ))}
        </div>

        {/* Takvim grid'i */}
        <div className="grid grid-cols-7">
          {takvimVerisi.map((gunVerisi, index) => {
            if (!gunVerisi) {
              return <div key={`bos-${index}`} className="min-h-[140px] border-b border-r bg-gray-50"></div>;
            }

            const isBugun = gunVerisi.tarih === bugun;
            const hasMenu = gunVerisi.menuler.length > 0;

            return (
              <div 
                key={gunVerisi.tarih} 
                className={`min-h-[140px] border-b border-r p-2 ${isBugun ? 'bg-blue-50 ring-2 ring-blue-500 ring-inset' : ''}`}
              >
                <div className="h-full flex flex-col">
                  <div className="flex justify-between items-start mb-1">
                    <span className={`text-sm font-bold ${isBugun ? 'text-blue-600' : 'text-gray-700'}`}>
                      {gunVerisi.gun}
                    </span>
                    {isBugun && <span className="text-xs bg-blue-600 text-white px-1 rounded">Bugün</span>}
                  </div>
                  
                  <div className="flex-1 space-y-1">
                    {gunVerisi.menuler.length === 0 ? (
                      <button 
                        onClick={(e) => { e.stopPropagation(); hizliMenuEkle(gunVerisi.tarih); }}
                        className="w-full text-xs text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded p-1 text-left"
                      >
                        + Ekle
                      </button>
                    ) : (
                      gunVerisi.menuler.map(m => {
                        const yemekListesi = m.yemekler.split(',').map(y => y.trim());
                        
                        // Öğüne göre renk seçimi
                        const ogunRenkleri = {
                          'Kahvaltı': 'bg-amber-50 hover:bg-amber-100 border-amber-200',
                          'Öğle': 'bg-emerald-50 hover:bg-emerald-100 border-emerald-200',
                          'Akşam': 'bg-indigo-50 hover:bg-indigo-100 border-indigo-200'
                        };
                        
                        const kartRengi = ogunRenkleri[m.ogun] || 'bg-slate-50 hover:bg-slate-100 border-slate-200';
                        
                        return (
                          <div key={m.id} className={`text-xs ${kartRengi} rounded p-1.5 border space-y-1 transition-colors`}>
                            <div className="flex justify-between items-center mb-1">
                              <span className="font-semibold text-gray-700 text-[10px]">{m.ogun}</span>
                            </div>
                            <div className="space-y-0.5">
                              {yemekListesi.map((yemek, idx) => (
                                <div key={idx} className="flex items-center justify-between group hover:bg-white/50 rounded px-1 py-0.5 transition-colors">
                                  <div className="flex items-start flex-1 min-w-0">
                                    <span className="text-gray-500 mr-1">•</span>
                                    <span className="flex-1 text-gray-700 text-[10px] leading-tight break-words">{yemek}</span>
                                  </div>
                                  <div className="flex gap-0.5 ml-1 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0">
                                    <button 
                                      onClick={(e) => { e.stopPropagation(); yemekDuzenle(m, idx); }}
                                      className="p-0.5 text-blue-600 hover:bg-blue-200 rounded"
                                      title="Düzenle"
                                    >
                                      <Edit2 className="w-2.5 h-2.5" />
                                    </button>
                                    <button 
                                      onClick={(e) => { e.stopPropagation(); yemekSil(m.id, idx); }}
                                      className="p-0.5 text-red-600 hover:bg-red-200 rounded"
                                      title="Sil"
                                    >
                                      <Trash2 className="w-2.5 h-2.5" />
                                    </button>
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        );
                      })
                    )}
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      {/* Seçili gün detayları */}
      {selectedGun && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto">
            <div className="flex justify-between items-start mb-4">
              <div>
                <h3 className="text-xl font-bold">{formatTarih(selectedGun.tarih)}</h3>
                <p className="text-gray-600 text-sm">{selectedGun.menuler.length} menü planlandı</p>
              </div>
              <button onClick={() => setSelectedGun(null)} className="p-1 hover:bg-gray-100 rounded">✕</button>
            </div>

            {selectedGun.menuler.length === 0 ? (
              <div className="text-center py-8">
                <p className="text-gray-400 mb-4">Bu gün için menü planlanmamış</p>
                <button 
                  onClick={() => { hizliMenuEkle(selectedGun.tarih); setSelectedGun(null); }}
                  className="px-4 py-2 bg-blue-600 text-white rounded-lg"
                >
                  Menü Ekle
                </button>
              </div>
            ) : (
              <div className="space-y-3">
                {selectedGun.menuler.map(m => (
                  <div key={m.id} className="bg-gradient-to-r from-amber-50 to-orange-50 rounded-lg p-4 border border-amber-200">
                    <div className="flex justify-between items-start">
                      <div className="flex-1">
                        <span className="px-3 py-1 bg-amber-600 text-white text-sm font-semibold rounded-full inline-block mb-2">
                          {m.ogun}
                        </span>
                        <p className="text-gray-800 font-medium">{m.yemekler}</p>
                      </div>
                      <button 
                        onClick={() => { menuSil(m.id); setSelectedGun(null); }} 
                        className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                      >
                        <Trash2 className="w-4 h-4" />
                      </button>
                    </div>
                  </div>
                ))}
                <button 
                  onClick={() => { hizliMenuEkle(selectedGun.tarih); setSelectedGun(null); }}
                  className="w-full px-4 py-2 border-2 border-dashed border-gray-300 text-gray-600 rounded-lg hover:border-blue-600 hover:text-blue-600"
                >
                  + Başka Öğün Ekle
                </button>
              </div>
            )}
          </div>
        </div>
      )}

      {/* Düzenleme modal */}
      {showDuzenle && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h3 className="text-xl font-bold mb-4">Menü Düzenle</h3>
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium mb-1">Tarih</label>
                  <input 
                    type="date" 
                    value={duzenleForm.tarih} 
                    onChange={(e) => setDuzenleForm({...duzenleForm, tarih: e.target.value})} 
                    className="w-full px-3 py-2 border rounded-lg" 
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Öğün</label>
                  <select 
                    value={duzenleForm.ogun} 
                    onChange={(e) => setDuzenleForm({...duzenleForm, ogun: e.target.value})} 
                    className="w-full px-3 py-2 border rounded-lg"
                  >
                    <option value="Kahvaltı">Kahvaltı</option>
                    <option value="Öğle">Öğle</option>
                    <option value="Akşam">Akşam</option>
                  </select>
                </div>
              </div>
              
              <div>
                <div className="flex justify-between items-center mb-2">
                  <label className="block text-sm font-medium">Yemekler ({duzenleForm.yemekler.length})</label>
                  <button 
                    onClick={() => setDuzenleForm({...duzenleForm, yemekler: [...duzenleForm.yemekler, '']})}
                    className="px-3 py-1 bg-green-600 text-white rounded-lg text-sm flex items-center gap-1"
                  >
                    <Plus className="w-4 h-4" />
                    Satır Ekle
                  </button>
                </div>

                {duzenleForm.yemekler.length === 0 ? (
                  <p className="text-sm text-gray-500 italic p-4 bg-gray-50 rounded-lg text-center">
                    Yemek yok. "Satır Ekle" butonuna tıklayın.
                  </p>
                ) : (
                  <div className="space-y-2">
                    {duzenleForm.yemekler.map((yemek, idx) => (
                      <div key={idx} className="flex items-center gap-2">
                        <span className="text-gray-600 font-medium w-6">{idx + 1}.</span>
                        <div className="flex-1 relative">
                          <input
                            type="text"
                            value={yemek}
                            onChange={(e) => {
                              const yeni = [...duzenleForm.yemekler];
                              yeni[idx] = e.target.value;
                              setDuzenleForm({...duzenleForm, yemekler: yeni});
                            }}
                            placeholder="Yemek adı yazın veya listeden seçin"
                            className="w-full px-3 py-2 border rounded-lg"
                            list={`recete-list-edit-${idx}`}
                          />
                          <datalist id={`recete-list-edit-${idx}`}>
                            {receteler.filter(r => r.aktif).map(r => (
                              <option key={r.id} value={r.ad}>{r.kategori}</option>
                            ))}
                          </datalist>
                        </div>
                        <button 
                          onClick={() => setDuzenleForm({...duzenleForm, yemekler: duzenleForm.yemekler.filter((_, i) => i !== idx)})}
                          className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                        >
                          <Trash2 className="w-5 h-5" />
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => { setShowDuzenle(false); setDuzenleForm({ id: null, tarih: '', ogun: '', yemekler: [] }); }} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button 
                onClick={duzenleKaydet}
                disabled={duzenleForm.yemekler.length === 0 || duzenleForm.yemekler.some(y => !y)}
                className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
              >
                Güncelle
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Yeni menü ekleme modal */}
      {showYeni && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h3 className="text-xl font-bold mb-4">Yeni Menü Ekle</h3>
            <div className="space-y-4">
              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-sm font-medium mb-1">Tarih</label>
                  <input 
                    type="date" 
                    value={yeniForm.tarih} 
                    onChange={(e) => setYeniForm({...yeniForm, tarih: e.target.value})} 
                    className="w-full px-3 py-2 border rounded-lg" 
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium mb-1">Öğün</label>
                  <select 
                    value={yeniForm.ogun} 
                    onChange={(e) => setYeniForm({...yeniForm, ogun: e.target.value})} 
                    className="w-full px-3 py-2 border rounded-lg"
                  >
                    <option value="Kahvaltı">Kahvaltı</option>
                    <option value="Öğle">Öğle</option>
                    <option value="Akşam">Akşam</option>
                  </select>
                </div>
              </div>
              
              <div>
                <div className="flex justify-between items-center mb-2">
                  <label className="block text-sm font-medium">Yemekler ({yeniForm.yemekler.length})</label>
                  <button 
                    onClick={() => setYeniForm({...yeniForm, yemekler: [...yeniForm.yemekler, '']})}
                    className="px-3 py-1 bg-green-600 text-white rounded-lg text-sm flex items-center gap-1"
                  >
                    <Plus className="w-4 h-4" />
                    Satır Ekle
                  </button>
                </div>

                {yeniForm.yemekler.length === 0 ? (
                  <p className="text-sm text-gray-500 italic p-4 bg-gray-50 rounded-lg text-center">
                    Henüz yemek eklenmedi. "Satır Ekle" butonuna tıklayın.
                  </p>
                ) : (
                  <div className="space-y-2">
                    {yeniForm.yemekler.map((yemek, idx) => (
                      <div key={idx} className="flex items-center gap-2">
                        <span className="text-gray-600 font-medium w-6">{idx + 1}.</span>
                        <div className="flex-1 relative">
                          <input
                            type="text"
                            value={yemek}
                            onChange={(e) => {
                              const yeni = [...yeniForm.yemekler];
                              yeni[idx] = e.target.value;
                              setYeniForm({...yeniForm, yemekler: yeni});
                            }}
                            placeholder="Yemek adı yazın veya listeden seçin"
                            className="w-full px-3 py-2 border rounded-lg"
                            list={`recete-list-${idx}`}
                          />
                          <datalist id={`recete-list-${idx}`}>
                            {receteler.filter(r => r.aktif).map(r => (
                              <option key={r.id} value={r.ad}>{r.kategori}</option>
                            ))}
                          </datalist>
                        </div>
                        <button 
                          onClick={() => setYeniForm({...yeniForm, yemekler: yeniForm.yemekler.filter((_, i) => i !== idx)})}
                          className="p-2 text-red-600 hover:bg-red-50 rounded-lg"
                        >
                          <Trash2 className="w-5 h-5" />
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => { setShowYeni(false); setYeniForm({ tarih: new Date().toISOString().slice(0, 10), ogun: 'Öğle', yemekler: [] }); }} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button 
                onClick={yeniEkle} 
                disabled={yeniForm.yemekler.length === 0 || yeniForm.yemekler.some(y => !y)}
                className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed"
              >
                Ekle ({yeniForm.yemekler.filter(y => y).length} yemek)
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

}
function Musteriler({ musteriler, setMusteriler }) {
  const [q, setQ] = useState('');
  const [durum, setDurum] = useState('Aktif');
  const [showYeni, setShowYeni] = useState(false);
  const [showDuzenle, setShowDuzenle] = useState(false);
  const [yeniForm, setYeniForm] = useState({
    ad: '',
    vkn: '',
    yetkili: '',
    telefon: '',
    email: '',
    adres: ''
  });
  const [duzenleForm, setDuzenleForm] = useState({
    id: null,
    ad: '',
    vkn: '',
    yetkili: '',
    telefon: '',
    email: '',
    adres: '',
    aktif: true
  });

  const filtreliMusteriler = useMemo(() => {
    let sonuc = musteriler;
    if (durum === 'Aktif') sonuc = sonuc.filter(m => m.aktif);
    if (durum === 'Pasif') sonuc = sonuc.filter(m => !m.aktif);
    if (q) sonuc = sonuc.filter(m => 
      m.ad.toLowerCase().includes(q.toLowerCase()) || 
      m.yetkili.toLowerCase().includes(q.toLowerCase())
    );
    return sonuc;
  }, [musteriler, q, durum]);

  const yeniEkle = async () => {
    if (!yeniForm.ad || !yeniForm.yetkili) {
      alert('Firma adı ve yetkili gerekli!');
      return;
    }

    const yeni = {
      id: Math.max(0, ...musteriler.map(m => m.id)) + 1,
      ...yeniForm,
      aktif: true
    };

    // Supabase'e kaydet
try {
  const { data, error } = await supabase
    .from('musteriler')
    .insert([{
      ad: form.ad,
      vkn: form.vkn || '',
      yetkili: form.yetkili,
      telefon: form.telefon || '',
      email: form.email || '',
      adres: form.adres || '',
      aktif: true
    }])
    .select();

  if (error) throw error;

  setMusteriler([...musteriler, data[0]]);
  localStorage.setItem('lezzetsel_musteriler', JSON.stringify([...musteriler, data[0]]));
  setForm({ ad: '', vkn: '', yetkili: '', telefon: '', email: '', adres: '' });
  setShowYeniMusteri(false);
  alert('✅ Müşteri eklendi!');
} catch (err) {
  console.error('Müşteri ekleme hatası:', err);
  alert('❌ Hata: ' + err.message);
}

  const musteriDuzenle = (musteri) => {
    setDuzenleForm(musteri);
    setShowDuzenle(true);
  };

  const duzenleKaydet = () => {
    if (!duzenleForm.ad || !duzenleForm.yetkili) {
      alert('Firma adı ve yetkili gerekli!');
      return;
    }

    setMusteriler(musteriler.map(m => m.id === duzenleForm.id ? duzenleForm : m));
    setShowDuzenle(false);
    setDuzenleForm({ id: null, ad: '', yetkili: '', telefon: '', email: '', adres: '', aktif: true });
  };

  const durumDegistir = (id) => {
    setMusteriler(musteriler.map(m => m.id === id ? { ...m, aktif: !m.aktif } : m));
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold">Müşteriler</h2>
        </div>
        <button onClick={() => setShowYeni(true)} className="px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center gap-2">
          <Plus className="w-4 h-4" />
          Yeni Müşteri
        </button>
      </div>

      <div className="bg-white rounded-xl border p-6">
        <div className="grid grid-cols-12 gap-4">
          <input 
            type="text" 
            placeholder="Firma veya yetkili ara..." 
            value={q} 
            onChange={(e) => setQ(e.target.value)} 
            className="col-span-8 px-3 py-2 border rounded-lg" 
          />
          <select value={durum} onChange={(e) => setDurum(e.target.value)} className="col-span-4 px-3 py-2 border rounded-lg">
            <option value="Tümü">Tümü</option>
            <option value="Aktif">Aktif</option>
            <option value="Pasif">Pasif</option>
          </select>
        </div>
      </div>

      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        {filtreliMusteriler.map(musteri => (
          <div key={musteri.id} className={`bg-white rounded-lg border hover:border-blue-300 hover:shadow-md transition-all p-4 flex flex-col ${!musteri.aktif ? 'opacity-50' : ''}`}>
            <div className="flex-1">
              <div className="mb-2">
                <h3 className="font-bold text-gray-900 text-sm leading-tight mb-1">{musteri.ad}</h3>
                <span className={`inline-block px-2 py-0.5 rounded text-xs font-medium ${musteri.aktif ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'}`}>
                  {musteri.aktif ? 'Aktif' : 'Pasif'}
                </span>
              </div>
              
              <p className="text-xs text-gray-600 mb-2">{musteri.yetkili}</p>
              
              <div className="space-y-1 text-xs text-gray-500">
                {musteri.telefon && <div className="truncate">{musteri.telefon}</div>}
                {musteri.email && <div className="truncate">{musteri.email}</div>}
              </div>
            </div>

            <div className="flex gap-1 mt-3 pt-3 border-t">
              <button 
                onClick={() => musteriDuzenle(musteri)}
                className="flex-1 flex items-center justify-center gap-1 px-2 py-1.5 text-xs text-blue-600 hover:bg-blue-50 rounded transition-colors"
              >
                <Edit2 className="w-3 h-3" />
              </button>
              <button 
                onClick={() => durumDegistir(musteri.id)}
                className={`flex-1 px-2 py-1.5 text-xs rounded transition-colors ${musteri.aktif ? 'text-red-600 hover:bg-red-50' : 'text-green-600 hover:bg-green-50'}`}
              >
                {musteri.aktif ? 'Pasif' : 'Aktif'}
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* Yeni Müşteri Modal */}
      {showYeni && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full">
            <h3 className="text-xl font-bold mb-4">Yeni Müşteri Ekle</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-1">Firma Adı *</label>
                <input 
                  type="text" 
                  value={yeniForm.ad} 
                  onChange={(e) => setYeniForm({...yeniForm, ad: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="Örn: ABC İnşaat"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Vergi Kimlik No</label>
                <input 
                  type="text" 
                  value={yeniForm.vkn} 
                  onChange={(e) => setYeniForm({...yeniForm, vkn: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="10 haneli VKN"
                  maxLength={10}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Yetkili Kişi *</label>
                <input 
                  type="text" 
                  value={yeniForm.yetkili} 
                  onChange={(e) => setYeniForm({...yeniForm, yetkili: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="Örn: Ahmet Yılmaz"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Telefon</label>
                <input 
                  type="tel" 
                  value={yeniForm.telefon} 
                  onChange={(e) => setYeniForm({...yeniForm, telefon: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="0532 123 4567"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">E-posta</label>
                <input 
                  type="email" 
                  value={yeniForm.email} 
                  onChange={(e) => setYeniForm({...yeniForm, email: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="ornek@email.com"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Adres</label>
                <textarea 
                  value={yeniForm.adres} 
                  onChange={(e) => setYeniForm({...yeniForm, adres: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  rows={2}
                  placeholder="İstanbul"
                />
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => setShowYeni(false)} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button onClick={yeniEkle} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg">Ekle</button>
            </div>
          </div>
        </div>
      )}

      {/* Düzenle Modal */}
      {showDuzenle && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full">
            <h3 className="text-xl font-bold mb-4">Müşteri Düzenle</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-1">Firma Adı *</label>
                <input 
                  type="text" 
                  value={duzenleForm.ad} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, ad: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Vergi Kimlik No</label>
                <input 
                  type="text" 
                  value={duzenleForm.vkn} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, vkn: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="10 haneli VKN"
                  maxLength={10}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Yetkili Kişi *</label>
                <input 
                  type="text" 
                  value={duzenleForm.yetkili} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, yetkili: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Telefon</label>
                <input 
                  type="tel" 
                  value={duzenleForm.telefon} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, telefon: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">E-posta</label>
                <input 
                  type="email" 
                  value={duzenleForm.email} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, email: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Adres</label>
                <textarea 
                  value={duzenleForm.adres} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, adres: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  rows={2}
                />
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => setShowDuzenle(false)} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button onClick={duzenleKaydet} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg">Güncelle</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

}
function Tedarikciler({ tedarikciler, setTedarikciler }) {
  const [q, setQ] = useState('');
  const [kategori, setKategori] = useState('Tümü');
  const [durum, setDurum] = useState('Aktif');
  const [showYeni, setShowYeni] = useState(false);
  const [showDuzenle, setShowDuzenle] = useState(false);
  const [yeniForm, setYeniForm] = useState({
    ad: '',
    vkn: '',
    yetkili: '',
    telefon: '',
    email: '',
    adres: '',
    kategori: 'Et'
  });
  const [duzenleForm, setDuzenleForm] = useState({
    id: null,
    ad: '',
    vkn: '',
    yetkili: '',
    telefon: '',
    email: '',
    adres: '',
    kategori: '',
    aktif: true
  });

  const tedarikciKategorileri = ["Tümü", "Et", "Hâl", "Kuru Gıda", "Şarküteri", "İçecek", "Baharat", "Diğer"];

  const filtreliTedarikciler = useMemo(() => {
    let sonuc = tedarikciler;
    if (durum === 'Aktif') sonuc = sonuc.filter(t => t.aktif);
    if (durum === 'Pasif') sonuc = sonuc.filter(t => !t.aktif);
    if (kategori !== 'Tümü') sonuc = sonuc.filter(t => t.kategori === kategori);
    if (q) sonuc = sonuc.filter(t => 
      t.ad.toLowerCase().includes(q.toLowerCase()) || 
      t.yetkili.toLowerCase().includes(q.toLowerCase())
    );
    return sonuc;
  }, [tedarikciler, q, kategori, durum]);

 const yeniEkle = async () => {
    if (!yeniForm.ad || !yeniForm.yetkili) {
      alert('Firma adı ve yetkili gerekli!');
      return;
    }

    const yeni = {
      id: Math.max(0, ...tedarikciler.map(t => t.id)) + 1,
      ...yeniForm,
      aktif: true
    };

  // Supabase'e kaydet
try {
  const { data, error } = await supabase
    .from('tedarikciler')
    .insert([{
      ad: form.ad,
      kategori: form.kategori || 'Diğer',
      yetkili: form.yetkili,
      telefon: form.telefon || '',
      email: form.email || '',
      adres: form.adres || '',
      aktif: true
    }])
    .select();

  if (error) throw error;

  setTedarikciler([...tedarikciler, data[0]]);
  localStorage.setItem('lezzetsel_tedarikciler', JSON.stringify([...tedarikciler, data[0]]));
  setForm({ ad: '', kategori: 'Diğer', yetkili: '', telefon: '', email: '', adres: '' });
  setShowYeniTedarikci(false);
  alert('✅ Tedarikçi eklendi!');
} catch (err) {
  console.error('Tedarikçi ekleme hatası:', err);
  alert('❌ Hata: ' + err.message);
}

  const tedarikciDuzenle = (tedarikci) => {
    setDuzenleForm(tedarikci);
    setShowDuzenle(true);
  };

  const duzenleKaydet = () => {
    if (!duzenleForm.ad || !duzenleForm.yetkili) {
      alert('Firma adı ve yetkili gerekli!');
      return;
    }

    setTedarikciler(tedarikciler.map(t => t.id === duzenleForm.id ? duzenleForm : t));
    setShowDuzenle(false);
    setDuzenleForm({ id: null, ad: '', vkn: '', yetkili: '', telefon: '', email: '', adres: '', kategori: '', aktif: true });
  };

  const durumDegistir = (id) => {
    setTedarikciler(tedarikciler.map(t => t.id === id ? { ...t, aktif: !t.aktif } : t));
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold">Tedarikçiler</h2>
        </div>
        <button onClick={() => setShowYeni(true)} className="px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center gap-2">
          <Plus className="w-4 h-4" />
          Yeni Tedarikçi
        </button>
      </div>

      <div className="bg-white rounded-xl border p-6">
        <div className="grid grid-cols-12 gap-4">
          <input 
            type="text" 
            placeholder="Firma veya yetkili ara..." 
            value={q} 
            onChange={(e) => setQ(e.target.value)} 
            className="col-span-6 px-3 py-2 border rounded-lg" 
          />
          <select value={kategori} onChange={(e) => setKategori(e.target.value)} className="col-span-3 px-3 py-2 border rounded-lg">
            {tedarikciKategorileri.map(k => <option key={k} value={k}>{k}</option>)}
          </select>
          <select value={durum} onChange={(e) => setDurum(e.target.value)} className="col-span-3 px-3 py-2 border rounded-lg">
            <option value="Tümü">Tümü</option>
            <option value="Aktif">Aktif</option>
            <option value="Pasif">Pasif</option>
          </select>
        </div>
      </div>

      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4">
        {filtreliTedarikciler.map(tedarikci => (
          <div key={tedarikci.id} className={`bg-white rounded-lg border hover:border-blue-300 hover:shadow-md transition-all p-4 flex flex-col ${!tedarikci.aktif ? 'opacity-50' : ''}`}>
            <div className="flex-1">
              <div className="mb-2">
                <h3 className="font-bold text-gray-900 text-sm leading-tight mb-1">{tedarikci.ad}</h3>
                <div className="flex items-center gap-1 mb-1">
                  <span className={`inline-block px-2 py-0.5 rounded text-xs font-medium ${tedarikci.aktif ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600'}`}>
                    {tedarikci.aktif ? 'Aktif' : 'Pasif'}
                  </span>
                  <span className="inline-block px-2 py-0.5 bg-blue-100 text-blue-700 rounded text-xs">
                    {tedarikci.kategori}
                  </span>
                </div>
              </div>
              
              <p className="text-xs text-gray-600 mb-2">{tedarikci.yetkili}</p>
              
              <div className="space-y-1 text-xs text-gray-500">
                {tedarikci.telefon && <div className="truncate">{tedarikci.telefon}</div>}
                {tedarikci.email && <div className="truncate">{tedarikci.email}</div>}
              </div>
            </div>

            <div className="flex gap-1 mt-3 pt-3 border-t">
              <button 
                onClick={() => tedarikciDuzenle(tedarikci)}
                className="flex-1 flex items-center justify-center gap-1 px-2 py-1.5 text-xs text-blue-600 hover:bg-blue-50 rounded transition-colors"
              >
                <Edit2 className="w-3 h-3" />
              </button>
              <button 
                onClick={() => durumDegistir(tedarikci.id)}
                className={`flex-1 px-2 py-1.5 text-xs rounded transition-colors ${tedarikci.aktif ? 'text-red-600 hover:bg-red-50' : 'text-green-600 hover:bg-green-50'}`}
              >
                {tedarikci.aktif ? 'Pasif' : 'Aktif'}
              </button>
            </div>
          </div>
        ))}
      </div>

      {/* Yeni Tedarikçi Modal */}
      {showYeni && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full">
            <h3 className="text-xl font-bold mb-4">Yeni Tedarikçi Ekle</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-1">Firma Adı *</label>
                <input 
                  type="text" 
                  value={yeniForm.ad} 
                  onChange={(e) => setYeniForm({...yeniForm, ad: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="Örn: Beyaz Et Tedarik A.Ş."
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Vergi Kimlik No</label>
                <input 
                  type="text" 
                  value={yeniForm.vkn} 
                  onChange={(e) => setYeniForm({...yeniForm, vkn: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="10 haneli VKN"
                  maxLength={10}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Kategori</label>
                <select 
                  value={yeniForm.kategori} 
                  onChange={(e) => setYeniForm({...yeniForm, kategori: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg"
                >
                  {tedarikciKategorileri.filter(k => k !== 'Tümü').map(k => <option key={k} value={k}>{k}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Yetkili Kişi *</label>
                <input 
                  type="text" 
                  value={yeniForm.yetkili} 
                  onChange={(e) => setYeniForm({...yeniForm, yetkili: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="Örn: Ali Çelik"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Telefon</label>
                <input 
                  type="tel" 
                  value={yeniForm.telefon} 
                  onChange={(e) => setYeniForm({...yeniForm, telefon: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="0212 555 1234"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">E-posta</label>
                <input 
                  type="email" 
                  value={yeniForm.email} 
                  onChange={(e) => setYeniForm({...yeniForm, email: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="ornek@email.com"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Adres</label>
                <textarea 
                  value={yeniForm.adres} 
                  onChange={(e) => setYeniForm({...yeniForm, adres: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  rows={2}
                  placeholder="İstanbul"
                />
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => setShowYeni(false)} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button onClick={yeniEkle} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg">Ekle</button>
            </div>
          </div>
        </div>
      )}

      {/* Düzenle Modal */}
      {showDuzenle && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full">
            <h3 className="text-xl font-bold mb-4">Tedarikçi Düzenle</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-1">Firma Adı *</label>
                <input 
                  type="text" 
                  value={duzenleForm.ad} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, ad: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Vergi Kimlik No</label>
                <input 
                  type="text" 
                  value={duzenleForm.vkn} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, vkn: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  placeholder="10 haneli VKN"
                  maxLength={10}
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Kategori</label>
                <select 
                  value={duzenleForm.kategori} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, kategori: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg"
                >
                  {tedarikciKategorileri.filter(k => k !== 'Tümü').map(k => <option key={k} value={k}>{k}</option>)}
                </select>
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Yetkili Kişi *</label>
                <input 
                  type="text" 
                  value={duzenleForm.yetkili} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, yetkili: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Telefon</label>
                <input 
                  type="tel" 
                  value={duzenleForm.telefon} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, telefon: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">E-posta</label>
                <input 
                  type="email" 
                  value={duzenleForm.email} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, email: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Adres</label>
                <textarea 
                  value={duzenleForm.adres} 
                  onChange={(e) => setDuzenleForm({...duzenleForm, adres: e.target.value})} 
                  className="w-full px-3 py-2 border rounded-lg" 
                  rows={2}
                />
              </div>
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => setShowDuzenle(false)} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button onClick={duzenleKaydet} className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg">Güncelle</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}



}
function CostKontrol({ siparisler, setSiparisler, tedarikciler, stok, setStok }) {
  const [baslangicTarihi, setBaslangicTarihi] = useState('');
  const [bitisTarihi, setBitisTarihi] = useState('');
  const [tedarikciFiltre, setTedarikciFiltre] = useState('Tümü');
  const [urunArama, setUrunArama] = useState('');
  const [duzenlemeler, setDuzenlemeler] = useState({});
  const [kontrolEdilenleriGoster, setKontrolEdilenleriGoster] = useState('bekleyen');

  // Sadece Teslim Alındı durumundaki ve planlanan değerleri olan siparişleri filtrele
  const costVerileri = useMemo(() => {
    return siparisler
      .filter(s => {
        // Temel filtre: Teslim Alındı ve planlanan değerler var
        const temelKosul = s.durum === 'Teslim Alındı' && s.planlananMiktar && s.planlananBirimFiyat;
        
        // Kontrol edilenler filtreleme
        if (kontrolEdilenleriGoster === 'hepsi') {
          return temelKosul; // Hepsini göster
        } else if (kontrolEdilenleriGoster === 'onaylananlar') {
          return temelKosul && s.costKontrolYapildi; // Sadece kontrol edilenleri göster
        } else {
          return temelKosul && !s.costKontrolYapildi; // Sadece kontrol edilmeyenleri göster
        }
      })
      .map(s => {
        // Planlanan değerler (onay aşamasındaki)
        const planlananMiktar = s.planlananMiktar || 0;
        const planlananBirimFiyat = s.planlananBirimFiyat || 0;
        const planlananToplam = s.planlananToplam || (planlananMiktar * planlananBirimFiyat);

        // Düzenleme varsa onu kullan, yoksa kayıtlı değerleri kullan
        const duzenle = duzenlemeler[s.id] || {};
        const gerceklesenMiktar = duzenle.miktar !== undefined ? duzenle.miktar : (s.miktar || 0);
        const gerceklesenBirimFiyat = duzenle.birimFiyat !== undefined ? duzenle.birimFiyat : (s.birimFiyat || 0);
        const gerceklesenToplam = gerceklesenMiktar * gerceklesenBirimFiyat;

        // Farklar
        const miktarFark = gerceklesenMiktar - planlananMiktar;
        const fiyatFark = gerceklesenBirimFiyat - planlananBirimFiyat;
        const toplamFark = gerceklesenToplam - planlananToplam;

        // Varyans yüzdeleri
        const miktarVaryans = planlananMiktar !== 0 ? ((miktarFark / planlananMiktar) * 100).toFixed(1) : 0;
        const fiyatVaryans = planlananBirimFiyat !== 0 ? ((fiyatFark / planlananBirimFiyat) * 100).toFixed(1) : 0;
        const toplamVaryans = planlananToplam !== 0 ? ((toplamFark / planlananToplam) * 100).toFixed(1) : 0;

        return {
          ...s,
          planlananMiktar,
          planlananBirimFiyat,
          planlananToplam,
          gerceklesenMiktar,
          gerceklesenBirimFiyat,
          gerceklesenToplam,
          miktarFark,
          fiyatFark,
          toplamFark,
          miktarVaryans,
          fiyatVaryans,
          toplamVaryans
        };
      });
  }, [siparisler, duzenlemeler, kontrolEdilenleriGoster]);

  const duzenlemeYap = (siparisId, alan, deger) => {
    setDuzenlemeler(prev => ({
      ...prev,
      [siparisId]: {
        ...prev[siparisId],
        [alan]: parseFloat(deger) || 0
      }
    }));
  };

  const guncellemeYap = (siparis) => {
    const eskiMiktar = siparis.miktar || 0;
    const yeniMiktar = siparis.gerceklesenMiktar;
    const yeniBirimFiyat = siparis.gerceklesenBirimFiyat;
    const yeniToplam = siparis.gerceklesenToplam;
    
    const miktarFarki = yeniMiktar - eskiMiktar;

    // Siparişi güncelle ve kontrol edildi olarak işaretle
    const guncelSiparis = {
      ...siparis,
      miktar: yeniMiktar,
      birimFiyat: yeniBirimFiyat,
      toplam: yeniToplam,
      costKontrolYapildi: true,
      notlar: `Fatura: ${siparis.faturaNo} | Tarih: ${siparis.teslimTarihi} | Tutar: ${formatTL(yeniToplam)} (Cost Kontrol'de güncellendi)`
    };

    setSiparisler(siparisler.map(s => s.id === siparis.id ? guncelSiparis : s));

    // Depo stoğunu güncelle (sadece fark kadar ekle/çıkar)
    if (miktarFarki !== 0) {
      const stokItem = stok.find(s => s.ad === siparis.urun);
      if (stokItem) {
        setStok(stok.map(s => 
          s.id === stokItem.id 
            ? { ...s, mevcut: s.mevcut + miktarFarki, birimFiyat: yeniBirimFiyat }
            : s
        ));
      }
    } else {
      // Miktar aynı ama fiyat değişmişse sadece birim fiyatı güncelle
      const stokItem = stok.find(s => s.ad === siparis.urun);
      if (stokItem) {
        setStok(stok.map(s => 
          s.id === stokItem.id 
            ? { ...s, birimFiyat: yeniBirimFiyat }
            : s
        ));
      }
    }

    // Düzenleme state'ini temizle
    setDuzenlemeler(prev => {
      const yeni = { ...prev };
      delete yeni[siparis.id];
      return yeni;
    });

    const mesaj = miktarFarki > 0 
      ? `✅ Güncelleme Başarılı!\n\nÜrün: ${siparis.urun}\nFatura: ${siparis.faturaNo}\n\nEski: ${eskiMiktar} ${siparis.birim}\nYeni: ${yeniMiktar} ${siparis.birim}\nFark: +${miktarFarki.toFixed(2)} ${siparis.birim} depoya eklendi\n\nBirim Fiyat: ${formatTL(yeniBirimFiyat)}\n\nBu sipariş artık listeden gizlendi.`
      : miktarFarki < 0
      ? `✅ Güncelleme Başarılı!\n\nÜrün: ${siparis.urun}\nFatura: ${siparis.faturaNo}\n\nEski: ${eskiMiktar} ${siparis.birim}\nYeni: ${yeniMiktar} ${siparis.birim}\nFark: ${miktarFarki.toFixed(2)} ${siparis.birim} depodan çıkarıldı\n\nBirim Fiyat: ${formatTL(yeniBirimFiyat)}\n\nBu sipariş artık listeden gizlendi.`
      : `✅ Güncelleme Başarılı!\n\nÜrün: ${siparis.urun}\nFatura: ${siparis.faturaNo}\n\nBirim Fiyat: ${formatTL(yeniBirimFiyat)}\n\nMiktar değişikliği yok, sadece fiyat güncellendi.\n\nBu sipariş artık listeden gizlendi.`;

    alert(mesaj);
  };

  // Filtreleme
  const filtrelenmisVeriler = useMemo(() => {
    let sonuc = costVerileri;

    // Tarih filtresi
    if (baslangicTarihi) {
      sonuc = sonuc.filter(s => new Date(s.teslimTarihi) >= new Date(baslangicTarihi));
    }
    if (bitisTarihi) {
      sonuc = sonuc.filter(s => new Date(s.teslimTarihi) <= new Date(bitisTarihi));
    }

    // Tedarikçi filtresi
    if (tedarikciFiltre !== 'Tümü') {
      sonuc = sonuc.filter(s => s.tedarikci === tedarikciFiltre);
    }

    // Ürün arama
    if (urunArama) {
      sonuc = sonuc.filter(s => s.urun.toLowerCase().includes(urunArama.toLowerCase()));
    }

    return sonuc.sort((a, b) => new Date(b.teslimTarihi) - new Date(a.teslimTarihi));
  }, [costVerileri, baslangicTarihi, bitisTarihi, tedarikciFiltre, urunArama]);

  // Özet istatistikler
  const ozet = useMemo(() => {
    const toplamPlanlanan = filtrelenmisVeriler.reduce((sum, s) => sum + s.planlananToplam, 0);
    const toplamGerceklesen = filtrelenmisVeriler.reduce((sum, s) => sum + s.gerceklesenToplam, 0);
    const toplamFark = toplamGerceklesen - toplamPlanlanan;
    const genelVaryans = toplamPlanlanan !== 0 ? ((toplamFark / toplamPlanlanan) * 100).toFixed(1) : 0;

    return {
      kayitSayisi: filtrelenmisVeriler.length,
      toplamPlanlanan,
      toplamGerceklesen,
      toplamFark,
      genelVaryans
    };
  }, [filtrelenmisVeriler]);

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold">Cost Kontrol</h2>
        </div>
      </div>

      {/* Filtreler */}
      <div className="bg-white rounded-xl border p-6">
        <div className="grid grid-cols-12 gap-4">
          <div className="col-span-3">
            <label className="block text-sm font-medium mb-2">Başlangıç Tarihi</label>
            <input
              type="date"
              value={baslangicTarihi}
              onChange={(e) => setBaslangicTarihi(e.target.value)}
              className="w-full px-3 py-2 border rounded-lg"
            />
          </div>
          <div className="col-span-3">
            <label className="block text-sm font-medium mb-2">Bitiş Tarihi</label>
            <input
              type="date"
              value={bitisTarihi}
              onChange={(e) => setBitisTarihi(e.target.value)}
              className="w-full px-3 py-2 border rounded-lg"
            />
          </div>
          <div className="col-span-2">
            <label className="block text-sm font-medium mb-2">Tedarikçi</label>
            <select
              value={tedarikciFiltre}
              onChange={(e) => setTedarikciFiltre(e.target.value)}
              className="w-full px-3 py-2 border rounded-lg"
            >
              <option value="Tümü">Tüm Tedarikçiler</option>
              {Array.from(new Set(tedarikciler.map(t => t.ad))).map(ad => (
                <option key={ad} value={ad}>{ad}</option>
              ))}
            </select>
          </div>
          <div className="col-span-2">
            <label className="block text-sm font-medium mb-2">Ürün Ara</label>
            <input
              type="text"
              value={urunArama}
              onChange={(e) => setUrunArama(e.target.value)}
              placeholder="Ürün adı..."
              className="w-full px-3 py-2 border rounded-lg"
            />
          </div>
          <div className="col-span-2">
            <label className="block text-sm font-medium mb-2">Durum</label>
            <select
              value={kontrolEdilenleriGoster}
              onChange={(e) => setKontrolEdilenleriGoster(e.target.value)}
              className="w-full px-3 py-2 border rounded-lg"
            >
              <option value="bekleyen">Kontrol Bekleyen</option>
              <option value="onaylananlar">Onaylananlar</option>
              <option value="hepsi">Tümü</option>
            </select>
          </div>
        </div>
      </div>

      {/* Tablo */}
      <div className="bg-white rounded-xl border overflow-hidden">
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="bg-gray-50 border-b">
              <tr>
                <th className="px-4 py-3 text-left text-xs font-semibold">Tarih</th>
                <th className="px-4 py-3 text-left text-xs font-semibold">Tedarikçi</th>
                <th className="px-4 py-3 text-left text-xs font-semibold">Ürün</th>
                <th className="px-4 py-3 text-left text-xs font-semibold">Fatura No</th>
                <th className="px-4 py-3 text-center text-xs font-semibold" colSpan="2">Miktar</th>
                <th className="px-4 py-3 text-center text-xs font-semibold" colSpan="2">Birim Fiyat</th>
                <th className="px-4 py-3 text-center text-xs font-semibold" colSpan="2">Toplam</th>
                <th className="px-4 py-3 text-center text-xs font-semibold">İşlem</th>
              </tr>
              <tr className="bg-gray-100 border-b text-xs">
                <th className="px-4 py-2"></th>
                <th className="px-4 py-2"></th>
                <th className="px-4 py-2"></th>
                <th className="px-4 py-2"></th>
                <th className="px-4 py-2 text-center text-blue-700">Plan</th>
                <th className="px-4 py-2 text-center text-green-700">Gerçek</th>
                <th className="px-4 py-2 text-center text-blue-700">Plan</th>
                <th className="px-4 py-2 text-center text-green-700">Gerçek</th>
                <th className="px-4 py-2 text-center text-blue-700">Plan</th>
                <th className="px-4 py-2 text-center text-green-700">Gerçek</th>
                <th className="px-4 py-2"></th>
              </tr>
            </thead>
            <tbody>
              {filtrelenmisVeriler.length === 0 ? (
                <tr>
                  <td colSpan="11" className="px-4 py-12 text-center text-gray-500">
                    {costVerileri.length === 0 ? (
                      <>
                        <AlertCircle className="w-12 h-12 mx-auto mb-3 text-gray-400" />
                        <p className="text-lg font-medium">Kontrol bekleyen sipariş yok</p>
                        <p className="text-sm mt-1">
                          {kontrolEdilenleriGoster === 'hepsi'
                            ? 'Satın Alma sayfasından siparişleri teslim alın'
                            : kontrolEdilenleriGoster === 'onaylananlar'
                            ? 'Henüz onaylanmış sipariş yok. "Kontrol Bekleyen" filtresinden siparişleri onaylayın.'
                            : 'Tüm siparişler kontrol edildi. "Onaylananlar" veya "Tümü" filtresini seçerek görebilirsiniz.'}
                        </p>
                      </>
                    ) : (
                      <>
                        <AlertCircle className="w-12 h-12 mx-auto mb-3 text-gray-400" />
                        <p className="text-lg font-medium">Filtreye uygun kayıt bulunamadı</p>
                        <p className="text-sm mt-1">Farklı filtre seçenekleri deneyebilirsiniz</p>
                      </>
                    )}
                  </td>
                </tr>
              ) : (
                filtrelenmisVeriler.map(siparis => (
                  <tr key={siparis.id} className={`border-b hover:bg-gray-50 ${siparis.costKontrolYapildi ? 'bg-green-50' : ''}`}>
                    <td className="px-4 py-3 text-sm">{formatTarih(siparis.teslimTarihi)}</td>
                    <td className="px-4 py-3 text-sm">{siparis.tedarikci}</td>
                    <td className="px-4 py-3 text-sm font-medium">
                      {siparis.urun}
                      {siparis.costKontrolYapildi && (
                        <span className="ml-2 px-2 py-0.5 bg-green-600 text-white rounded text-xs">
                          ✓ Kontrol Edildi
                        </span>
                      )}
                    </td>
                    <td className="px-4 py-3 text-sm">
                      <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs font-mono">
                        {siparis.faturaNo || '-'}
                      </span>
                    </td>
                    
                    {/* Miktar */}
                    <td className="px-4 py-3 text-center text-sm text-blue-700">
                      {siparis.planlananMiktar.toFixed(2)} {siparis.birim}
                    </td>
                    <td className="px-4 py-3 text-center">
                      <input
                        type="number"
                        step="0.01"
                        value={siparis.gerceklesenMiktar}
                        onChange={(e) => duzenlemeYap(siparis.id, 'miktar', e.target.value)}
                        
                        className="w-24 px-2 py-1 border rounded text-sm text-center font-semibold"
                      />
                      <div className={`text-xs mt-1 ${siparis.miktarFark >= 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                        {siparis.miktarFark > 0 ? '+' : ''}{siparis.miktarFark.toFixed(2)} ({siparis.miktarVaryans}%)
                      </div>
                    </td>

                    {/* Birim Fiyat */}
                    <td className="px-4 py-3 text-center text-sm text-blue-700">
                      {formatTL(siparis.planlananBirimFiyat)}
                    </td>
                    <td className="px-4 py-3 text-center">
                      <input
                        type="number"
                        step="0.01"
                        value={siparis.gerceklesenBirimFiyat}
                        onChange={(e) => duzenlemeYap(siparis.id, 'birimFiyat', e.target.value)}
                        
                        className="w-24 px-2 py-1 border rounded text-sm text-center font-semibold"
                      />
                      <div className={`text-xs mt-1 ${siparis.fiyatFark >= 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                        {siparis.fiyatFark > 0 ? '+' : ''}{formatTL(siparis.fiyatFark)} ({siparis.fiyatVaryans}%)
                      </div>
                    </td>

                    {/* Toplam */}
                    <td className="px-4 py-3 text-center text-sm text-blue-700">
                      {formatTL(siparis.planlananToplam)}
                    </td>
                    <td className="px-4 py-3 text-center">
                      <div className="text-sm font-bold text-green-700">
                        {formatTL(siparis.gerceklesenToplam)}
                      </div>
                      <div className={`text-xs font-semibold mt-1 ${siparis.toplamFark >= 0 ? 'text-red-600' : 'text-emerald-600'}`}>
                        {siparis.toplamFark > 0 ? '+' : ''}{formatTL(siparis.toplamFark)} ({siparis.toplamVaryans}%)
                      </div>
                    </td>

                    {/* Güncelle Butonu */}
                    <td className="px-4 py-3 text-center">
                      <button
                        onClick={() => guncellemeYap(siparis)}
                        className="px-4 py-2 rounded-lg text-sm font-medium shadow-sm bg-blue-600 text-white hover:bg-blue-700"
                      >
                        Güncelle
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

function UretimPlani({ musteriSiparisleri, setMusteriSiparisleri, menu, receteler, musteriler }) {
  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().slice(0, 10));
  const [ogunFiltre, setOgunFiltre] = useState('Tümü');
  const [showYeni, setShowYeni] = useState(false);
  const [showMalzemeListesi, setShowMalzemeListesi] = useState(false);
  const [malzemeListesi, setMalzemeListesi] = useState([]);
  const [malzemeListesiTarih, setMalzemeListesiTarih] = useState('');
  const [yeniForm, setYeniForm] = useState({
    tarih: new Date().toISOString().slice(0, 10),
    musteriId: '',
    kahvaltiPorsiyon: '',
    oglePorsiyon: '',
    aksamPorsiyon: ''
  });

  // Malzeme listesi oluşturma fonksiyonu
  const malzemeListesiOlustur = (tarih) => {
    if (!tarih) return;
    
    // O tarihteki tüm onaylanmış siparişleri al
    const siparisler = musteriSiparisleri.filter(s => s.tarih === tarih && s.durum === 'Onaylandı');
    
    if (siparisler.length === 0) {
      alert('Bu tarihte onaylanmış sipariş bulunamadı!');
      return;
    }

    // Malzeme toplamları için obje
    const malzemeToplam = {};

    siparisler.forEach(siparis => {
      // Menüdeki yemekleri parse et (virgülle ayrılmış)
      const yemekler = siparis.menuAd.split(',').map(y => y.trim());
      
      yemekler.forEach(yemekAd => {
        // Reçeteyi bul
        const recete = receteler.find(r => r.ad === yemekAd && r.aktif);
        
        if (recete && recete.malzemeler) {
          // Porsiyon çarpanı hesapla
          const carpan = siparis.porsiyon / recete.porsiyon;
          
          recete.malzemeler.forEach(malzeme => {
            const stokItem = DEMO_STOK.find(s => s.id === malzeme.stokId);
            if (stokItem) {
              const ihtiyac = malzeme.miktar * carpan;
              
              if (!malzemeToplam[malzeme.stokId]) {
                malzemeToplam[malzeme.stokId] = {
                  stokId: malzeme.stokId,
                  ad: stokItem.ad,
                  birim: stokItem.birim,
                  toplam: 0,
                  mevcut: stokItem.mevcut,
                  kategori: stokItem.kategori
                };
              }
              malzemeToplam[malzeme.stokId].toplam += ihtiyac;
            }
          });
        }
      });
    });

    // Array'e çevir ve sırala
    const liste = Object.values(malzemeToplam)
      .map(m => ({
        ...m,
        eksik: Math.max(0, m.toplam - m.mevcut),
        yeterli: m.mevcut >= m.toplam
      }))
      .sort((a, b) => a.ad.localeCompare(b.ad, 'tr'));

    setMalzemeListesi(liste);
    setMalzemeListesiTarih(tarih);
    setShowMalzemeListesi(true);
  };

  // Malzeme listesi CSV export
  const malzemeListesiExportCSV = () => {
    if (malzemeListesi.length === 0) return;

    const headers = ['Ürün', 'Kategori', 'İhtiyaç', 'Birim', 'Mevcut', 'Eksik', 'Durum'];
    const rows = malzemeListesi.map(m => [
      m.ad,
      m.kategori,
      m.toplam.toFixed(2),
      m.birim,
      m.mevcut.toFixed(2),
      m.eksik.toFixed(2),
      m.yeterli ? 'Yeterli' : 'Yetersiz'
    ]);

    const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
    const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `malzeme_listesi_${malzemeListesiTarih}.csv`;
    link.click();
  };

  // Seçili gün için üretim planı hesapla
  const gunlukPlan = useMemo(() => {
    const gunMenuleri = menu.filter(m => m.tarih === selectedDate);
    const gunSiparisleri = musteriSiparisleri.filter(s => s.tarih === selectedDate && s.durum === 'Onaylandı');
    
    // Yemekleri grupla ve topla
    const yemekler = {};
    
    // Menüden gelen yemekler
    gunMenuleri.forEach(m => {
      const yemekListesi = m.yemekler.split(',').map(y => y.trim());
      yemekListesi.forEach(yemek => {
        if (!yemekler[yemek]) {
          yemekler[yemek] = { ad: yemek, porsiyon: 0, ogun: m.ogun, musteriler: [] };
        }
      });
    });
    
    // Müşteri siparişlerinden gelen yemekler ve porsiyonlar
    gunSiparisleri.forEach(siparis => {
      const yemekListesi = siparis.menuAd.split(',').map(y => y.trim());
      yemekListesi.forEach(yemek => {
        if (!yemekler[yemek]) {
          yemekler[yemek] = { ad: yemek, porsiyon: 0, ogun: siparis.ogun, musteriler: [] };
        }
        yemekler[yemek].porsiyon += siparis.porsiyon;
        yemekler[yemek].musteriler.push({
          musteri: siparis.musteri,
          porsiyon: siparis.porsiyon
        });
      });
    });
    
    return Object.values(yemekler);
  }, [menu, musteriSiparisleri, selectedDate]);

  // Öğüne göre grupla ve toplam porsiyonları hesapla
  const ogunlerGruplu = useMemo(() => {
    const grup = {
      'Kahvaltı': { porsiyon: 0, yemekler: [] },
      'Öğle': { porsiyon: 0, yemekler: [] },
      'Akşam': { porsiyon: 0, yemekler: [] }
    };
    
    gunlukPlan.forEach(yemek => {
      if (grup[yemek.ogun]) {
        grup[yemek.ogun].porsiyon += yemek.porsiyon;
        grup[yemek.ogun].yemekler.push(yemek);
      }
    });
    
    return grup;
  }, [gunlukPlan]);

  const toplamPorsiyon = gunlukPlan.reduce((acc, y) => acc + y.porsiyon, 0);

  const yeniEkle = async () => {
    console.log('🔵 Müşteri Siparişi Ekle butonuna tıklandı!');
    console.log('Form değerleri:', yeniForm);
    
    if (!yeniForm.musteriId) {
      alert('Müşteri seçin!');
      return;
    }

    const musteri = musteriler.find(m => m.id === Number(yeniForm.musteriId));
    console.log('Seçilen müşteri:', musteri);
    
    const yeniSiparisler = [];
    let siparisId = Math.max(0, ...musteriSiparisleri.map(s => s.id)) + 1;

    // Kahvaltı ekle
    if (yeniForm.kahvaltiPorsiyon && Number(yeniForm.kahvaltiPorsiyon) > 0) {
      const kahvaltiMenu = menu.find(m => m.tarih === yeniForm.tarih && m.ogun === 'Kahvaltı');
      console.log('Kahvaltı menüsü:', kahvaltiMenu);
      if (kahvaltiMenu) {
        yeniSiparisler.push({
          id: siparisId++,
          tarih: yeniForm.tarih,
          musteri: musteri.ad,
          musteriId: Number(yeniForm.musteriId),
          ogun: 'Kahvaltı',
          porsiyon: Number(yeniForm.kahvaltiPorsiyon),
          menuAd: kahvaltiMenu.yemekler,
          durum: "Onaylandı"
        });
      }
    }

    // Öğle ekle
    if (yeniForm.oglePorsiyon && Number(yeniForm.oglePorsiyon) > 0) {
      const ogleMenu = menu.find(m => m.tarih === yeniForm.tarih && m.ogun === 'Öğle');
      console.log('Öğle menüsü:', ogleMenu);
      if (ogleMenu) {
        yeniSiparisler.push({
          id: siparisId++,
          tarih: yeniForm.tarih,
          musteri: musteri.ad,
          musteriId: Number(yeniForm.musteriId),
          ogun: 'Öğle',
          porsiyon: Number(yeniForm.oglePorsiyon),
          menuAd: ogleMenu.yemekler,
          durum: "Onaylandı"
        });
      }
    }

    // Akşam ekle
    if (yeniForm.aksamPorsiyon && Number(yeniForm.aksamPorsiyon) > 0) {
      const aksamMenu = menu.find(m => m.tarih === yeniForm.tarih && m.ogun === 'Akşam');
      console.log('Akşam menüsü:', aksamMenu);
      if (aksamMenu) {
        yeniSiparisler.push({
          id: siparisId++,
          tarih: yeniForm.tarih,
          musteri: musteri.ad,
          musteriId: Number(yeniForm.musteriId),
          ogun: 'Akşam',
          porsiyon: Number(yeniForm.aksamPorsiyon),
          menuAd: aksamMenu.yemekler,
          durum: "Onaylandı"
        });
      }
    }

    console.log('Oluşturulan siparişler:', yeniSiparisler);

    if (yeniSiparisler.length === 0) {
      alert('En az bir öğün için porsiyon girin veya bu tarih için menü tanımlayın!');
      return;
    }

    // Supabase'e kaydet
try {
  const { data, error } = await supabase
    .from('musteri_siparisleri')
    .insert([{
      musteri_id: Number(yeniForm.musteriId),
      musteri_ad: musteri?.ad || '',
      tarih: yeniForm.tarih,
      menu_ad: yeniForm.menuAd,
      porsiyon: Number(yeniForm.porsiyon) || 1,
      fiyat: Number(yeniForm.fiyat) || 0,
      durum: 'Beklemede',
      notlar: yeniForm.notlar || ''
    }])
    .select();

  if (error) throw error;

  setMusteriSiparisleri([...musteriSiparisleri, data[0]]);
  localStorage.setItem('lezzetsel_musteriSiparisleri', JSON.stringify([...musteriSiparisleri, data[0]]));
  setYeniForm({ musteriId: '', tarih: '', menuAd: '', porsiyon: 1, fiyat: 0, notlar: '' });
  setShowYeniSiparis(false);
  alert('✅ Sipariş eklendi!');
} catch (err) {
  console.error('Sipariş ekleme hatası:', err);
  alert('❌ Hata: ' + err.message);
}

  // Modal açıldığında formu sıfırla
  const modalAc = () => {
    setYeniForm({ 
      tarih: selectedDate, 
      musteriId: '', 
      kahvaltiPorsiyon: '', 
      oglePorsiyon: '', 
      aksamPorsiyon: '' 
    });
    setShowYeni(true);
  };

  const siparisSil = async (id) => {
  if (!window.confirm('Bu siparişi silmek istediğinizden emin misiniz?')) {
    return;
  }

  try {
    const { error } = await supabase
      .from('musteri_siparisleri')
      .delete()
      .eq('id', id);

    if (error) throw error;

    const yeniSiparisListesi = musteriSiparisleri.filter(s => s.id !== id);
    setMusteriSiparisleri(yeniSiparisListesi);
    localStorage.setItem('lezzetsel_musteriSiparisleri', JSON.stringify(yeniSiparisListesi));
    alert('✅ Sipariş silindi!');
  } catch (err) {
    console.error('Sipariş silme hatası:', err);
    alert('❌ Hata: ' + err.message);
  }
};

  const siparisDurumDegistir = (id, yeniDurum) => {
    setMusteriSiparisleri(musteriSiparisleri.map(s => 
      s.id === id ? { ...s, durum: yeniDurum } : s
    ));
    alert(`✅ Sipariş durumu "${yeniDurum}" olarak güncellendi!`);
  };

  const [showDuzenle, setShowDuzenle] = useState(false);
  const [duzenleForm, setDuzenleForm] = useState(null);

  const siparisDuzenle = (siparis) => {
    setDuzenleForm({
      id: siparis.id,
      musteri: siparis.musteri,
      musteriId: siparis.musteriId,
      tarih: siparis.tarih,
      ogun: siparis.ogun,
      porsiyon: siparis.porsiyon,
      durum: siparis.durum
    });
    setShowDuzenle(true);
  };

  const duzenleKaydet = () => {
    if (!duzenleForm.porsiyon || duzenleForm.porsiyon <= 0) {
      alert('⚠️ Geçerli bir porsiyon giriniz!');
      return;
    }

    setMusteriSiparisleri(musteriSiparisleri.map(s => 
      s.id === duzenleForm.id 
        ? { 
            ...s, 
            porsiyon: Number(duzenleForm.porsiyon),
            durum: duzenleForm.durum 
          }
        : s
    ));
    
    setShowDuzenle(false);
    setDuzenleForm(null);
    alert('✅ Sipariş güncellendi!');
  };

  const gunSiparisleri = musteriSiparisleri.filter(s => s.tarih === selectedDate);

  // CSV oluşturma fonksiyonu - sadece onaylanmış siparişler
  const musteriOzetTablosu = () => {
    let csv = 'Müşteri,Kahvaltı,Öğle,Akşam,Toplam\n';
    
    const onaylananSiparisler = gunSiparisleri.filter(s => s.durum === 'Onaylandı');
    const musteriGrup = {};
    onaylananSiparisler.forEach(siparis => {
      if (!musteriGrup[siparis.musteri]) {
        musteriGrup[siparis.musteri] = { kahvalti: 0, ogle: 0, aksam: 0 };
      }
      if (siparis.ogun === 'Kahvaltı') musteriGrup[siparis.musteri].kahvalti += siparis.porsiyon;
      if (siparis.ogun === 'Öğle') musteriGrup[siparis.musteri].ogle += siparis.porsiyon;
      if (siparis.ogun === 'Akşam') musteriGrup[siparis.musteri].aksam += siparis.porsiyon;
    });
    
    Object.entries(musteriGrup).forEach(([musteri, data]) => {
      const toplam = data.kahvalti + data.ogle + data.aksam;
      csv += `${musteri},${data.kahvalti},${data.ogle},${data.aksam},${toplam}\n`;
    });
    
    const toplamKahvalti = onaylananSiparisler.filter(s => s.ogun === 'Kahvaltı').reduce((acc, s) => acc + s.porsiyon, 0);
    const toplamOgle = onaylananSiparisler.filter(s => s.ogun === 'Öğle').reduce((acc, s) => acc + s.porsiyon, 0);
    const toplamAksam = onaylananSiparisler.filter(s => s.ogun === 'Akşam').reduce((acc, s) => acc + s.porsiyon, 0);
    const genelToplam = toplamKahvalti + toplamOgle + toplamAksam;
    
    csv += `TOPLAM,${toplamKahvalti},${toplamOgle},${toplamAksam},${genelToplam}\n`;
    
    return csv;
  };

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold">Günlük Üretim Planı</h2>
        </div>
        <button onClick={() => modalAc()} className="px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center gap-2 hover:bg-blue-700">
          <Plus className="w-4 h-4" />
          Pax Ekle
        </button>
      </div>

      {/* Tarih ve Öğün Seçici */}
      <div className="bg-white rounded-xl border p-6">
        <div className="grid grid-cols-12 gap-4 items-end">
          <div className="col-span-3">
            <label className="block text-sm font-medium mb-1">Tarih</label>
            <input 
              type="date" 
              value={selectedDate} 
              onChange={(e) => setSelectedDate(e.target.value)} 
              className="w-full px-4 py-2 border rounded-lg font-semibold"
            />
          </div>
          <div className="col-span-6">
            <label className="block text-sm font-medium mb-1">Öğün Filtresi</label>
            <div className="flex gap-2 bg-gray-100 rounded-lg p-1">
              {['Tümü', 'Kahvaltı', 'Öğle', 'Akşam'].map(ogun => (
                <button
                  key={ogun}
                  onClick={() => setOgunFiltre(ogun)}
                  className={`flex-1 px-3 py-2 rounded-md text-sm font-medium transition-colors ${
                    ogunFiltre === ogun 
                      ? 'bg-white text-blue-600 shadow-sm' 
                      : 'text-gray-600 hover:text-gray-900'
                  }`}
                >
                  {ogun}
                </button>
              ))}
            </div>
          </div>
          <div className="col-span-3">
            <button
              onClick={() => malzemeListesiOlustur(selectedDate)}
              className="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 font-medium"
            >
              <ClipboardCheck className="w-4 h-4" />
              Malzeme Listesi
            </button>
          </div>
        </div>
      </div>

      {/* Öğün Bazlı Üretim Planı - Bekleyen Siparişler */}
      <div className="bg-gradient-to-r from-yellow-50 to-orange-50 border-2 border-yellow-300 rounded-xl p-4 mb-6">
        <h3 className="text-lg font-bold text-orange-800 mb-2">⏳ Bekleyen Siparişler (Onay Gerekiyor)</h3>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {Object.entries(ogunlerGruplu)
          .filter(([ogun]) => ogunFiltre === 'Tümü' || ogun === ogunFiltre)
          .map(([ogun, data]) => {
          // Benzersiz yemekleri topla
          const benzersizYemekler = [...new Set(data.yemekler.flatMap(y => y.ad))].join(', ');
          
          // SADECE BEKLEMEDEKİ siparişleri göster
          const bekleyenMusteriler = gunSiparisleri.filter(s => s.ogun === ogun && s.durum === 'Beklemede');
          const bekleyenToplam = bekleyenMusteriler.reduce((acc, s) => acc + s.porsiyon, 0);
          
          return (
            <div key={ogun} className="bg-white rounded-xl border-2 border-yellow-200 shadow-lg p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className={`text-base font-bold px-3 py-1.5 rounded-full ${
                  ogun === 'Kahvaltı' ? 'bg-yellow-100 text-yellow-700' :
                  ogun === 'Öğle' ? 'bg-orange-100 text-orange-700' :
                  'bg-purple-100 text-purple-700'
                }`}>
                  {ogun === 'Kahvaltı' ? '🌅' : ogun === 'Öğle' ? '☀️' : '🌙'} {ogun}
                </h3>
                {bekleyenToplam > 0 && (
                  <span className="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-bold">
                    {bekleyenToplam} pax bekliyor
                  </span>
                )}
              </div>
              
              {bekleyenMusteriler.length === 0 ? (
                <div className="text-center py-8">
                  <p className="text-green-600 text-sm font-medium">✅ Tüm siparişler onaylandı!</p>
                </div>
              ) : (
                <div className="space-y-2">
                  {bekleyenMusteriler.map((siparis) => (
                    <div key={siparis.id} className="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                      <div className="flex justify-between items-start mb-2">
                        <div className="flex-1">
                          <p className="font-semibold text-gray-900">{siparis.musteri}</p>
                        </div>
                        <span className="text-xl font-bold text-orange-600">{siparis.porsiyon}</span>
                      </div>
                      <div className="flex gap-1 mt-2 pt-2 border-t border-yellow-200">
                        <button 
                          onClick={() => siparisDurumDegistir(siparis.id, 'Onaylandı')}
                          className="flex-1 px-3 py-1.5 bg-green-600 text-white rounded text-xs font-medium hover:bg-green-700 flex items-center justify-center gap-1"
                          title="Onayla"
                        >
                          <svg className="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
                          </svg>
                          Onayla
                        </button>
                        <button 
                          onClick={() => siparisDuzenle(siparis)}
                          className="px-2 py-1.5 text-blue-600 hover:bg-blue-50 rounded"
                          title="Düzenle"
                        >
                          <Edit2 className="w-3.5 h-3.5" />
                        </button>
                        <button 
                          onClick={() => siparisSil(siparis.id)}
                          className="px-2 py-1.5 text-red-600 hover:bg-red-50 rounded"
                          title="Sil"
                        >
                          <Trash2 className="w-3.5 h-3.5" />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          );
        })}
      </div>

      {/* Müşteri Siparişleri Tablosu - Sadece Onaylanmış */}
      <div className="bg-white rounded-xl border overflow-hidden">
        <div className="px-6 py-4 bg-green-50 border-b flex justify-between items-center">
          <div>
            <h3 className="text-lg font-semibold text-green-800">✅ Onaylanmış Üretim Planı</h3>
          </div>
          <div className="flex gap-2">
            <button 
              onClick={() => {
                const csv = musteriOzetTablosu();
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `uretim-plani-${selectedDate}.csv`;
                a.click();
              }}
              className="px-3 py-1.5 bg-green-600 text-white rounded-lg text-sm flex items-center gap-1 hover:bg-green-700"
            >
              <Download className="w-4 h-4" />
              CSV İndir
            </button>
            <button 
              onClick={() => window.print()}
              className="px-3 py-1.5 bg-blue-600 text-white rounded-lg text-sm flex items-center gap-1 hover:bg-blue-700"
            >
              <FileText className="w-4 h-4" />
              Yazdır
            </button>
          </div>
        </div>
        
        {gunSiparisleri.filter(s => s.durum === 'Onaylandı').length === 0 ? (
          <div className="p-8 text-center text-gray-500">
            <div className="mb-2 text-4xl">⏳</div>
            <p className="font-medium">Henüz onaylanmış sipariş yok</p>
            <p className="text-sm mt-1">Yukarıdaki bekleyen siparişleri onaylayın.</p>
          </div>
        ) : (
          <table className="w-full">
            <thead className="bg-gray-50 border-b">
              <tr>
                <th className="px-4 py-3 text-left text-sm font-semibold">Müşteri</th>
                <th className="px-4 py-3 text-center text-sm font-semibold">Kahvaltı</th>
                <th className="px-4 py-3 text-center text-sm font-semibold">Öğle</th>
                <th className="px-4 py-3 text-center text-sm font-semibold">Akşam</th>
                <th className="px-4 py-3 text-center text-sm font-semibold">Toplam</th>
              </tr>
            </thead>
            <tbody>
              {(() => {
                // Sadece onaylanmış siparişleri filtrele
                const onaylananSiparisler = gunSiparisleri.filter(s => s.durum === 'Onaylandı');
                
                // Müşterileri grupla ve öğünlere göre düzenle
                const musteriGrup = {};
                onaylananSiparisler.forEach(siparis => {
                  if (!musteriGrup[siparis.musteri]) {
                    musteriGrup[siparis.musteri] = {
                      musteri: siparis.musteri,
                      kahvalti: 0,
                      ogle: 0,
                      aksam: 0,
                      siparisler: []
                    };
                  }
                  if (siparis.ogun === 'Kahvaltı') musteriGrup[siparis.musteri].kahvalti += siparis.porsiyon;
                  if (siparis.ogun === 'Öğle') musteriGrup[siparis.musteri].ogle += siparis.porsiyon;
                  if (siparis.ogun === 'Akşam') musteriGrup[siparis.musteri].aksam += siparis.porsiyon;
                  musteriGrup[siparis.musteri].siparisler.push(siparis);
                });
                
                return Object.values(musteriGrup).map((grup, idx) => {
                  const toplam = grup.kahvalti + grup.ogle + grup.aksam;
                  return (
                    <tr key={idx} className="border-b hover:bg-gray-50">
                      <td className="px-4 py-3 font-medium">{grup.musteri}</td>
                      <td className="px-4 py-3 text-center">
                        {grup.kahvalti > 0 ? (
                          <span className="inline-block px-2 py-1 bg-yellow-100 text-yellow-800 rounded font-semibold text-sm">
                            {grup.kahvalti}
                          </span>
                        ) : (
                          <span className="text-gray-300">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 text-center">
                        {grup.ogle > 0 ? (
                          <span className="inline-block px-2 py-1 bg-orange-100 text-orange-800 rounded font-semibold text-sm">
                            {grup.ogle}
                          </span>
                        ) : (
                          <span className="text-gray-300">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 text-center">
                        {grup.aksam > 0 ? (
                          <span className="inline-block px-2 py-1 bg-purple-100 text-purple-800 rounded font-semibold text-sm">
                            {grup.aksam}
                          </span>
                        ) : (
                          <span className="text-gray-300">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 text-center">
                        <span className="text-lg font-bold text-green-600">{toplam}</span>
                      </td>
                    </tr>
                  );
                });
              })()}
              
              {/* Toplam Satırı */}
              <tr className="bg-green-50 font-bold border-t-2 border-green-300">
                <td className="px-4 py-3 text-green-800">TOPLAM ÜRETİM</td>
                <td className="px-4 py-3 text-center text-green-700">
                  {gunSiparisleri.filter(s => s.ogun === 'Kahvaltı' && s.durum === 'Onaylandı').reduce((acc, s) => acc + s.porsiyon, 0)}
                </td>
                <td className="px-4 py-3 text-center text-green-700">
                  {gunSiparisleri.filter(s => s.ogun === 'Öğle' && s.durum === 'Onaylandı').reduce((acc, s) => acc + s.porsiyon, 0)}
                </td>
                <td className="px-4 py-3 text-center text-green-700">
                  {gunSiparisleri.filter(s => s.ogun === 'Akşam' && s.durum === 'Onaylandı').reduce((acc, s) => acc + s.porsiyon, 0)}
                </td>
                <td className="px-4 py-3 text-center text-green-700 text-xl">
                  {gunSiparisleri.filter(s => s.durum === 'Onaylandı').reduce((acc, s) => acc + s.porsiyon, 0)}
                </td>
              </tr>
            </tbody>
          </table>
        )}
      </div>

      {/* Yeni Sipariş Modal */}
      {showYeni && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h3 className="text-xl font-bold mb-4">🍽️ Pax Ekle (Müşteri Siparişi)</h3>
            <div className="space-y-4">
              {/* Müşteri ve Tarih Seçimi */}
              <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="block text-sm font-medium mb-1">Müşteri *</label>
                    <select 
                      value={yeniForm.musteriId} 
                      onChange={(e) => setYeniForm({...yeniForm, musteriId: e.target.value})} 
                      className="w-full px-3 py-2 border rounded-lg"
                    >
                      <option value="">Müşteri Seçin</option>
                      {musteriler.filter(m => m.aktif).map(m => (
                        <option key={m.id} value={m.id}>{m.ad}</option>
                      ))}
                    </select>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">Tarih *</label>
                    <input 
                      type="date" 
                      value={yeniForm.tarih} 
                      onChange={(e) => setYeniForm({...yeniForm, tarih: e.target.value})} 
                      className="w-full px-3 py-2 border rounded-lg" 
                    />
                  </div>
                </div>
              </div>

              {/* Öğün Ekleme Alanları */}
              {yeniForm.musteriId && (
                <div className="space-y-3">
                  
                  {/* Kahvaltı */}
                  {(() => {
                    const kahvaltiMenu = menu.find(m => m.tarih === yeniForm.tarih && m.ogun === 'Kahvaltı');
                    return (
                      <div className="border-2 rounded-lg p-4 bg-yellow-50 hover:border-yellow-300 transition-colors">
                        <div className="flex items-center justify-between mb-2">
                          <div className="flex items-center gap-2">
                            <span className="px-3 py-1 bg-yellow-200 text-yellow-800 rounded-full text-sm font-semibold">🌅 Kahvaltı</span>
                            <span className="text-xs text-gray-500 italic">(İsteğe bağlı)</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <input 
                              type="number" 
                              placeholder="Pax"
                              value={yeniForm.kahvaltiPorsiyon || ''} 
                              onChange={(e) => setYeniForm({...yeniForm, kahvaltiPorsiyon: e.target.value})} 
                              className="w-24 px-3 py-2 border-2 rounded-lg text-center font-semibold focus:ring-2 focus:ring-yellow-400"
                              min="0"
                            />
                            <span className="text-sm text-gray-600 font-medium">pax</span>
                          </div>
                        </div>
                      </div>
                    );
                  })()}

                  {/* Öğle */}
                  {(() => {
                    const ogleMenu = menu.find(m => m.tarih === yeniForm.tarih && m.ogun === 'Öğle');
                    return (
                      <div className="border-2 rounded-lg p-4 bg-orange-50 hover:border-orange-300 transition-colors">
                        <div className="flex items-center justify-between mb-2">
                          <div className="flex items-center gap-2">
                            <span className="px-3 py-1 bg-orange-200 text-orange-800 rounded-full text-sm font-semibold">☀️ Öğle</span>
                            <span className="text-xs text-gray-500 italic">(İsteğe bağlı)</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <input 
                              type="number" 
                              placeholder="Pax"
                              value={yeniForm.oglePorsiyon || ''} 
                              onChange={(e) => setYeniForm({...yeniForm, oglePorsiyon: e.target.value})} 
                              className="w-24 px-3 py-2 border-2 rounded-lg text-center font-semibold focus:ring-2 focus:ring-orange-400"
                              min="0"
                            />
                            <span className="text-sm text-gray-600 font-medium">pax</span>
                          </div>
                        </div>
                      </div>
                    );
                  })()}

                  {/* Akşam */}
                  {(() => {
                    const aksamMenu = menu.find(m => m.tarih === yeniForm.tarih && m.ogun === 'Akşam');
                    return (
                      <div className="border-2 rounded-lg p-4 bg-purple-50 hover:border-purple-300 transition-colors">
                        <div className="flex items-center justify-between mb-2">
                          <div className="flex items-center gap-2">
                            <span className="px-3 py-1 bg-purple-200 text-purple-800 rounded-full text-sm font-semibold">🌙 Akşam</span>
                            <span className="text-xs text-gray-500 italic">(İsteğe bağlı)</span>
                          </div>
                          <div className="flex items-center gap-2">
                            <input 
                              type="number" 
                              placeholder="Pax"
                              value={yeniForm.aksamPorsiyon || ''} 
                              onChange={(e) => setYeniForm({...yeniForm, aksamPorsiyon: e.target.value})} 
                              className="w-24 px-3 py-2 border-2 rounded-lg text-center font-semibold focus:ring-2 focus:ring-purple-400"
                              min="0"
                            />
                            <span className="text-sm text-gray-600 font-medium">pax</span>
                          </div>
                        </div>
                      </div>
                    );
                  })()}

                  {/* Toplam Özet */}
                  {(() => {
                    const toplam = Number(yeniForm.kahvaltiPorsiyon || 0) + 
                                   Number(yeniForm.oglePorsiyon || 0) + 
                                   Number(yeniForm.aksamPorsiyon || 0);
                    if (toplam > 0) {
                      return (
                        <div className="bg-green-50 border-2 border-green-300 rounded-lg p-4">
                          <div className="flex justify-between items-center">
                            <span className="text-sm font-semibold text-green-800">✅ Toplam Pax:</span>
                            <span className="text-2xl font-bold text-green-700">{toplam}</span>
                          </div>
                        </div>
                      );
                    }
                  })()}
                </div>
              )}

              {!yeniForm.musteriId && (
                <div className="text-center py-8 text-gray-400 text-sm">
                  Önce müşteri seçin
                </div>
              )}
            </div>
            <div className="flex gap-3 mt-6">
              <button onClick={() => {
                console.log('İptal butonuna tıklandı');
                setShowYeni(false);
                setYeniForm({ 
                  tarih: new Date().toISOString().slice(0, 10), 
                  musteriId: '', 
                  kahvaltiPorsiyon: '', 
                  oglePorsiyon: '', 
                  aksamPorsiyon: '' 
                });
              }} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button 
                onClick={() => {
                  const isDisabled = !yeniForm.musteriId || (!yeniForm.kahvaltiPorsiyon && !yeniForm.oglePorsiyon && !yeniForm.aksamPorsiyon);
                  
                  if (isDisabled) {
                    const nedenler = [];
                    if (!yeniForm.musteriId) nedenler.push('• Müşteri seçilmemiş');
                    if (!yeniForm.kahvaltiPorsiyon && !yeniForm.oglePorsiyon && !yeniForm.aksamPorsiyon) {
                      nedenler.push('• En az bir öğün için pax girilmeli');
                    }
                    alert('⚠️ Pax eklenemedi!\n\nLütfen kontrol edin:\n' + nedenler.join('\n'));
                    return;
                  }
                  
                  console.log('🔵 Siparişleri Ekle butonuna tıklandı');
                  console.log('Müşteri ID:', yeniForm.musteriId);
                  console.log('Kahvaltı:', yeniForm.kahvaltiPorsiyon);
                  console.log('Öğle:', yeniForm.oglePorsiyon);
                  console.log('Akşam:', yeniForm.aksamPorsiyon);
                  yeniEkle();
                }}
                className={`flex-1 px-4 py-2 rounded-lg transition-colors ${
                  !yeniForm.musteriId || (!yeniForm.kahvaltiPorsiyon && !yeniForm.oglePorsiyon && !yeniForm.aksamPorsiyon)
                    ? 'bg-gray-300 cursor-not-allowed'
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`}
              >
                Pax Ekle
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Düzenle Modal */}
      {showDuzenle && duzenleForm && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-lg w-full">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-xl font-bold">✏️ Pax Düzenle</h3>
              <button 
                onClick={() => {
                  setShowDuzenle(false);
                  setDuzenleForm(null);
                }} 
                className="p-2 hover:bg-gray-100 rounded-lg"
              >
                <X className="w-5 h-5" />
              </button>
            </div>

            <div className="space-y-4">
              {/* Sipariş Bilgileri */}
              <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <p className="text-sm text-blue-800">
                  <strong>Müşteri:</strong> {duzenleForm.musteri}<br />
                  <strong>Tarih:</strong> {formatTarih(duzenleForm.tarih)}<br />
                  <strong>Öğün:</strong> <span className={`px-2 py-0.5 rounded text-xs ${
                    duzenleForm.ogun === 'Kahvaltı' ? 'bg-yellow-100 text-yellow-800' :
                    duzenleForm.ogun === 'Öğle' ? 'bg-orange-100 text-orange-800' :
                    'bg-purple-100 text-purple-800'
                  }`}>{duzenleForm.ogun}</span>
                </p>
              </div>

              {/* Porsiyon */}
              <div>
                <label className="block text-sm font-medium mb-2">Porsiyon (Pax) *</label>
                <input
                  type="number"
                  value={duzenleForm.porsiyon}
                  onChange={(e) => setDuzenleForm({...duzenleForm, porsiyon: e.target.value})}
                  min="1"
                  className="w-full px-4 py-3 border-2 rounded-lg text-center text-lg font-bold focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              {/* Durum */}
              <div>
                <label className="block text-sm font-medium mb-2">Durum</label>
                <select
                  value={duzenleForm.durum}
                  onChange={(e) => setDuzenleForm({...duzenleForm, durum: e.target.value})}
                  className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                >
                  <option value="Beklemede">Beklemede</option>
                  <option value="Onaylandı">Onaylandı</option>
                  <option value="Hazırlanıyor">Hazırlanıyor</option>
                  <option value="Tamamlandı">Tamamlandı</option>
                  <option value="İptal">İptal</option>
                </select>
              </div>
            </div>

            {/* Butonlar */}
            <div className="flex gap-4 mt-6">
              <button
                onClick={() => {
                  setShowDuzenle(false);
                  setDuzenleForm(null);
                }}
                className="flex-1 px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-semibold"
              >
                İptal
              </button>
              <button
                onClick={duzenleKaydet}
                className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
              >
                Güncelle
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Malzeme Listesi Modalı */}
      {showMalzemeListesi && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <div className="bg-white rounded-xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col">
            {/* Başlık */}
            <div className="bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-4">
              <div className="flex items-center justify-between">
                <div>
                  <h3 className="text-2xl font-bold">📋 Malzeme İhtiyaç Listesi</h3>
                  <p className="text-green-100 mt-1">Tarih: {formatTarih(malzemeListesiTarih)}</p>
                </div>
                <button
                  onClick={() => setShowMalzemeListesi(false)}
                  className="p-2 hover:bg-green-800 rounded-lg transition-colors"
                >
                  <X className="w-6 h-6" />
                </button>
              </div>
            </div>

            {/* Özet Bilgiler */}
            <div className="px-6 py-4 bg-gray-50 border-b grid grid-cols-3 gap-4">
              <div className="text-center">
                <div className="text-2xl font-bold text-gray-900">{malzemeListesi.length}</div>
                <div className="text-sm text-gray-600">Toplam Malzeme</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-green-600">
                  {malzemeListesi.filter(m => m.yeterli).length}
                </div>
                <div className="text-sm text-gray-600">Yeterli</div>
              </div>
              <div className="text-center">
                <div className="text-2xl font-bold text-red-600">
                  {malzemeListesi.filter(m => !m.yeterli).length}
                </div>
                <div className="text-sm text-gray-600">Yetersiz</div>
              </div>
            </div>

            {/* Tablo */}
            <div className="flex-1 overflow-y-auto p-6">
              <table className="w-full">
                <thead className="bg-gray-50 border-b-2 sticky top-0">
                  <tr>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Ürün</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Kategori</th>
                    <th className="px-4 py-3 text-right text-sm font-semibold">İhtiyaç</th>
                    <th className="px-4 py-3 text-right text-sm font-semibold">Mevcut</th>
                    <th className="px-4 py-3 text-right text-sm font-semibold">Eksik</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Durum</th>
                  </tr>
                </thead>
                <tbody>
                  {malzemeListesi.map((malzeme, index) => (
                    <tr key={index} className={`border-b hover:bg-gray-50 ${!malzeme.yeterli ? 'bg-red-50' : ''}`}>
                      <td className="px-4 py-3 font-medium">{malzeme.ad}</td>
                      <td className="px-4 py-3 text-center">
                        <span className="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">
                          {malzeme.kategori}
                        </span>
                      </td>
                      <td className="px-4 py-3 text-right font-semibold">
                        {malzeme.toplam.toFixed(2)} {malzeme.birim}
                      </td>
                      <td className="px-4 py-3 text-right">
                        {malzeme.mevcut.toFixed(2)} {malzeme.birim}
                      </td>
                      <td className="px-4 py-3 text-right">
                        {malzeme.eksik > 0 ? (
                          <span className="text-red-600 font-semibold">
                            {malzeme.eksik.toFixed(2)} {malzeme.birim}
                          </span>
                        ) : (
                          <span className="text-gray-400">-</span>
                        )}
                      </td>
                      <td className="px-4 py-3 text-center">
                        {malzeme.yeterli ? (
                          <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold">
                            ✓ Yeterli
                          </span>
                        ) : (
                          <span className="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold">
                            ⚠ Yetersiz
                          </span>
                        )}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {/* Alt Butonlar */}
            <div className="px-6 py-4 bg-gray-50 border-t flex gap-3 justify-end">
              <button
                onClick={() => setShowMalzemeListesi(false)}
                className="px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 font-medium"
              >
                Kapat
              </button>
              <button
                onClick={malzemeListesiExportCSV}
                className="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2 font-medium"
              >
                <Download className="w-4 h-4" />
                CSV İndir
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

}
function Siparisler({ siparisler, setSiparisler, tedarikciler, stok, receteler, menu, musteriSiparisleri }) {
  const [showYeni, setShowYeni] = useState(false);
  const [showOtomatik, setShowOtomatik] = useState(false);
  
  // Manuel sipariş için satır bazlı form
  const [manuelSiparisKalemleri, setManuelSiparisKalemleri] = useState([{
    stokId: '',
    miktar: 0,
    teslimTarihi: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
    notlar: ''
  }]);

  // Otomatik sipariş için
  const yarin = new Date();
  yarin.setDate(yarin.getDate() + 1);
  
  const [otomatikForm, setOtomatikForm] = useState({
    baslangicTarihi: yarin.toISOString().slice(0, 10),
    bitisTarihi: new Date(yarin.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
    siparisKalemleri: []
  });

  // Manuel sipariş satır ekle/çıkar
  const satirEkle = () => {
    setManuelSiparisKalemleri([...manuelSiparisKalemleri, {
      stokId: '',
      miktar: 0,
      teslimTarihi: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
      notlar: ''
    }]);
  };

  const satirSil = (index) => {
    if (manuelSiparisKalemleri.length > 1) {
      setManuelSiparisKalemleri(manuelSiparisKalemleri.filter((_, i) => i !== index));
    }
  };

  const satirGuncelle = (index, field, value) => {
    const yeniSatirlar = [...manuelSiparisKalemleri];
    yeniSatirlar[index][field] = value;
    setManuelSiparisKalemleri(yeniSatirlar);
  };

  // Manuel sipariş kaydet
  const manuelSiparisKaydet = () => {
    const gecerliKalemler = manuelSiparisKalemleri.filter(k => k.stokId && k.miktar > 0);
    
    if (gecerliKalemler.length === 0) {
      alert('En az bir ürün ve miktar girmelisiniz!');
      return;
    }

    let yeniId = Math.max(0, ...siparisler.map(s => s.id));
    const yeniSiparisler = gecerliKalemler.map(kalem => {
      yeniId++;
      const stokItem = stok.find(s => s.id === Number(kalem.stokId));
      
      return {
        id: yeniId,
        tarih: new Date().toISOString().slice(0, 10),
        teslimTarihi: kalem.teslimTarihi,
        tedarikci: 'Beklemede',
        tedarikciId: 0,
        urun: stokItem.ad,
        miktar: Number(kalem.miktar),
        birim: stokItem.birim,
        birimFiyat: 0,
        toplam: 0,
        notlar: kalem.notlar || '',
        durum: 'Beklemede'
      };
    });

    setSiparisler([...siparisler, ...yeniSiparisler]);
    setShowYeni(false);
    setManuelSiparisKalemleri([{
      stokId: '',
      miktar: 0,
      teslimTarihi: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
      notlar: ''
    }]);
    alert(`✅ ${yeniSiparisler.length} adet sipariş başarıyla oluşturuldu!`);
  };

  // Otomatik sipariş fonksiyonları (önceki kodlar)
  const otomatikSiparisOlustur = () => {
    console.log('🔵 İhtiyaç Listesi Hesaplama Başladı');
    const { baslangicTarihi, bitisTarihi } = otomatikForm;
    
    console.log('Tarihler:', { baslangicTarihi, bitisTarihi });
    
    if (!baslangicTarihi || !bitisTarihi) {
      alert('⚠️ Lütfen tarih aralığı seçin!');
      return;
    }

    if (new Date(baslangicTarihi) >= new Date(bitisTarihi)) {
      alert('⚠️ Bitiş tarihi başlangıç tarihinden sonra olmalıdır!');
      return;
    }

    console.log('Müşteri siparişleri kontrol ediliyor...', musteriSiparisleri.length, 'adet');
    
    const aralikSiparisler = musteriSiparisleri.filter(ms => {
      const siparisTarih = new Date(ms.tarih);
      return siparisTarih >= new Date(baslangicTarihi) && siparisTarih <= new Date(bitisTarihi) && ms.durum === 'Onaylandı';
    });

    console.log('Tarih aralığındaki onaylanmış siparişler:', aralikSiparisler.length, 'adet');

    if (aralikSiparisler.length === 0) {
      alert(`⚠️ Seçilen tarih aralığında onaylanmış sipariş bulunamadı!\n\nToplam müşteri siparişi: ${musteriSiparisleri.length}\nOnaylanmış: ${musteriSiparisleri.filter(ms => ms.durum === 'Onaylandı').length}\n\nİpucu: Üretim Planı sayfasından müşteri siparişi ekleyin ve durumunu "Onaylandı" yapın.`);
      return;
    }

    console.log('Reçeteler kontrol ediliyor...', receteler.length, 'adet');

    const receteIhtiyaclari = {};
    
    aralikSiparisler.forEach(siparis => {
      const menuYemekleri = siparis.menuAd.split(',').map(y => y.trim());
      
      menuYemekleri.forEach(yemekAdi => {
        const recete = receteler.find(r => 
          r.aktif && (
            r.ad.toLowerCase() === yemekAdi.toLowerCase() || 
            yemekAdi.toLowerCase().includes(r.ad.toLowerCase()) ||
            r.ad.toLowerCase().includes(yemekAdi.toLowerCase())
          )
        );
        
        if (recete) {
          if (!receteIhtiyaclari[recete.id]) {
            receteIhtiyaclari[recete.id] = {
              recete: recete,
              toplamPorsiyon: 0
            };
          }
          receteIhtiyaclari[recete.id].toplamPorsiyon += siparis.porsiyon;
        }
      });
    });

    console.log('Bulunan reçeteler:', Object.keys(receteIhtiyaclari).length, 'adet');

    if (Object.keys(receteIhtiyaclari).length === 0) {
      alert(`⚠️ Siparişlerdeki yemekler için reçete bulunamadı!\n\nİpucu: Reçeteler sayfasından yemekleriniz için reçete tanımlayın.`);
      return;
    }

    const malzemeIhtiyaclari = {};
    
    Object.values(receteIhtiyaclari).forEach(({ recete, toplamPorsiyon }) => {
      recete.malzemeler.forEach(malzeme => {
        const stokItem = stok.find(s => s.id === malzeme.stokId);
        if (!stokItem) return;

        const porsiyonBasinaMiktar = malzeme.miktar / recete.porsiyon;
        const toplamMiktar = porsiyonBasinaMiktar * toplamPorsiyon;
        
        if (!malzemeIhtiyaclari[stokItem.id]) {
          malzemeIhtiyaclari[stokItem.id] = {
            stokItem: stokItem,
            toplamIhtiyac: 0
          };
        }
        
        malzemeIhtiyaclari[stokItem.id].toplamIhtiyac += toplamMiktar;
      });
    });

    console.log('Malzeme ihtiyaçları hesaplandı:', Object.keys(malzemeIhtiyaclari).length, 'farklı malzeme');

    const siparisKalemleri = Object.values(malzemeIhtiyaclari).map(({ stokItem, toplamIhtiyac }) => {
      const siparisMiktari = Math.max(0, toplamIhtiyac - stokItem.mevcut);
      
      return {
        stokId: stokItem.id,
        ad: stokItem.ad,
        birim: stokItem.birim,
        ihtiyac: Math.ceil(toplamIhtiyac * 10) / 10,
        mevcut: stokItem.mevcut,
        siparisMiktari: Math.ceil(siparisMiktari * 10) / 10,
        birimFiyat: stokItem.birimFiyat || 0,
        kategori: stokItem.kategori,
        teslimTarihi: baslangicTarihi,  // Her kalem için varsayılan teslim tarihi
        notlar: ''  // Açıklama alanı
      };
    }).filter(k => k.siparisMiktari > 0).sort((a, b) => a.ad.localeCompare(b.ad, 'tr'));

    console.log('Sipariş edilmesi gereken kalemler:', siparisKalemleri.length, 'adet');

    if (siparisKalemleri.length === 0) {
      alert('🎉 Harika! Tüm malzemeler stokta mevcut, sipariş gerekmiyor.');
      return;
    }

    console.log('✅ İhtiyaç listesi başarıyla hesaplandı!');
    
    setOtomatikForm({
      ...otomatikForm,
      siparisKalemleri: siparisKalemleri
    });
    
    alert(`✅ İhtiyaç listesi hesaplandı!\n\n${siparisKalemleri.length} farklı malzeme için sipariş gerekiyor.\n\nAşağıda listeyi görebilir ve düzenleyebilirsiniz.`);
  };

  const kalemGuncelle = (stokId, yeniMiktar) => {
    setOtomatikForm({
      ...otomatikForm,
      siparisKalemleri: otomatikForm.siparisKalemleri.map(k => 
        k.stokId === stokId ? { ...k, siparisMiktari: Number(yeniMiktar) || 0 } : k
      )
    });
  };

  const kalemTeslimTarihiGuncelle = (stokId, yeniTarih) => {
    setOtomatikForm({
      ...otomatikForm,
      siparisKalemleri: otomatikForm.siparisKalemleri.map(k => 
        k.stokId === stokId ? { ...k, teslimTarihi: yeniTarih } : k
      )
    });
  };

  const kalemNotlarGuncelle = (stokId, yeniNotlar) => {
    setOtomatikForm({
      ...otomatikForm,
      siparisKalemleri: otomatikForm.siparisKalemleri.map(k => 
        k.stokId === stokId ? { ...k, notlar: yeniNotlar } : k
      )
    });
  };

  const kalemSil = (stokId) => {
    setOtomatikForm({
      ...otomatikForm,
      siparisKalemleri: otomatikForm.siparisKalemleri.filter(k => k.stokId !== stokId)
    });
  };

  const otomatikSiparisKaydet = () => {
    const gecerliKalemler = otomatikForm.siparisKalemleri.filter(k => k.siparisMiktari > 0);
    
    if (gecerliKalemler.length === 0) {
      alert('Sipariş edilecek kalem yok!');
      return;
    }

    let yeniId = Math.max(0, ...siparisler.map(s => s.id));
    const yeniSiparisler = gecerliKalemler.map(kalem => {
      yeniId++;
      return {
        id: yeniId,
        tarih: new Date().toISOString().slice(0, 10),
        teslimTarihi: kalem.teslimTarihi,  // Her kalemin kendi teslim tarihi
        tedarikci: 'Beklemede',
        tedarikciId: 0,
        urun: kalem.ad,
        miktar: kalem.siparisMiktari,
        birim: kalem.birim,
        birimFiyat: 0,
        toplam: 0,
        notlar: kalem.notlar || `${otomatikForm.baslangicTarihi} - ${otomatikForm.bitisTarihi} dönemi`,
        durum: 'Beklemede'
      };
    });

    setSiparisler([...siparisler, ...yeniSiparisler]);
    setShowOtomatik(false);
    setOtomatikForm({
      baslangicTarihi: yarin.toISOString().slice(0, 10),
      bitisTarihi: new Date(yarin.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
      siparisKalemleri: []
    });
    alert(`✅ ${yeniSiparisler.length} adet sipariş başarıyla oluşturuldu!`);
  };

  // Onay modalı için state
  const [showOnayModal, setShowOnayModal] = useState(false);
  const [onaylanacakSiparis, setOnaylanacakSiparis] = useState(null);
  const [onayForm, setOnayForm] = useState({
    tedarikciId: '',
    birimFiyat: 0
  });

  const siparisSil = (id) => {
    const siparis = siparisler.find(s => s.id === id);
    
    // Teslim Alındı durumundaki siparişler silinemez
    if (siparis && siparis.durum === 'Teslim Alındı') {
      alert('⚠️ Teslim alınmış siparişler silinemez!');
      return;
    }
    
    if (confirm('Bu siparişi silmek istediğinizden emin misiniz?')) {
      setSiparisler(siparisler.filter(s => s.id !== id));
    }
  };

  const onayModalAc = (siparis) => {
    setOnaylanacakSiparis(siparis);
    setOnayForm({
      tedarikciId: siparis.tedarikciId || '',
      birimFiyat: siparis.birimFiyat || 0
    });
    setShowOnayModal(true);
  };

  const siparisOnayla = () => {
    if (!onayForm.tedarikciId) {
      alert('⚠️ Tedarikçi seçmelisiniz!');
      return;
    }
    if (!onayForm.birimFiyat || onayForm.birimFiyat <= 0) {
      alert('⚠️ Geçerli bir birim fiyat girmelisiniz!');
      return;
    }

    const secilenTedarikci = tedarikciler.find(t => t.id === Number(onayForm.tedarikciId));
    const yeniToplam = onaylanacakSiparis.miktar * Number(onayForm.birimFiyat);

    setSiparisler(siparisler.map(s => 
      s.id === onaylanacakSiparis.id 
        ? { 
            ...s, 
            durum: 'Onaylandı',
            tedarikci: secilenTedarikci.ad,
            tedarikciId: Number(onayForm.tedarikciId),
            birimFiyat: Number(onayForm.birimFiyat),
            toplam: yeniToplam,
            // Planlanan değerleri kaydet (Cost Kontrol için)
            planlananMiktar: onaylanacakSiparis.miktar,
            planlananBirimFiyat: Number(onayForm.birimFiyat),
            planlananToplam: yeniToplam
          } 
        : s
    ));

    setShowOnayModal(false);
    setOnaylanacakSiparis(null);
    setOnayForm({ tedarikciId: '', birimFiyat: 0 });
    alert(`✅ Sipariş onaylandı!\n\nTedarikçi: ${secilenTedarikci.ad}\nBirim Fiyat: ${formatTL(onayForm.birimFiyat)}\nToplam: ${formatTL(yeniToplam)}`);
  };

  const durumDegistir = (id, yeniDurum) => {
    const siparis = siparisler.find(s => s.id === id);
    
    // Teslim Alındı durumundaki siparişler değiştirilemez
    if (siparis.durum === 'Teslim Alındı') {
      alert('⚠️ Teslim alınmış siparişler değiştirilemez!');
      return;
    }
    
    // Teslim Alındı durumuna manuel geçiş engellenmiştir
    if (yeniDurum === 'Teslim Alındı') {
      alert('⚠️ Sipariş "Teslim Alındı" durumuna manuel olarak geçirilemez!\n\n📋 Doğru İşlem:\n1. Siparişi "Onaylandı" durumuna getirin\n2. "Satın Alma" sayfasına gidin\n3. Fatura numarası girerek stok girişi yapın\n4. Sistem otomatik olarak "Teslim Alındı" durumuna geçirecektir');
      return;
    }
    
    // Eğer Beklemede'den Onaylandı'ya geçiyorsa, modal aç
    if (siparis.durum === 'Beklemede' && yeniDurum === 'Onaylandı') {
      onayModalAc(siparis);
    } else {
      // Diğer durum değişiklikleri direkt olsun
      setSiparisler(siparisler.map(s => s.id === id ? { ...s, durum: yeniDurum } : s));
    }
  };

  // Excel formatında (CSV) indirme fonksiyonu - TÜM TEDARİKÇİLER
  const excelIndir = () => {
    if (siparisGruplari['Onaylandı'].length === 0) {
      alert('⚠️ İndirilecek onaylı sipariş bulunamadı!');
      return;
    }

    // CSV içeriği oluştur (Excel'de açılabilir)
    let csvContent = '\uFEFF'; // UTF-8 BOM for Excel
    
    // Genel bilgiler
    csvContent += 'ONAYLANMIŞ SİPARİŞLER RAPORU\n';
    csvContent += `Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}\n`;
    csvContent += `Toplam Tedarikçi: ${Object.keys(onayliTedarikciGruplari).length}\n`;
    csvContent += `Toplam Sipariş: ${siparisGruplari['Onaylandı'].length}\n`;
    csvContent += `Genel Toplam: ${formatTL(siparisGruplari['Onaylandı'].reduce((sum, s) => sum + s.toplam, 0))}\n`;
    csvContent += '\n\n';

    // Her tedarikçi için ayrı bölüm
    Object.entries(onayliTedarikciGruplari).forEach(([tedarikciAdi, { siparisler: tedarikciSiparisleri, toplamTutar }]) => {
      csvContent += `"${tedarikciAdi.toUpperCase()}"\n`;
      csvContent += `Sipariş Sayısı: ${tedarikciSiparisleri.length}\n`;
      csvContent += `Tedarikçi Toplam: ${formatTL(toplamTutar)}\n`;
      csvContent += '\n';
      
      // Tablo başlıkları
      csvContent += 'Sipariş No,Tarih,Teslim Tarihi,Ürün,Miktar,Birim,Birim Fiyat,Toplam,Notlar\n';
      
      // Sipariş verileri
      tedarikciSiparisleri.forEach(siparis => {
        const tarih = new Date(siparis.tarih).toLocaleDateString('tr-TR');
        const teslimTarih = new Date(siparis.teslimTarihi).toLocaleDateString('tr-TR');
        const notlar = (siparis.notlar || '').replace(/"/g, '""'); // CSV escape
        
        csvContent += `${siparis.id},"${tarih}","${teslimTarih}","${siparis.urun}",${siparis.miktar},"${siparis.birim}",${siparis.birimFiyat},${siparis.toplam},"${notlar}"\n`;
      });
      
      // Tedarikçi toplamı
      csvContent += `,,,,,,TOPLAM,${toplamTutar}\n`;
      csvContent += '\n\n';
    });

    // Özet tablo
    csvContent += 'TEDARİKÇİ BAZLI ÖZET\n';
    csvContent += 'Tedarikçi,Sipariş Sayısı,Toplam Tutar\n';
    Object.entries(onayliTedarikciGruplari).forEach(([tedarikciAdi, { siparisler: tedarikciSiparisleri, toplamTutar }]) => {
      csvContent += `"${tedarikciAdi}",${tedarikciSiparisleri.length},${toplamTutar}\n`;
    });
    csvContent += `GENEL TOPLAM,${siparisGruplari['Onaylandı'].length},${siparisGruplari['Onaylandı'].reduce((sum, s) => sum + s.toplam, 0)}\n`;

    // Dosyayı indir
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    const tarih = new Date().toISOString().slice(0, 10);
    link.setAttribute('href', url);
    link.setAttribute('download', `Onaylı_Siparisler_Tumu_${tarih}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert('✅ Tüm tedarikçilerin Excel dosyası başarıyla indirildi!\n\n💡 İpucu: CSV dosyasını Excel ile açabilirsiniz.');
  };

  // Tek tedarikçi için Excel indirme fonksiyonu
  const tedarikciExcelIndir = (tedarikciAdi, tedarikciSiparisleri, toplamTutar) => {
    // CSV içeriği oluştur
    let csvContent = '\uFEFF'; // UTF-8 BOM for Excel
    
    // Tedarikçi başlık bilgileri
    csvContent += `${tedarikciAdi.toUpperCase()}\n`;
    csvContent += `Sipariş Raporu\n`;
    csvContent += `Rapor Tarihi: ${new Date().toLocaleDateString('tr-TR')}\n`;
    csvContent += `Sipariş Sayısı: ${tedarikciSiparisleri.length}\n`;
    csvContent += `Toplam Tutar: ${formatTL(toplamTutar)}\n`;
    csvContent += '\n\n';
    
    // Tablo başlıkları
    csvContent += 'Sipariş No,Tarih,Teslim Tarihi,Ürün,Miktar,Birim,Birim Fiyat,Toplam,Notlar\n';
    
    // Sipariş verileri
    tedarikciSiparisleri.forEach(siparis => {
      const tarih = new Date(siparis.tarih).toLocaleDateString('tr-TR');
      const teslimTarih = new Date(siparis.teslimTarihi).toLocaleDateString('tr-TR');
      const notlar = (siparis.notlar || '').replace(/"/g, '""'); // CSV escape
      
      csvContent += `${siparis.id},"${tarih}","${teslimTarih}","${siparis.urun}",${siparis.miktar},"${siparis.birim}",${siparis.birimFiyat},${siparis.toplam},"${notlar}"\n`;
    });
    
    // Toplam satırı
    csvContent += '\n';
    csvContent += `,,,,,,TOPLAM,${toplamTutar}\n`;
    
    // Özet bilgiler
    csvContent += '\n\n';
    csvContent += 'ÖZET BİLGİLER\n';
    csvContent += `Toplam Sipariş Sayısı,${tedarikciSiparisleri.length}\n`;
    csvContent += `Toplam Tutar,${toplamTutar}\n`;
    csvContent += `Ortalama Sipariş Tutarı,${(toplamTutar / tedarikciSiparisleri.length).toFixed(2)}\n`;
    
    // Ürün bazlı özet
    const urunOzet = {};
    tedarikciSiparisleri.forEach(siparis => {
      if (!urunOzet[siparis.urun]) {
        urunOzet[siparis.urun] = {
          miktar: 0,
          birim: siparis.birim,
          toplam: 0
        };
      }
      urunOzet[siparis.urun].miktar += siparis.miktar;
      urunOzet[siparis.urun].toplam += siparis.toplam;
    });
    
    csvContent += '\n\n';
    csvContent += 'ÜRÜN BAZLI ÖZET\n';
    csvContent += 'Ürün,Toplam Miktar,Birim,Toplam Tutar\n';
    Object.entries(urunOzet).forEach(([urun, bilgi]) => {
      csvContent += `"${urun}",${bilgi.miktar},"${bilgi.birim}",${bilgi.toplam}\n`;
    });

    // Dosyayı indir
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    
    const tarih = new Date().toISOString().slice(0, 10);
    // Dosya adı için güvenli tedarikçi adı
    const safeTedarikciAdi = tedarikciAdi.replace(/[^a-zA-Z0-9ğüşıöçĞÜŞİÖÇ]/g, '_');
    link.setAttribute('href', url);
    link.setAttribute('download', `Siparis_${safeTedarikciAdi}_${tarih}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert(`✅ ${tedarikciAdi} için Excel dosyası başarıyla indirildi!\n\n📊 ${tedarikciSiparisleri.length} sipariş\n💰 Toplam: ${formatTL(toplamTutar)}`);
  };

  const durumlar = ['Beklemede', 'Onaylandı', 'Yolda', 'Teslim Alındı', 'İptal'];
  const durumRenk = {
    'Beklemede': 'bg-yellow-100 text-yellow-700',
    'Onaylandı': 'bg-blue-100 text-blue-700',
    'Yolda': 'bg-purple-100 text-purple-700',
    'Teslim Alındı': 'bg-green-100 text-green-700',
    'İptal': 'bg-red-100 text-red-700'
  };

  // Siparişleri duruma göre grupla
  const siparisGruplari = useMemo(() => {
    const gruplar = {
      'Beklemede': [],
      'Onaylandı': [],
      'Yolda': [],
      'Teslim Alındı': [],
      'İptal': []
    };
    
    siparisler.forEach(siparis => {
      if (gruplar[siparis.durum]) {
        gruplar[siparis.durum].push(siparis);
      }
    });
    
    return gruplar;
  }, [siparisler]);

  // Onaylandı durumundaki siparişleri tedarikçiye göre grupla
  const onayliTedarikciGruplari = useMemo(() => {
    const gruplar = {};
    
    siparisGruplari['Onaylandı'].forEach(siparis => {
      const tedarikciAdi = siparis.tedarikci || 'Beklemede';
      if (!gruplar[tedarikciAdi]) {
        gruplar[tedarikciAdi] = {
          siparisler: [],
          toplamTutar: 0
        };
      }
      gruplar[tedarikciAdi].siparisler.push(siparis);
      gruplar[tedarikciAdi].toplamTutar += siparis.toplam;
    });
    
    return gruplar;
  }, [siparisGruplari]);

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div className="flex justify-between items-center">
        <div>
          <h2 className="text-2xl font-bold">Ham Madde Siparişleri</h2>
        </div>
        <div className="flex gap-3">
          <button 
            onClick={() => setShowOtomatik(true)} 
            className="px-4 py-2 bg-green-600 text-white rounded-lg flex items-center gap-2 hover:bg-green-700"
          >
            <TrendingUp className="w-4 h-4" />
            Otomatik Sipariş
          </button>
          <button 
            onClick={() => setShowYeni(true)} 
            className="px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center gap-2 hover:bg-blue-700"
          >
            <Plus className="w-4 h-4" />
            Manuel Sipariş
          </button>
        </div>
      </div>


      {/* Sipariş Listesi - Durumlara Göre Gruplandırılmış */}
      {Object.entries(siparisGruplari).map(([durum, grupSiparisler]) => {
        if (grupSiparisler.length === 0) return null;
        
        // Onaylandı durumu için tedarikçiye göre gruplandırılmış görünüm
        if (durum === 'Onaylandı') {
          return (
            <div key={durum} className="space-y-4">
              {/* Ana Başlık */}
              <div className="bg-white rounded-xl border overflow-hidden">
                <div className="bg-blue-50 px-6 py-4 border-b flex justify-between items-center">
                  <div className="flex items-center gap-3">
                    <span className="px-3 py-1 rounded-full text-sm font-semibold bg-blue-100 text-blue-700">
                      {durum}
                    </span>
                    <h3 className="text-lg font-semibold text-gray-800">
                      {grupSiparisler.length} Sipariş - {Object.keys(onayliTedarikciGruplari).length} Tedarikçi
                    </h3>
                  </div>
                  <div className="flex items-center gap-4">
                    <button
                      onClick={excelIndir}
                      className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium shadow-sm"
                      title="Tüm tedarikçilerin raporunu indir"
                    >
                      <Download className="w-4 h-4" />
                      Tümünü İndir
                    </button>
                    <div className="text-right">
                      <p className="text-sm text-gray-600">Toplam Tutar</p>
                      <p className="text-xl font-bold text-gray-900">
                        {formatTL(grupSiparisler.reduce((sum, s) => sum + s.toplam, 0))}
                      </p>
                    </div>
                  </div>
                </div>
              </div>

              {/* Tedarikçiye Göre Alt Gruplar */}
              {Object.entries(onayliTedarikciGruplari).map(([tedarikciAdi, { siparisler: tedarikciSiparisleri, toplamTutar }]) => (
                <div key={tedarikciAdi} className="bg-white rounded-xl border overflow-hidden ml-4">
                  <div className="bg-gradient-to-r from-indigo-50 to-blue-50 px-6 py-3 border-b flex justify-between items-center">
                    <div className="flex items-center gap-3">
                      <Building2 className="w-5 h-5 text-indigo-600" />
                      <h4 className="text-base font-bold text-gray-800">{tedarikciAdi}</h4>
                      <span className="px-2 py-1 bg-indigo-100 text-indigo-700 rounded-full text-xs font-semibold">
                        {tedarikciSiparisleri.length} sipariş
                      </span>
                    </div>
                    <div className="flex items-center gap-3">
                      <button
                        onClick={() => tedarikciExcelIndir(tedarikciAdi, tedarikciSiparisleri, toplamTutar)}
                        className="flex items-center gap-2 px-3 py-1.5 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors text-sm font-medium shadow-sm"
                        title={`${tedarikciAdi} için Excel indir`}
                      >
                        <Download className="w-3.5 h-3.5" />
                        İndir
                      </button>
                      <div className="text-right">
                        <p className="text-xs text-gray-600">Tedarikçi Tutarı</p>
                        <p className="text-lg font-bold text-indigo-600">
                          {formatTL(toplamTutar)}
                        </p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="overflow-x-auto">
                    <table className="w-full">
                      <thead className="bg-gray-50 border-b">
                        <tr>
                          <th className="px-4 py-3 text-left text-sm font-semibold">Tarih</th>
                          <th className="px-4 py-3 text-left text-sm font-semibold">Teslim</th>
                          <th className="px-4 py-3 text-left text-sm font-semibold">Ürün</th>
                          <th className="px-4 py-3 text-center text-sm font-semibold">Miktar</th>
                          <th className="px-4 py-3 text-right text-sm font-semibold">Birim Fiyat</th>
                          <th className="px-4 py-3 text-right text-sm font-semibold">Toplam</th>
                          <th className="px-4 py-3 text-left text-sm font-semibold">Açıklama</th>
                          <th className="px-4 py-3 text-center text-sm font-semibold">İşlem</th>
                        </tr>
                      </thead>
                      <tbody>
                        {tedarikciSiparisleri.map(siparis => (
                          <tr key={siparis.id} className="border-b hover:bg-gray-50">
                            <td className="px-4 py-3 text-sm">{formatTarih(siparis.tarih)}</td>
                            <td className="px-4 py-3 text-sm text-blue-600 font-medium">
                              {formatTarih(siparis.teslimTarihi)}
                            </td>
                            <td className="px-4 py-3">
                              <p className="font-semibold text-sm">{siparis.urun}</p>
                            </td>
                            <td className="px-4 py-3 text-center font-semibold text-sm">
                              {siparis.miktar} {siparis.birim}
                            </td>
                            <td className="px-4 py-3 text-right text-sm">{formatTL(siparis.birimFiyat)}</td>
                            <td className="px-4 py-3 text-right font-bold text-sm text-green-600">{formatTL(siparis.toplam)}</td>
                            <td className="px-4 py-3 text-sm text-gray-600">
                              {siparis.notlar || '-'}
                            </td>
                            <td className="px-4 py-3 text-center">
                              <div className="flex items-center justify-center gap-2">
                                <select
                                  value={siparis.durum}
                                  onChange={(e) => durumDegistir(siparis.id, e.target.value)}
                                  className="px-2 py-1 rounded-full text-xs font-medium border-0 bg-blue-100 text-blue-700"
                                >
                                  {durumlar.map(d => (
                                    <option 
                                      key={d} 
                                      value={d}
                                      disabled={d === 'Teslim Alındı'}
                                    >
                                      {d}{d === 'Teslim Alındı' ? ' (Satın Alma\'dan)' : ''}
                                    </option>
                                  ))}
                                </select>
                                <button 
                                  onClick={() => siparisSil(siparis.id)}
                                  className="p-1 text-red-600 hover:bg-red-50 rounded"
                                  title="Sil"
                                >
                                  <Trash2 className="w-4 h-4" />
                                </button>
                              </div>
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                </div>
              ))}
            </div>
          );
        }
        
        // Diğer durumlar için normal görünüm
        return (
          <div key={durum} className="bg-white rounded-xl border overflow-hidden">
            <div className={`px-6 py-4 border-b flex justify-between items-center ${
              durum === 'Beklemede' ? 'bg-yellow-50' :
              durum === 'Yolda' ? 'bg-purple-50' :
              durum === 'Teslim Alındı' ? 'bg-green-50' :
              'bg-red-50'
            }`}>
              <div className="flex items-center gap-3">
                <span className={`px-3 py-1 rounded-full text-sm font-semibold ${durumRenk[durum]}`}>
                  {durum}
                </span>
                <h3 className="text-lg font-semibold text-gray-800">
                  {grupSiparisler.length} Sipariş
                </h3>
              </div>
              <div className="text-right">
                <p className="text-sm text-gray-600">Toplam Tutar</p>
                <p className="text-xl font-bold text-gray-900">
                  {formatTL(grupSiparisler.reduce((sum, s) => sum + s.toplam, 0))}
                </p>
              </div>
            </div>
            
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-50 border-b">
                  <tr>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Tarih</th>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Teslim</th>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Tedarikçi</th>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Ürün</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Miktar</th>
                    <th className="px-4 py-3 text-right text-sm font-semibold">Birim Fiyat</th>
                    <th className="px-4 py-3 text-right text-sm font-semibold">Toplam</th>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Açıklama</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">İşlem</th>
                  </tr>
                </thead>
                <tbody>
                  {grupSiparisler.map(siparis => (
                    <tr key={siparis.id} className="border-b hover:bg-gray-50">
                      <td className="px-4 py-3 text-sm">{formatTarih(siparis.tarih)}</td>
                      <td className="px-4 py-3 text-sm text-blue-600 font-medium">
                        {formatTarih(siparis.teslimTarihi)}
                      </td>
                      <td className="px-4 py-3 font-medium text-sm">{siparis.tedarikci}</td>
                      <td className="px-4 py-3 font-semibold text-sm">{siparis.urun}</td>
                      <td className="px-4 py-3 text-center font-semibold text-sm">
                        {siparis.miktar} {siparis.birim}
                      </td>
                      <td className="px-4 py-3 text-right text-sm">{formatTL(siparis.birimFiyat)}</td>
                      <td className="px-4 py-3 text-right font-bold text-sm">{formatTL(siparis.toplam)}</td>
                      <td className="px-4 py-3 text-sm text-gray-600">
                        {siparis.notlar || '-'}
                      </td>
                      <td className="px-4 py-3 text-center">
                        <div className="flex items-center justify-center gap-2">
                          {siparis.durum === 'Beklemede' && (
                            <button
                              onClick={() => onayModalAc(siparis)}
                              className="px-3 py-1 bg-blue-600 text-white rounded text-xs font-medium hover:bg-blue-700"
                            >
                              Onayla
                            </button>
                          )}
                          {siparis.durum === 'Teslim Alındı' ? (
                            <span className={`px-3 py-1 rounded-full text-xs font-medium ${durumRenk[siparis.durum]} inline-flex items-center gap-1`}>
                              🔒 {siparis.durum}
                            </span>
                          ) : (
                            <select
                              value={siparis.durum}
                              onChange={(e) => durumDegistir(siparis.id, e.target.value)}
                              className={`px-2 py-1 rounded-full text-xs font-medium border-0 ${durumRenk[siparis.durum]}`}
                            >
                              {durumlar.map(d => (
                                <option 
                                  key={d} 
                                  value={d}
                                  disabled={d === 'Teslim Alındı'}
                                >
                                  {d}{d === 'Teslim Alındı' ? ' (Satın Alma\'dan)' : ''}
                                </option>
                              ))}
                            </select>
                          )}
                          {siparis.durum !== 'Teslim Alındı' ? (
                            <button 
                              onClick={() => siparisSil(siparis.id)}
                              className="p-1 text-red-600 hover:bg-red-50 rounded"
                              title="Sil"
                            >
                              <Trash2 className="w-4 h-4" />
                            </button>
                          ) : (
                            <button 
                              disabled
                              className="p-1 text-gray-300 cursor-not-allowed rounded"
                              title="Teslim alınan sipariş silinemez"
                            >
                              <Trash2 className="w-4 h-4" />
                            </button>
                          )}
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        );
      })}

      {/* Sipariş Onay Modalı */}
      {showOnayModal && onaylanacakSiparis && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold">✅ Sipariş Onaylama</h3>
              <button onClick={() => setShowOnayModal(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                <X className="w-5 h-5" />
              </button>
            </div>

            {/* Sipariş Bilgileri */}
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border-2 border-blue-200">
              <h4 className="font-semibold text-lg mb-4 text-blue-900">Sipariş Detayları</h4>
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-gray-600 mb-1">Ürün</p>
                  <p className="font-semibold text-gray-900">{onaylanacakSiparis.urun}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-600 mb-1">Miktar</p>
                  <p className="font-bold text-blue-600">
                    {onaylanacakSiparis.miktar} {onaylanacakSiparis.birim}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-gray-600 mb-1">Sipariş Tarihi</p>
                  <p className="font-semibold text-gray-900">{formatTarih(onaylanacakSiparis.tarih)}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-600 mb-1">Teslim Tarihi</p>
                  <p className="font-semibold text-gray-900">{formatTarih(onaylanacakSiparis.teslimTarihi)}</p>
                </div>
              </div>
            </div>

            {/* Tedarikçi ve Fiyat Girişi */}
            <div className="space-y-4 mb-6">
              <div>
                <label className="block text-sm font-medium mb-2">
                  Tedarikçi Seçin *
                </label>
                <select
                  value={onayForm.tedarikciId}
                  onChange={(e) => setOnayForm({...onayForm, tedarikciId: e.target.value})}
                  className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
                  autoFocus
                >
                  <option value="">-- Tedarikçi Seçiniz --</option>
                  {tedarikciler.filter(t => t.aktif).map(t => (
                    <option key={t.id} value={t.id}>
                      {t.ad} - {t.kategori}
                    </option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium mb-2">
                  Birim Fiyat (₺) *
                </label>
                <div className="flex items-center gap-2">
                  <input
                    type="number"
                    value={onayForm.birimFiyat}
                    onChange={(e) => setOnayForm({...onayForm, birimFiyat: e.target.value})}
                    min="0"
                    step="0.01"
                    placeholder="0.00"
                    className="flex-1 px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg font-bold text-right"
                  />
                  <span className="text-gray-600 font-medium">₺ / {onaylanacakSiparis.birim}</span>
                </div>
              </div>

              {/* Toplam Hesaplama */}
              {onayForm.birimFiyat > 0 && (
                <div className="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 border-2 border-green-300">
                  <div className="flex justify-between items-center">
                    <div>
                      <p className="text-sm text-green-800 font-medium">Toplam Sipariş Tutarı</p>
                      <p className="text-xs text-green-600 mt-1">
                        {onaylanacakSiparis.miktar} {onaylanacakSiparis.birim} × {formatTL(onayForm.birimFiyat)}
                      </p>
                    </div>
                    <p className="text-3xl font-bold text-green-700">
                      {formatTL(onaylanacakSiparis.miktar * Number(onayForm.birimFiyat))}
                    </p>
                  </div>
                </div>
              )}
            </div>

            {/* Butonlar */}
            <div className="flex gap-4">
              <button
                onClick={() => {
                  setShowOnayModal(false);
                  setOnaylanacakSiparis(null);
                  setOnayForm({ tedarikciId: '', birimFiyat: 0 });
                }}
                className="flex-1 px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-semibold"
              >
                İptal
              </button>
              <button
                onClick={siparisOnayla}
                disabled={!onayForm.tedarikciId || !onayForm.birimFiyat || onayForm.birimFiyat <= 0}
                className={`flex-1 px-6 py-3 rounded-lg font-semibold transition-colors ${
                  !onayForm.tedarikciId || !onayForm.birimFiyat || onayForm.birimFiyat <= 0
                    ? 'bg-gray-300 cursor-not-allowed'
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`}
              >
                ✅ Siparişi Onayla
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Manuel Sipariş Modal - YENİ BASIT FORM */}
      {showYeni && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold">📝 Manuel Sipariş Oluştur</h3>
              <button onClick={() => setShowYeni(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                <X className="w-5 h-5" />
              </button>
            </div>

            {/* Sipariş Satırları */}
            <div className="space-y-3 mb-6">
              {manuelSiparisKalemleri.map((satir, index) => {
                const secilenStok = stok.find(s => s.id === Number(satir.stokId));
                
                return (
                  <div key={index} className="bg-gray-50 rounded-lg p-4 border-2 border-gray-200">
                    <div className="grid grid-cols-12 gap-4 items-end">
                      <div className="col-span-4">
                        <label className="block text-sm font-medium mb-2">Ürün Adı *</label>
                        <select
                          value={satir.stokId}
                          onChange={(e) => satirGuncelle(index, 'stokId', e.target.value)}
                          className="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                          <option value="">Ürün Seçin...</option>
                          {stok.filter(s => s.aktif).sort((a, b) => a.ad.localeCompare(b.ad, 'tr')).map(s => (
                            <option key={s.id} value={s.id}>
                              {s.ad} ({s.kategori})
                            </option>
                          ))}
                        </select>
                      </div>

                      <div className="col-span-2">
                        <label className="block text-sm font-medium mb-2">Birim</label>
                        <div className="px-3 py-2 bg-gray-100 border-2 border-gray-300 rounded-lg text-center font-semibold">
                          {secilenStok ? secilenStok.birim : '-'}
                        </div>
                      </div>

                      <div className="col-span-2">
                        <label className="block text-sm font-medium mb-2">Miktar *</label>
                        <input
                          type="number"
                          value={satir.miktar}
                          onChange={(e) => satirGuncelle(index, 'miktar', e.target.value)}
                          min="0"
                          step="0.1"
                          className="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-center font-bold"
                          placeholder="0"
                        />
                      </div>

                      <div className="col-span-2">
                        <label className="block text-sm font-medium mb-2">Teslim Tarihi</label>
                        <input
                          type="date"
                          value={satir.teslimTarihi}
                          onChange={(e) => satirGuncelle(index, 'teslimTarihi', e.target.value)}
                          className="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        />
                      </div>

                      <div className="col-span-1 flex justify-center">
                        <button
                          onClick={() => satirSil(index)}
                          disabled={manuelSiparisKalemleri.length === 1}
                          className="p-2 text-red-600 hover:bg-red-50 rounded-lg disabled:opacity-30 disabled:cursor-not-allowed"
                          title="Satırı Sil"
                        >
                          <Trash2 className="w-5 h-5" />
                        </button>
                      </div>
                    </div>

                    <div className="grid grid-cols-12 gap-4 mt-3">
                      <div className="col-span-11">
                        <label className="block text-sm font-medium mb-2">Açıklama</label>
                        <input
                          type="text"
                          value={satir.notlar}
                          onChange={(e) => satirGuncelle(index, 'notlar', e.target.value)}
                          className="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                          placeholder="Sipariş ile ilgili açıklama..."
                        />
                      </div>
                    </div>

                    {secilenStok && (
                      <div className="mt-3 p-3 bg-white rounded border border-gray-200">
                        <div className="text-sm">
                          <span className="text-gray-600">Mevcut Stok:</span>
                          <span className="font-semibold ml-2">{secilenStok.mevcut} {secilenStok.birim}</span>
                        </div>
                      </div>
                    )}
                  </div>
                );
              })}
            </div>

            <button
              onClick={satirEkle}
              className="w-full px-4 py-3 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-200 hover:border-gray-400 flex items-center justify-center gap-2 font-medium text-gray-700 mb-6"
            >
              <Plus className="w-5 h-5" />
              Yeni Satır Ekle
            </button>

            {/* Butonlar */}
            <div className="flex gap-4">
              <button
                onClick={() => setShowYeni(false)}
                className="flex-1 px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-semibold"
              >
                İptal
              </button>
              <button
                onClick={manuelSiparisKaydet}
                className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
              >
                Siparişleri Kaydet
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Otomatik Sipariş Modal */}
      {showOtomatik && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold">🤖 Otomatik Sipariş Oluştur</h3>
              <button onClick={() => setShowOtomatik(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                <X className="w-5 h-5" />
              </button>
            </div>

            {/* Tarih Aralığı */}
            <div className="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border-2 border-blue-200">
              <h4 className="font-semibold text-lg mb-4 text-blue-900 flex items-center gap-2">
                <Calendar className="w-5 h-5" />
                1. Tarih Aralığı Seçin
              </h4>
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Başlangıç Tarihi *</label>
                  <input 
                    type="date" 
                    value={otomatikForm.baslangicTarihi}
                    min={yarin.toISOString().slice(0, 10)}
                    onChange={(e) => setOtomatikForm({...otomatikForm, baslangicTarihi: e.target.value})}
                    className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                  <p className="text-xs text-blue-600 mt-1">⚠️ En erken: Yarın</p>
                </div>
                <div>
                  <label className="block text-sm font-medium mb-2">Bitiş Tarihi *</label>
                  <input 
                    type="date" 
                    value={otomatikForm.bitisTarihi}
                    min={otomatikForm.baslangicTarihi}
                    onChange={(e) => setOtomatikForm({...otomatikForm, bitisTarihi: e.target.value})}
                    className="w-full px-4 py-3 border-2 border-blue-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>
              <button 
                onClick={otomatikSiparisOlustur}
                className="w-full px-6 py-4 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 flex items-center justify-center gap-3"
              >
                <TrendingUp className="w-6 h-6" />
                İhtiyaç Listesini Hesapla
              </button>
            </div>

            {/* Sipariş Kalemleri */}
            {otomatikForm.siparisKalemleri.length > 0 && (
              <div>
                <div className="flex justify-between items-center mb-4 pb-4 border-b-2">
                  <h4 className="font-bold text-xl">
                    2. Sipariş Kalemleri ({otomatikForm.siparisKalemleri.length})
                  </h4>
                  <div className="text-right">
                    <p className="text-sm text-gray-600">Toplam Miktar</p>
                    <p className="text-2xl font-bold text-blue-600">
                      {otomatikForm.siparisKalemleri.length} Kalem
                    </p>
                  </div>
                </div>

                <div className="space-y-4 mb-6">
                  {otomatikForm.siparisKalemleri.map((kalem, index) => (
                    <div key={kalem.stokId} className="bg-white rounded-xl p-5 border-2 border-gray-200">
                      <div className="flex items-start gap-4">
                        <div className="flex-shrink-0 bg-blue-600 text-white rounded-lg p-3 font-bold text-lg">
                          {index + 1}
                        </div>
                        
                        <div className="flex-1">
                          <div className="flex items-center gap-3 mb-3">
                            <h5 className="font-bold text-lg">{kalem.ad}</h5>
                            <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm">
                              {kalem.kategori}
                            </span>
                          </div>
                          
                          <div className="grid grid-cols-3 gap-4 text-sm">
                            <div className="bg-orange-50 rounded-lg p-3 border border-orange-200">
                              <span className="text-gray-600 block mb-1">Toplam İhtiyaç</span>
                              <span className="font-bold text-orange-700 text-lg">
                                {kalem.ihtiyac} {kalem.birim}
                              </span>
                            </div>
                            <div className="bg-green-50 rounded-lg p-3 border border-green-200">
                              <span className="text-gray-600 block mb-1">Mevcut</span>
                              <span className="font-bold text-green-700 text-lg">
                                {kalem.mevcut} {kalem.birim}
                              </span>
                            </div>
                            <div className="bg-blue-50 rounded-lg p-3 border border-blue-200">
                              <span className="text-gray-600 block mb-1">Teslim Tarihi</span>
                              <input
                                type="date"
                                value={kalem.teslimTarihi}
                                onChange={(e) => kalemTeslimTarihiGuncelle(kalem.stokId, e.target.value)}
                                min={new Date().toISOString().slice(0, 10)}
                                className="w-full px-2 py-1 border border-blue-300 rounded font-medium text-blue-700 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                              />
                            </div>
                          </div>

                          <div className="mt-3">
                            <label className="block text-sm font-medium mb-2 text-gray-700">Açıklama</label>
                            <input
                              type="text"
                              value={kalem.notlar}
                              onChange={(e) => kalemNotlarGuncelle(kalem.stokId, e.target.value)}
                              className="w-full px-3 py-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="Sipariş ile ilgili açıklama..."
                            />
                          </div>
                        </div>

                        <div className="flex items-center gap-3">
                          <div>
                            <label className="block text-sm font-medium mb-2">Sipariş Miktarı</label>
                            <input 
                              type="number" 
                              value={kalem.siparisMiktari}
                              onChange={(e) => kalemGuncelle(kalem.stokId, e.target.value)}
                              min="0"
                              step="0.1"
                              className="w-32 px-4 py-3 border-2 border-blue-400 rounded-lg font-bold text-xl text-center"
                            />
                            <p className="text-sm text-gray-600 mt-1">{kalem.birim}</p>
                          </div>
                          
                          <button
                            onClick={() => kalemSil(kalem.stokId)}
                            className="p-3 text-red-600 hover:bg-red-50 rounded-lg mt-6"
                          >
                            <Trash2 className="w-5 h-5" />
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="flex gap-4">
                  <button 
                    onClick={() => setShowOtomatik(false)} 
                    className="flex-1 px-6 py-4 border-2 border-gray-300 rounded-xl hover:bg-gray-50 font-semibold"
                  >
                    İptal
                  </button>
                  <button 
                    onClick={otomatikSiparisKaydet}
                    className="flex-1 px-6 py-4 bg-green-600 text-white rounded-xl hover:bg-green-700 font-bold flex items-center justify-center gap-3"
                  >
                    <ShoppingCart className="w-6 h-6" />
                    Siparişleri Oluştur ({otomatikForm.siparisKalemleri.length})
                  </button>
                </div>
              </div>
            )}

            {otomatikForm.siparisKalemleri.length === 0 && (
              <div className="text-center py-16 text-gray-500">
                <Package className="w-24 h-24 mx-auto mb-6 opacity-30" />
                <h4 className="text-xl font-semibold mb-2">Henüz İhtiyaç Listesi Oluşturulmadı</h4>
                <p>Tarih aralığı seçip "İhtiyaç Listesini Hesapla" butonuna tıklayın</p>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
function Depo({ stok, setStok }) {
  const [q, setQ] = useState('');
  const [kat, setKat] = useState('Tümü');
  const [showCikis, setShowCikis] = useState(false);
  const [showKartlar, setShowKartlar] = useState(false);
  const [showYeniKart, setShowYeniKart] = useState(false);
  const [showSayim, setShowSayim] = useState(false);
  const [sayimForm, setSayimForm] = useState([]);
  const [showSayimRapor, setShowSayimRapor] = useState(false);
  const [sayimRapor, setSayimRapor] = useState(null);
  const [cikisForm, setCikisForm] = useState([{ urunId: '', miktar: 0, neden: 'Üretim' }]);
  const [yeniKartForm, setYeniKartForm] = useState({
    ad: '',
    kategori: 'Kuru Gıda',
    birim: 'kg'
  });

  const filtreliStok = useMemo(() => {
    let sonuc = stok.filter(s => s.aktif && s.mevcut > 0);
    if (q) sonuc = sonuc.filter(s => s.ad.toLowerCase().includes(q.toLowerCase()));
    if (kat !== 'Tümü') sonuc = sonuc.filter(s => s.kategori === kat);
    return sonuc;
  }, [stok, q, kat]);

  const cikisYap = async () => {
  const gecerli = cikisForm.filter(c => c.urunId && c.miktar > 0);
  if (gecerli.length === 0) {
    alert('Geçerli ürün girin!');
    return;
  }

  try {
    // Her ürün için stok güncelle
    for (const satir of gecerli) {
      const mevcutUrun = stok.find(s => s.id === Number(satir.urunId));
      if (!mevcutUrun) continue;

      const yeniMiktar = Math.max(0, mevcutUrun.miktar - Number(satir.miktar));

      const { error: updateError } = await supabase
        .from('stok')
        .update({ miktar: yeniMiktar })
        .eq('id', mevcutUrun.id);

      if (updateError) throw updateError;

      // Stok hareketi kaydet
      await supabase
        .from('stok_hareketleri')
        .insert([{
          stok_id: mevcutUrun.id,
          hareket_tipi: 'cikis',
          miktar: Number(satir.miktar),
          birim_fiyat: mevcutUrun.birim_fiyat,
          aciklama: satir.neden || 'Stok çıkışı'
        }]);
    }

    // Tüm stoku yeniden yükle
    const { data: yeniStokData, error: fetchError } = await supabase
      .from('stok')
      .select('*')
      .order('id');

    if (fetchError) throw fetchError;

    setStok(yeniStokData);
    localStorage.setItem('lezzetsel_stok', JSON.stringify(yeniStokData));

    setCikisForm([{ urunId: '', miktar: 0, neden: 'Üretim' }]);
    setShowCikis(false);
    alert('✅ Stok çıkışı başarılı!');
  } catch (err) {
    console.error('Stok çıkışı hatası:', err);
    alert('❌ Hata: ' + err.message);
  }
};

  const excelIndir = () => {
    alert('Excel indirme özelliği yakında eklenecek!');
  };

  // Depo Sayımı Fonksiyonları
  const sayimBaslat = () => {
    const sayimListesi = stok
      .filter(s => s.aktif)
      .map(s => ({
        id: s.id,
        ad: s.ad,
        kategori: s.kategori,
        birim: s.birim,
        sistemMiktar: s.mevcut,
        sayilanMiktar: s.mevcut,
        esik: s.esik
      }))
      .sort((a, b) => a.ad.localeCompare(b.ad, 'tr'));
    
    setSayimForm(sayimListesi);
    setShowSayim(true);
  };

  const sayimFormuIndir = () => {
    let csv = '\uFEFF'; // UTF-8 BOM
    csv += 'DEPO SAYIM FORMU\n';
    csv += `Tarih: ${new Date().toLocaleDateString('tr-TR')}\n`;
    csv += `Saat: ${new Date().toLocaleTimeString('tr-TR')}\n\n`;
    csv += 'Ürün Adı,Kategori,Birim,Mevcut Stok,Sayılan Miktar,Fark,Notlar\n';
    
    const liste = stok
      .filter(s => s.aktif)
      .sort((a, b) => a.ad.localeCompare(b.ad, 'tr'));
    
    liste.forEach(s => {
      csv += `${s.ad},${s.kategori},${s.birim},${s.mevcut},,,,\n`;
    });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `Depo_Sayim_Formu_${new Date().toISOString().slice(0,10)}.csv`;
    link.click();
  };

  const sayimKaydet = async () => {
  const farklar = sayimForm.filter(s => s.sistemMiktar !== Number(s.sayilanMiktar));
  
  try {
    // Her ürün için stok güncelle
    for (const sayim of sayimForm) {
      const { error } = await supabase
        .from('stok')
        .update({ miktar: Number(sayim.sayilanMiktar) })
        .eq('id', sayim.id);

      if (error) throw error;

      // Fark varsa stok hareketi kaydet
      if (sayim.sistemMiktar !== Number(sayim.sayilanMiktar)) {
        const fark = Number(sayim.sayilanMiktar) - sayim.sistemMiktar;
        await supabase
          .from('stok_hareketleri')
          .insert([{
            stok_id: sayim.id,
            hareket_tipi: fark > 0 ? 'giris' : 'cikis',
            miktar: Math.abs(fark),
            birim_fiyat: 0,
            aciklama: `Depo sayımı düzeltmesi (${fark > 0 ? '+' : ''}${fark})`
          }]);
      }
    }

    // Tüm stoku yeniden yükle
    const { data: yeniStokData, error: fetchError } = await supabase
      .from('stok')
      .select('*')
      .order('id');

    if (fetchError) throw fetchError;

    setStok(yeniStokData);
    localStorage.setItem('lezzetsel_stok', JSON.stringify(yeniStokData));

    // Rapor oluştur
    const rapor = {
      tarih: new Date().toLocaleString('tr-TR'),
      toplamUrun: sayimForm.length,
      uyumluUrun: sayimForm.length - farklar.length,
      farkliUrun: farklar.length,
      detaylar: sayimForm.map(s => ({
        ...s,
        fark: Number(s.sayilanMiktar) - s.sistemMiktar,
        farkYuzde: s.sistemMiktar > 0 
          ? (((Number(s.sayilanMiktar) - s.sistemMiktar) / s.sistemMiktar) * 100).toFixed(2)
          : 0
      }))
    };

    setSayimRapor(rapor);
    setShowSayim(false);
    setShowSayimRapor(true);
    alert('✅ Sayım başarıyla kaydedildi!');
  } catch (err) {
    console.error('Sayım kaydetme hatası:', err);
    alert('❌ Hata: ' + err.message);
  }
};

  const sayimRaporuIndir = () => {
    if (!sayimRapor) return;

    let csv = '\uFEFF';
    csv += 'DEPO SAYIM RAPORU\n';
    csv += `Tarih:,${sayimRapor.tarih}\n`;
    csv += `Toplam Ürün:,${sayimRapor.toplamUrun}\n`;
    csv += `Uyumlu Ürün:,${sayimRapor.uyumluUrun}\n`;
    csv += `Farklı Ürün:,${sayimRapor.farkliUrun}\n\n`;
    
    csv += 'DETAYLI SAYIM LİSTESİ\n';
    csv += 'Ürün Adı,Kategori,Sistem Miktarı,Sayılan Miktar,Fark,Fark %,Durum\n';
    
    sayimRapor.detaylar.forEach(d => {
      const durum = d.fark === 0 ? 'Uyumlu' : d.fark > 0 ? 'Fazla' : 'Eksik';
      csv += `${d.ad},${d.kategori},${d.sistemMiktar} ${d.birim},${d.sayilanMiktar} ${d.birim},${d.fark > 0 ? '+' : ''}${d.fark} ${d.birim},${d.farkYuzde > 0 ? '+' : ''}${d.farkYuzde}%,${durum}\n`;
    });

    csv += '\n\nÖNEMLİ FARKLAR (±10% ve üzeri)\n';
    csv += 'Ürün Adı,Kategori,Sistem Miktarı,Sayılan Miktar,Fark,Fark %\n';
    
    sayimRapor.detaylar
      .filter(d => Math.abs(d.farkYuzde) >= 10)
      .forEach(d => {
        csv += `${d.ad},${d.kategori},${d.sistemMiktar} ${d.birim},${d.sayilanMiktar} ${d.birim},${d.fark > 0 ? '+' : ''}${d.fark} ${d.birim},${d.farkYuzde > 0 ? '+' : ''}${d.farkYuzde}%\n`;
      });
    
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = `Depo_Sayim_Raporu_${new Date().toISOString().slice(0,10)}.csv`;
    link.click();
  };

  const yeniKartEkle = async () => {
    if (!yeniKartForm.ad.trim()) {
      alert('Ürün adı gereklidir!');
      return;
    }

    try {
      const { data, error } = await supabase
        .from('stok')
        .insert([{
          ad: yeniKartForm.ad,
          kategori: yeniKartForm.kategori,
          birim: yeniKartForm.birim,
          miktar: 0,
          min_stok: 10,
          birim_fiyat: 0,
          aktif: true
        }])
        .select();

      if (error) throw error;

      const yeniStokListesi = [...stok, data[0]];
      setStok(yeniStokListesi);
      localStorage.setItem('lezzetsel_stok', JSON.stringify(yeniStokListesi));

      setYeniKartForm({
        ad: '',
        kategori: 'Kuru Gıda',
        birim: 'kg'
      });
      setShowYeniKart(false);
      alert(`✅ Stok kartı eklendi!\n\n${data[0].ad}\nKategori: ${data[0].kategori}\nBirim: ${data[0].birim}`);
    } catch (err) {
      console.error('Stok kartı ekleme hatası:', err);
      alert('❌ Hata: ' + err.message);
    }
  };

  const durumDegistir = async (id) => {
  const mevcutUrun = stok.find(s => s.id === id);
  if (!mevcutUrun) return;

  try {
    const { data, error } = await supabase
      .from('stok')
      .update({ aktif: !mevcutUrun.aktif })
      .eq('id', id)
      .select();

    if (error) throw error;

    const yeniStok = stok.map(item => 
      item.id === id ? data[0] : item
    );
    setStok(yeniStok);
    localStorage.setItem('lezzetsel_stok', JSON.stringify(yeniStok));
  } catch (err) {
    console.error('Durum değiştirme hatası:', err);
    alert('❌ Hata: ' + err.message);
  }
};

  return (
    <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
      <div>
        <h2 className="text-2xl font-bold">Depo Yönetimi</h2>
      </div>

      <div className="bg-white rounded-xl border p-6 space-y-4">
        <div className="flex gap-3">
          <button onClick={() => setShowCikis(true)} className="px-4 py-2 bg-red-600 text-white rounded-lg flex items-center gap-2">
            <Trash2 className="w-4 h-4" />
            Stok Çıkışı
          </button>
          <button onClick={() => setShowKartlar(true)} className="px-4 py-2 bg-purple-600 text-white rounded-lg flex items-center gap-2">
            <FileText className="w-4 h-4" />
            Stok Kartları
          </button>
          <button onClick={sayimBaslat} className="px-4 py-2 bg-orange-600 text-white rounded-lg flex items-center gap-2 hover:bg-orange-700">
            <ClipboardCheck className="w-4 h-4" />
            Depo Sayımı
          </button>
        </div>

        <div className="grid grid-cols-12 gap-4">
          <input type="text" placeholder="Ara..." value={q} onChange={(e) => setQ(e.target.value)} className="col-span-8 px-3 py-2 border rounded-lg" />
          <select value={kat} onChange={(e) => setKat(e.target.value)} className="col-span-4 px-3 py-2 border rounded-lg">
            {KATEGORILER.map(k => <option key={k} value={k}>{k}</option>)}
          </select>
        </div>
      </div>

      <div className="bg-white rounded-xl border overflow-hidden">
        <table className="w-full">
          <thead className="bg-gray-50 border-b">
            <tr>
              <th className="px-4 py-3 text-left text-sm font-semibold">Ürün</th>
              <th className="px-4 py-3 text-center text-sm font-semibold">Kategori</th>
              <th className="px-4 py-3 text-center text-sm font-semibold">Mevcut</th>
              <th className="px-4 py-3 text-right text-sm font-semibold">Fiyat</th>
              <th className="px-4 py-3 text-center text-sm font-semibold">Durum</th>
            </tr>
          </thead>
          <tbody>
            {filtreliStok.map(item => (
              <tr key={item.id} className={`border-b hover:bg-gray-50 ${item.mevcut <= item.esik ? 'bg-orange-50' : ''}`}>
                <td className="px-4 py-3 font-medium">{item.ad}</td>
                <td className="px-4 py-3 text-center text-sm">{item.kategori}</td>
                <td className="px-4 py-3 text-center font-semibold">{item.mevcut} {item.birim}</td>
                <td className="px-4 py-3 text-right">{formatTL(item.birimFiyat)}</td>
                <td className="px-4 py-3 text-center">
                  <span className={`px-2 py-1 rounded-full text-xs ${item.mevcut <= item.esik ? 'bg-orange-100 text-orange-700' : 'bg-green-100 text-green-700'}`}>
                    {item.mevcut <= item.esik ? 'Kritik' : 'Normal'}
                  </span>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {showCikis && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-3xl w-full">
            <h3 className="text-xl font-bold mb-4">Stok Çıkışı</h3>
            <button onClick={() => setCikisForm([...cikisForm, { urunId: '', miktar: 0, neden: 'Üretim' }])} className="mb-4 px-4 py-2 bg-green-600 text-white rounded-lg">+ Satır</button>
            {cikisForm.map((s, i) => (
              <div key={i} className="grid grid-cols-12 gap-3 mb-3">
                <div className="col-span-5">
                  <input
                    list={`urun-list-${i}`}
                    value={stok.find(item => item.id === Number(s.urunId))?.ad || ''}
                    onChange={(e) => {
                      const y = [...cikisForm];
                      const secilenUrun = stok.find(item => item.ad === e.target.value);
                      y[i].urunId = secilenUrun ? secilenUrun.id : '';
                      setCikisForm(y);
                    }}
                    placeholder="Ürün ara veya seç..."
                    className="w-full px-3 py-2 border rounded-lg"
                  />
                  <datalist id={`urun-list-${i}`}>
                    {stok.filter(st => st.aktif).map(item => (
                      <option key={item.id} value={item.ad}>{item.kategori} - {item.mevcut} {item.birim}</option>
                    ))}
                  </datalist>
                </div>
                <input type="number" value={s.miktar} onChange={(e) => { const y = [...cikisForm]; y[i].miktar = e.target.value; setCikisForm(y); }} className="col-span-3 px-3 py-2 border rounded-lg" placeholder="Miktar" />
                <select value={s.neden} onChange={(e) => { const y = [...cikisForm]; y[i].neden = e.target.value; setCikisForm(y); }} className="col-span-3 px-3 py-2 border rounded-lg">
                  {CIKIS_NEDENLERI.map(n => <option key={n} value={n}>{n}</option>)}
                </select>
                <button onClick={() => setCikisForm(cikisForm.filter((_, idx) => idx !== i))} disabled={cikisForm.length === 1} className="col-span-1 p-2 text-red-600"><Trash2 className="w-4 h-4" /></button>
              </div>
            ))}
            <div className="flex gap-3 mt-6">
              <button onClick={() => setShowCikis(false)} className="flex-1 px-4 py-2 border rounded-lg">İptal</button>
              <button onClick={cikisYap} className="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg">Çıkış Yap</button>
            </div>
          </div>
        </div>
      )}

      {showKartlar && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-5xl w-full max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h3 className="text-xl font-bold">Stok Kartları</h3>
              <div className="flex gap-3">
                <button 
                  onClick={() => {
                    setShowYeniKart(true);
                    setShowKartlar(false);
                  }} 
                  className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2"
                >
                  <Plus className="w-4 h-4" />
                  Yeni Stok Kartı
                </button>
                <button onClick={excelIndir} className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                  <Download className="w-4 h-4 inline mr-1" />
                  Excel İndir
                </button>
                <button onClick={() => setShowKartlar(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>
            <table className="w-full">
              <thead className="bg-gray-50 border-b">
                <tr>
                  <th className="px-4 py-3 text-left">Ürün</th>
                  <th className="px-4 py-3 text-center">Kategori</th>
                  <th className="px-4 py-3 text-center">Birim</th>
                  <th className="px-4 py-3 text-center">Durum</th>
                  <th className="px-4 py-3 text-center">İşlem</th>
                </tr>
              </thead>
              <tbody>
                {stok.map(item => (
                  <tr key={item.id} className={item.aktif === false ? 'opacity-50' : ''}>
                    <td className="px-4 py-3 font-medium">{item.ad}</td>
                    <td className="px-4 py-3 text-center"><span className="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs">{item.kategori}</span></td>
                    <td className="px-4 py-3 text-center">{item.birim}</td>
                    <td className="px-4 py-3 text-center">
                      <span className={`px-2 py-1 rounded-full text-xs ${item.aktif === false ? 'bg-gray-100 text-gray-600' : 'bg-green-100 text-green-700'}`}>
                        {item.aktif === false ? 'Pasif' : 'Aktif'}
                      </span>
                    </td>
                    <td className="px-4 py-3 text-center">
                      <button 
                        onClick={() => durumDegistir(item.id)}
                        className={`px-3 py-1 rounded-lg text-xs font-medium ${
                          item.aktif 
                            ? 'bg-red-50 text-red-700 hover:bg-red-100' 
                            : 'bg-green-50 text-green-700 hover:bg-green-100'
                        }`}
                      >
                        {item.aktif ? 'Pasifleştir' : 'Aktifleştir'}
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      )}

      {/* Yeni Stok Kartı Modal */}
      {showYeniKart && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-2xl w-full">
            <div className="flex justify-between items-center mb-6">
              <h3 className="text-2xl font-bold">📦 Yeni Stok Kartı Ekle</h3>
              <button onClick={() => setShowYeniKart(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                <X className="w-5 h-5" />
              </button>
            </div>

            <div className="space-y-4">
              <div>
                <label className="block text-sm font-medium mb-2">Ürün Adı *</label>
                <input
                  type="text"
                  value={yeniKartForm.ad}
                  onChange={(e) => setYeniKartForm({...yeniKartForm, ad: e.target.value})}
                  placeholder="Örn: Domates"
                  className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-lg"
                  autoFocus
                />
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium mb-2">Kategori *</label>
                  <select
                    value={yeniKartForm.kategori}
                    onChange={(e) => setYeniKartForm({...yeniKartForm, kategori: e.target.value})}
                    className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    {KATEGORILER.filter(k => k !== 'Tümü').map(k => (
                      <option key={k} value={k}>{k}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block text-sm font-medium mb-2">Birim *</label>
                  <select
                    value={yeniKartForm.birim}
                    onChange={(e) => setYeniKartForm({...yeniKartForm, birim: e.target.value})}
                    className="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="kg">kg (Kilogram)</option>
                    <option value="lt">lt (Litre)</option>
                    <option value="adet">adet</option>
                    <option value="gr">gr (Gram)</option>
                    <option value="ml">ml (Mililitre)</option>
                    <option value="paket">paket</option>
                    <option value="kutu">kutu</option>
                  </select>
                </div>
              </div>

              {/* Önizleme */}
              <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                <div className="flex items-start gap-3">
                  <AlertCircle className="w-5 h-5 text-blue-600 mt-0.5" />
                  <div className="flex-1 text-sm text-blue-800">
                    <p className="font-semibold mb-2">📋 Oluşturulacak Stok Kartı:</p>
                    <div className="bg-white rounded p-4 border border-blue-200">
                      <p className="text-xl font-bold text-gray-900 mb-3">{yeniKartForm.ad || '(Ürün adı girilmedi)'}</p>
                      <div className="flex gap-3">
                        <span className="px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium">
                          📂 {yeniKartForm.kategori}
                        </span>
                        <span className="px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium">
                          📏 {yeniKartForm.birim}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Butonlar */}
            <div className="flex gap-4 mt-6">
              <button
                onClick={() => {
                  setShowYeniKart(false);
                  setYeniKartForm({
                    ad: '',
                    kategori: 'Kuru Gıda',
                    birim: 'kg'
                  });
                }}
                className="flex-1 px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-semibold"
              >
                İptal
              </button>
              <button
                onClick={() => {
                  if (!yeniKartForm.ad.trim()) {
                    alert('⚠️ Ürün adı gereklidir!');
                    return;
                  }
                  yeniKartEkle();
                }}
                className={`flex-1 px-6 py-3 rounded-lg font-semibold flex items-center justify-center gap-2 transition-colors ${
                  !yeniKartForm.ad.trim()
                    ? 'bg-gray-300 cursor-not-allowed'
                    : 'bg-blue-600 text-white hover:bg-blue-700'
                }`}
              >
                <Plus className="w-5 h-5" />
                Stok Kartı Ekle
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Depo Sayımı Modal */}
      {showSayim && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-6">
              <div>
                <h3 className="text-2xl font-bold">📋 Depo Sayımı</h3>
              </div>
              <div className="flex gap-3">
                <button 
                  onClick={sayimFormuIndir}
                  className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2"
                >
                  <Download className="w-4 h-4" />
                  Sayım Formu İndir
                </button>
                <button onClick={() => setShowSayim(false)} className="p-2 hover:bg-gray-100 rounded-lg">
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>

            {/* İstatistikler */}
            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-blue-50 rounded-lg p-4 border-2 border-blue-200">
                <p className="text-sm text-blue-700 font-medium mb-1">Toplam Ürün</p>
                <p className="text-3xl font-bold text-blue-900">{sayimForm.length}</p>
              </div>
              <div className="bg-green-50 rounded-lg p-4 border-2 border-green-200">
                <p className="text-sm text-green-700 font-medium mb-1">Uyumlu Ürün</p>
                <p className="text-3xl font-bold text-green-900">
                  {sayimForm.filter(s => s.sistemMiktar === Number(s.sayilanMiktar)).length}
                </p>
              </div>
              <div className="bg-orange-50 rounded-lg p-4 border-2 border-orange-200">
                <p className="text-sm text-orange-700 font-medium mb-1">Farklı Ürün</p>
                <p className="text-3xl font-bold text-orange-900">
                  {sayimForm.filter(s => s.sistemMiktar !== Number(s.sayilanMiktar)).length}
                </p>
              </div>
            </div>

            {/* Sayım Tablosu */}
            <div className="bg-white rounded-xl border overflow-hidden">
              <table className="w-full">
                <thead className="bg-gray-50 border-b">
                  <tr>
                    <th className="px-4 py-3 text-left text-sm font-semibold">Ürün Adı</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Kategori</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Sistem Miktarı</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Sayılan Miktar</th>
                    <th className="px-4 py-3 text-center text-sm font-semibold">Fark</th>
                  </tr>
                </thead>
                <tbody>
                  {sayimForm.map((item, index) => {
                    const fark = Number(item.sayilanMiktar) - item.sistemMiktar;
                    const farklimi = fark !== 0;
                    
                    return (
                      <tr 
                        key={item.id} 
                        className={`border-b hover:bg-gray-50 ${farklimi ? 'bg-yellow-50' : ''}`}
                      >
                        <td className="px-4 py-3 font-medium">{item.ad}</td>
                        <td className="px-4 py-3 text-center">
                          <span className="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs">
                            {item.kategori}
                          </span>
                        </td>
                        <td className="px-4 py-3 text-center font-semibold">
                          {item.sistemMiktar} {item.birim}
                        </td>
                        <td className="px-4 py-3">
                          <input
                            type="number"
                            step="0.1"
                            value={item.sayilanMiktar}
                            onChange={(e) => {
                              const yeni = [...sayimForm];
                              yeni[index].sayilanMiktar = e.target.value;
                              setSayimForm(yeni);
                            }}
                            className="w-full px-3 py-2 border-2 rounded-lg text-center font-semibold focus:outline-none focus:ring-2 focus:ring-orange-500"
                          />
                        </td>
                        <td className="px-4 py-3 text-center">
                          {farklimi && (
                            <span className={`px-3 py-1 rounded-full text-sm font-bold ${
                              fark > 0 
                                ? 'bg-green-100 text-green-700' 
                                : 'bg-red-100 text-red-700'
                            }`}>
                              {fark > 0 ? '+' : ''}{fark.toFixed(2)} {item.birim}
                            </span>
                          )}
                          {!farklimi && (
                            <span className="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm font-medium">
                              ✓ Uyumlu
                            </span>
                          )}
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>

            {/* Butonlar */}
            <div className="flex gap-4 mt-6">
              <button
                onClick={() => setShowSayim(false)}
                className="flex-1 px-6 py-3 border-2 border-gray-300 rounded-lg hover:bg-gray-50 font-semibold"
              >
                İptal
              </button>
              <button
                onClick={sayimKaydet}
                className="flex-1 px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 font-bold flex items-center justify-center gap-2"
              >
                <ClipboardCheck className="w-5 h-5" />
                Sayımı Kaydet ve Rapor Oluştur
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Sayım Raporu Modal */}
      {showSayimRapor && sayimRapor && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-white rounded-2xl p-6 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-6">
              <div>
                <h3 className="text-2xl font-bold">✅ Depo Sayımı Tamamlandı</h3>
                <p className="text-gray-600 mt-1">{sayimRapor.tarih}</p>
              </div>
              <div className="flex gap-3">
                <button 
                  onClick={sayimRaporuIndir}
                  className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center gap-2"
                >
                  <Download className="w-4 h-4" />
                  Raporu İndir (CSV)
                </button>
                <button 
                  onClick={() => { setShowSayimRapor(false); setSayimRapor(null); }} 
                  className="p-2 hover:bg-gray-100 rounded-lg"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>

            {/* Rapor İstatistikleri */}
            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-5 border-2 border-blue-300">
                <p className="text-sm text-blue-700 font-semibold mb-2">📦 Toplam Ürün</p>
                <p className="text-4xl font-bold text-blue-900">{sayimRapor.toplamUrun}</p>
              </div>
              <div className="bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-5 border-2 border-green-300">
                <p className="text-sm text-green-700 font-semibold mb-2">✅ Uyumlu Ürün</p>
                <p className="text-4xl font-bold text-green-900">{sayimRapor.uyumluUrun}</p>
              </div>
              <div className="bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl p-5 border-2 border-orange-300">
                <p className="text-sm text-orange-700 font-semibold mb-2">⚠️ Farklı Ürün</p>
                <p className="text-4xl font-bold text-orange-900">{sayimRapor.farkliUrun}</p>
              </div>
            </div>

            {/* Detaylı Fark Analizi */}
            <div className="bg-white rounded-xl border overflow-hidden">
              <div className="bg-gray-50 px-6 py-4 border-b">
                <h4 className="font-bold text-lg">📊 Detaylı Fark Analizi</h4>
              </div>
              <div className="max-h-96 overflow-y-auto">
                {sayimRapor.detaylar.filter(d => d.fark !== 0).length === 0 ? (
                  <div className="p-12 text-center">
                    <div className="text-6xl mb-4">🎉</div>
                    <h3 className="text-2xl font-bold text-green-700 mb-2">Mükemmel Sayım!</h3>
                    <p className="text-gray-600">Tüm ürünler sistemle tam uyumlu. Hiçbir fark tespit edilmedi.</p>
                  </div>
                ) : (
                  <table className="w-full">
                    <thead className="bg-gray-50 border-b sticky top-0">
                      <tr>
                        <th className="px-4 py-3 text-left text-sm font-semibold">Ürün</th>
                        <th className="px-4 py-3 text-center text-sm font-semibold">Kategori</th>
                        <th className="px-4 py-3 text-center text-sm font-semibold">Sistem</th>
                        <th className="px-4 py-3 text-center text-sm font-semibold">Sayım</th>
                        <th className="px-4 py-3 text-center text-sm font-semibold">Fark</th>
                        <th className="px-4 py-3 text-center text-sm font-semibold">Fark %</th>
                      </tr>
                    </thead>
                    <tbody>
                      {sayimRapor.detaylar
                        .filter(d => d.fark !== 0)
                        .sort((a, b) => Math.abs(b.farkYuzde) - Math.abs(a.farkYuzde))
                        .map(item => (
                          <tr key={item.id} className="border-b hover:bg-gray-50">
                            <td className="px-4 py-3 font-medium">{item.ad}</td>
                            <td className="px-4 py-3 text-center">
                              <span className="px-2 py-1 bg-blue-50 text-blue-700 rounded text-xs">
                                {item.kategori}
                              </span>
                            </td>
                            <td className="px-4 py-3 text-center">{item.sistemMiktar} {item.birim}</td>
                            <td className="px-4 py-3 text-center font-semibold">{item.sayilanMiktar} {item.birim}</td>
                            <td className="px-4 py-3 text-center">
                              <span className={`px-3 py-1 rounded-full text-sm font-bold ${
                                item.fark > 0 
                                  ? 'bg-green-100 text-green-700' 
                                  : 'bg-red-100 text-red-700'
                              }`}>
                                {item.fark > 0 ? '+' : ''}{item.fark.toFixed(2)} {item.birim}
                              </span>
                            </td>
                            <td className="px-4 py-3 text-center">
                              <span className={`px-3 py-1 rounded-full text-sm font-bold ${
                                item.farkYuzde > 0 
                                  ? 'bg-green-100 text-green-700' 
                                  : 'bg-red-100 text-red-700'
                              }`}>
                                {item.farkYuzde > 0 ? '+' : ''}{item.farkYuzde}%
                              </span>
                            </td>
                          </tr>
                        ))}
                    </tbody>
                  </table>
                )}
              </div>
            </div>

            <div className="mt-6 text-center">
              <button
                onClick={() => { setShowSayimRapor(false); setSayimRapor(null); }}
                className="px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold"
              >
                Tamam
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

export default function App() {
  // LocalStorage'dan kullanıcı bilgisini yükle
  const [user, setUser] = useState(() => {
    const savedUser = localStorage.getItem('lezzetsel_user');
    return savedUser ? JSON.parse(savedUser) : null;
  });
  
  const [activeTab, setActiveTab] = useState('anasayfa');
  const [sidebarOpen, setSidebarOpen] = useState(false);
  
  // LocalStorage'dan verileri yükle
const [stok, setStok] = useState([]); // ← Boş başlat, Supabase yükleyecek
  
  const [musteriSiparisleri, setMusteriSiparisleri] = useState([]);
  
  const [siparisler, setSiparisler] = useState([]);
  
  const [menu, setMenu] = useState([]);
  
  const [receteler, setReceteler] = useState([]);
  
  const [musteriler, setMusteriler] = useState([]);
  
  const [tedarikciler, setTedarikciler] = useState([]);

  // SUPABASE - Veri Yükleme
  useEffect(() => {
    console.log('🚀 useEffect ÇALIŞTI!');  // ← BUNU EKLEYİN
  const fetchData = async () => {
    console.log('📡 fetchData başladı!');  // ← BUNU DA EKLEYİN
    try {
        const { data: stokData } = await supabase.from('stok').select('*');
        if (stokData) {
          setStok(stokData);
          localStorage.setItem('lezzetsel_stok', JSON.stringify(stokData));
        }
        
        const { data: receteData } = await supabase.from('receteler').select('*');
        if (receteData) {
          setReceteler(receteData);
          localStorage.setItem('lezzetsel_receteler', JSON.stringify(receteData));
        }
        
        const { data: menuData } = await supabase.from('menu').select('*');
        if (menuData) {
          setMenu(menuData);
          localStorage.setItem('lezzetsel_menu', JSON.stringify(menuData));
        }
        
        const { data: musteriData } = await supabase.from('musteriler').select('*');
        if (musteriData) {
          setMusteriler(musteriData);
          localStorage.setItem('lezzetsel_musteriler', JSON.stringify(musteriData));
        }
        
        const { data: tedarikciData } = await supabase.from('tedarikciler').select('*');
        if (tedarikciData) {
          setTedarikciler(tedarikciData);
          localStorage.setItem('lezzetsel_tedarikciler', JSON.stringify(tedarikciData));
        }
        
        console.log('✅ Veriler Supabase\'den yüklendi!');
      } catch (err) {
        console.error('Veri yükleme hatası:', err);
      }
    };
    fetchData();
  }, []);

  // Kullanıcı girişinde localStorage'a kaydet
  const handleLogin = (userData) => {
    setUser(userData);
    localStorage.setItem('lezzetsel_user', JSON.stringify(userData));
  };

  // Çıkış yaparken localStorage'dan temizle
  const handleLogout = () => {
    setUser(null);
    localStorage.removeItem('lezzetsel_user');
    setActiveTab('anasayfa');
  };

  // Verileri localStorage'a kaydet
  useEffect(() => {
    localStorage.setItem('lezzetsel_stok', JSON.stringify(stok));
  }, [stok]);

  useEffect(() => {
    localStorage.setItem('lezzetsel_musteriSiparisleri', JSON.stringify(musteriSiparisleri));
  }, [musteriSiparisleri]);

  useEffect(() => {
    localStorage.setItem('lezzetsel_siparisler', JSON.stringify(siparisler));
  }, [siparisler]);

  useEffect(() => {
    localStorage.setItem('lezzetsel_menu', JSON.stringify(menu));
  }, [menu]);

  useEffect(() => {
    localStorage.setItem('lezzetsel_receteler', JSON.stringify(receteler));
  }, [receteler]);

  useEffect(() => {
    localStorage.setItem('lezzetsel_musteriler', JSON.stringify(musteriler));
  }, [musteriler]);

  useEffect(() => {
    localStorage.setItem('lezzetsel_tedarikciler', JSON.stringify(tedarikciler));
  }, [tedarikciler]);

  // Giriş yapılmamışsa login ekranı göster
  if (!user) {
    return <LoginScreen onLogin={handleLogin} />;
  }

  return (
    <div className="min-h-screen bg-gray-50">
      <Header sidebarOpen={sidebarOpen} setSidebarOpen={setSidebarOpen} user={user} onLogout={handleLogout} />
      <div className="flex">
        <Sidebar activeTab={activeTab} setActiveTab={setActiveTab} isOpen={sidebarOpen} setIsOpen={setSidebarOpen} userRole={user.role} />
        <main className="flex-1">
          {activeTab === 'anasayfa' && <Anasayfa stok={stok} menu={menu} musteriSiparisleri={musteriSiparisleri} receteler={receteler} />}
          {activeTab === 'depo' && <Depo stok={stok} setStok={setStok} />}
          {activeTab === 'satin-alma' && <SatinAlma stok={stok} setStok={setStok} siparisler={siparisler} setSiparisler={setSiparisler} />}
          {activeTab === 'cost-kontrol' && <CostKontrol siparisler={siparisler} setSiparisler={setSiparisler} tedarikciler={tedarikciler} stok={stok} setStok={setStok} />}
          {activeTab === 'receteler' && <Receteler receteler={receteler} setReceteler={setReceteler} stok={stok} />}
          {activeTab === 'aylik-menu' && <AylikMenu menu={menu} setMenu={setMenu} receteler={receteler} />}
          {activeTab === 'musteriler' && <Musteriler musteriler={musteriler} setMusteriler={setMusteriler} />}
          {activeTab === 'tedarikciler' && <Tedarikciler tedarikciler={tedarikciler} setTedarikciler={setTedarikciler} userRole={user.role} />}
          {activeTab === 'uretim' && <UretimPlani musteriSiparisleri={musteriSiparisleri} setMusteriSiparisleri={setMusteriSiparisleri} menu={menu} receteler={receteler} musteriler={musteriler} />}
          {activeTab === 'siparisler' && <Siparisler siparisler={siparisler} setSiparisler={setSiparisler} tedarikciler={tedarikciler} stok={stok} receteler={receteler} menu={menu} musteriSiparisleri={musteriSiparisleri} />}
        </main>
      </div>
    </div>
  );
}
